<!DOCTYPE html>
<html lang="en-us">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 3.2.0">
  <meta name="generator" content="Hugo 0.53" />
  <meta name="author" content="Dr. Dominic Royé">

  
  
  
  
    
  
  <meta name="description" content="Cuando visualizamos anomalías de precipitación y temperatura, simplemente usamos series temporales en un gráfico de barras indicando con color rojo y azul valores negativos y positivos. No obstante, para tener una imagen global necesitamos ambas anomalías en un único gráfico. Así podríamos responder directamente a la pregunta de si una estación del año o un mes en concreto fue seco-cálido o húmedo-frío, e incluso comparar estas anomalías en el contexto de años anteriores.">

  
  <link rel="alternate" hreflang="en-us" href="/es/2020/visualizar-anomal%C3%ADas-clim%C3%A1ticas/">

  


  

  

  

  

  

  

  
  
  
  <meta name="theme-color" content="#2962ff">
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha256-eSi1q2PG6J7g7ib17yAaWMcrr5GrtohYChqibrV7PBE=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.0/css/all.css" integrity="sha384-aOkxzJ5uQz7WBObEZcHvV5JvRW3TUc2rNPA7pe3AwnsUohiw1Vj2Rgx2KSOkF5+h" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" integrity="sha256-ygkqlh3CYSUri3LhQxzdcm0n1EQvH2Y+U5S2idbLtxs=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/dracula.min.css" crossorigin="anonymous">
      
    

    

    

  

  
  
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Playfair+Display:400,700|Fauna+One">
  

  <link rel="stylesheet" href="/es/styles.css">
  
  <link rel="stylesheet" href="/css/override.css">
  

  
  
    <script>
      window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
      ga('create', 'UA-27463794-2', 'auto');
      ga('set', 'anonymizeIp', true);
      ga('require', 'eventTracker');
      ga('require', 'outboundLinkTracker');
      ga('require', 'urlChangeTracker');
      ga('send', 'pageview');
    </script>
    <script async src="//www.google-analytics.com/analytics.js"></script>
    
    <script async src="https://cdnjs.cloudflare.com/ajax/libs/autotrack/2.4.1/autotrack.js" integrity="sha512-HUmooslVKj4m6OBu0OgzjXXr+QuFYy/k7eLI5jdeEy/F4RSgMn6XRWRGkFi5IFaFgy7uFTkegp3Z0XnJf3Jq+g==" crossorigin="anonymous"></script>
    
  
  

  
  <link rel="alternate" href="/index.xml" type="application/rss+xml" title="Dominic Royé">
  <link rel="feed" href="/index.xml" type="application/rss+xml" title="Dominic Royé">
  

  <link rel="manifest" href="/site.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="/es/2020/visualizar-anomal%C3%ADas-clim%C3%A1ticas/">

  
  
  
  
    
  
  <meta property="twitter:card" content="summary_large_image">
  
  <meta property="og:site_name" content="Dominic Royé">
  <meta property="og:url" content="/es/2020/visualizar-anomal%C3%ADas-clim%C3%A1ticas/">
  <meta property="og:title" content="Visualizar anomalías climáticas | Dominic Royé">
  <meta property="og:description" content="Cuando visualizamos anomalías de precipitación y temperatura, simplemente usamos series temporales en un gráfico de barras indicando con color rojo y azul valores negativos y positivos. No obstante, para tener una imagen global necesitamos ambas anomalías en un único gráfico. Así podríamos responder directamente a la pregunta de si una estación del año o un mes en concreto fue seco-cálido o húmedo-frío, e incluso comparar estas anomalías en el contexto de años anteriores."><meta property="og:image" content="/es/2020/visualizar-anomal%C3%ADas-clim%C3%A1ticas/featured.png">
  <meta property="og:locale" content="en-us">
  
  <meta property="article:published_time" content="2020-03-29T00:00:00&#43;00:00">
  
  <meta property="article:modified_time" content="2020-03-29T00:00:00&#43;00:00">
  

  

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.0.3/cookieconsent.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.0.3/cookieconsent.min.js"></script>
<script>
  window.addEventListener("load", function(){
    window.cookieconsent.initialise({
      "palette": {
        "popup": {
          "background": "#2962ff",
          "text": "#fff"
        },
        "button": {
          "background": "#fff",
          "text": "#2962ff"
        }
      },
      "theme": "classic",
      "content": {
        "message": "Este sitio web utiliza cookies para garantizarle una mejor experiencia.",
        "dismiss": "Entendido!",
        "link": "Más información",
        "href": "https://cookies.insites.com"
      }
    })});
</script>


  

  <title>Visualizar anomalías climáticas | Dominic Royé</title>

</head>
<body id="top" data-spy="scroll" data-target="#TableOfContents" data-offset="71" >
  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>

<nav class="navbar navbar-light fixed-top navbar-expand-lg py-0" id="navbar-main">
  <div class="container">

    
      <a class="navbar-brand" href="/es"><div style="position:relative;float:left">Dominic Royé<img src="/img/portrait.jpg" alt="Dominic Royé" style="float: left;"></div></a>
      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Barra de navegación">
        <span><i class="fas fa-bars"></i></span>
      </button>
      

    
    <div class="collapse navbar-collapse" id="navbar">

      
      
      <ul class="navbar-nav ml-auto">
        

        

        
        
        

        <li class="nav-item">
          <a class="nav-link" href="/es/#">
            
            <span>inicio</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/es/#posts">
            
            <span>blog</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/es/#publications_selected">
            
            <span>publicaciones</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/es/#graphs">
            
            <span>gráficos</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/es/#about">
            
            <span>mí</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/es/#teaching">
            
            <span>más</span>
            
          </a>
        </li>

        
        

      

        

        

        

        

      </ul>

    </div>
  </div>
</nav>


<article class="article" itemscope itemtype="http://schema.org/Article">

  













<div class="article-header d-xl-none">
  <div class="featured-image" style="background-image: url('/es/2020/visualizar-anomal%C3%ADas-clim%C3%A1ticas/featured_huf7b21bd40a1e3664179a4f6e2f7f8106_137900_800x0_resize_box_2.png');"></div>
  
</div>


<div class="container-fluid split-header d-none d-xl-block">
  <div class="row">
    <div class="col-6">
      <div class="split-header-content">
        <h1 itemprop="name">Visualizar anomalías climáticas</h1>

        

        

<div class="article-metadata">

  
  
  <span itemscope itemprop="author" itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Dr. Dominic Royé">
  </span>
  

  <span class="article-date">
    
    <meta content="2020-03-29 00:00:00 &#43;0000 UTC" itemprop="datePublished">
    <time datetime="2020-03-29 00:00:00 &#43;0000 UTC" itemprop="dateModified">
      2020-03-29
    </time>
  </span>
  <span itemscope itemprop="publisher" itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Dr. Dominic Royé">
  </span>

  

  
  
  <span class="middot-divider"></span>
  <a href="/es/2020/visualizar-anomal%C3%ADas-clim%C3%A1ticas/#disqus_thread"></a>
  

  
  
  
  <span class="middot-divider"></span>
  <span class="article-categories">
    <i class="fas fa-folder"></i>
    
    <a href="/es/categories/visualizaci%C3%B3n/">visualización</a>, 
    
    <a href="/es/categories/r/">R</a>, 
    
    <a href="/es/categories/rintermedio/">R:intermedio</a>
    
  </span>
  
  

  

</div>


        







  










        
<div class="share-box" aria-hidden="true">
  <ul class="share">
    <li>
      <a class="twitter"
         href="https://twitter.com/intent/tweet?text=Visualizar%20anomal%c3%adas%20clim%c3%a1ticas&amp;url=%2fes%2f2020%2fvisualizar-anomal%25C3%25ADas-clim%25C3%25A1ticas%2f"
         target="_blank" rel="noopener">
        <i class="fab fa-twitter"></i>
      </a>
    </li>
    <li>
      <a class="facebook"
         href="https://www.facebook.com/sharer.php?u=%2fes%2f2020%2fvisualizar-anomal%25C3%25ADas-clim%25C3%25A1ticas%2f"
         target="_blank" rel="noopener">
        <i class="fab fa-facebook-f"></i>
      </a>
    </li>
    <li>
      <a class="linkedin"
         href="https://www.linkedin.com/shareArticle?mini=true&amp;url=%2fes%2f2020%2fvisualizar-anomal%25C3%25ADas-clim%25C3%25A1ticas%2f&amp;title=Visualizar%20anomal%c3%adas%20clim%c3%a1ticas"
         target="_blank" rel="noopener">
        <i class="fab fa-linkedin-in"></i>
      </a>
    </li>
    <li>
      <a class="weibo"
         href="http://service.weibo.com/share/share.php?url=%2fes%2f2020%2fvisualizar-anomal%25C3%25ADas-clim%25C3%25A1ticas%2f&amp;title=Visualizar%20anomal%c3%adas%20clim%c3%a1ticas"
         target="_blank" rel="noopener">
        <i class="fab fa-weibo"></i>
      </a>
    </li>
    <li>
      <a class="email"
         href="mailto:?subject=Visualizar%20anomal%c3%adas%20clim%c3%a1ticas&amp;body=%2fes%2f2020%2fvisualizar-anomal%25C3%25ADas-clim%25C3%25A1ticas%2f">
        <i class="fas fa-envelope"></i>
      </a>
    </li>
  </ul>
</div>


      </div>
    </div>
    <div class="col-6">
      <div class="split-header-image">
        <img src="/es/2020/visualizar-anomal%C3%ADas-clim%C3%A1ticas/featured_huf7b21bd40a1e3664179a4f6e2f7f8106_137900_680x500_fill_q90_box_smart1_2.png" itemprop="image" alt="">
        
      </div>
    </div>
  </div>
</div>

<div class="article-container d-xl-none">
  <h1 itemprop="name">Visualizar anomalías climáticas</h1>

  

  

<div class="article-metadata">

  
  
  <span itemscope itemprop="author" itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Dr. Dominic Royé">
  </span>
  

  <span class="article-date">
    
    <meta content="2020-03-29 00:00:00 &#43;0000 UTC" itemprop="datePublished">
    <time datetime="2020-03-29 00:00:00 &#43;0000 UTC" itemprop="dateModified">
      2020-03-29
    </time>
  </span>
  <span itemscope itemprop="publisher" itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Dr. Dominic Royé">
  </span>

  

  
  
  <span class="middot-divider"></span>
  <a href="/es/2020/visualizar-anomal%C3%ADas-clim%C3%A1ticas/#disqus_thread"></a>
  

  
  
  
  <span class="middot-divider"></span>
  <span class="article-categories">
    <i class="fas fa-folder"></i>
    
    <a href="/es/categories/visualizaci%C3%B3n/">visualización</a>, 
    
    <a href="/es/categories/r/">R</a>, 
    
    <a href="/es/categories/rintermedio/">R:intermedio</a>
    
  </span>
  
  

  
  
<div class="share-box" aria-hidden="true">
  <ul class="share">
    <li>
      <a class="twitter"
         href="https://twitter.com/intent/tweet?text=Visualizar%20anomal%c3%adas%20clim%c3%a1ticas&amp;url=%2fes%2f2020%2fvisualizar-anomal%25C3%25ADas-clim%25C3%25A1ticas%2f"
         target="_blank" rel="noopener">
        <i class="fab fa-twitter"></i>
      </a>
    </li>
    <li>
      <a class="facebook"
         href="https://www.facebook.com/sharer.php?u=%2fes%2f2020%2fvisualizar-anomal%25C3%25ADas-clim%25C3%25A1ticas%2f"
         target="_blank" rel="noopener">
        <i class="fab fa-facebook-f"></i>
      </a>
    </li>
    <li>
      <a class="linkedin"
         href="https://www.linkedin.com/shareArticle?mini=true&amp;url=%2fes%2f2020%2fvisualizar-anomal%25C3%25ADas-clim%25C3%25A1ticas%2f&amp;title=Visualizar%20anomal%c3%adas%20clim%c3%a1ticas"
         target="_blank" rel="noopener">
        <i class="fab fa-linkedin-in"></i>
      </a>
    </li>
    <li>
      <a class="weibo"
         href="http://service.weibo.com/share/share.php?url=%2fes%2f2020%2fvisualizar-anomal%25C3%25ADas-clim%25C3%25A1ticas%2f&amp;title=Visualizar%20anomal%c3%adas%20clim%c3%a1ticas"
         target="_blank" rel="noopener">
        <i class="fab fa-weibo"></i>
      </a>
    </li>
    <li>
      <a class="email"
         href="mailto:?subject=Visualizar%20anomal%c3%adas%20clim%c3%a1ticas&amp;body=%2fes%2f2020%2fvisualizar-anomal%25C3%25ADas-clim%25C3%25A1ticas%2f">
        <i class="fas fa-envelope"></i>
      </a>
    </li>
  </ul>
</div>


  

</div>


  







  









</div>



  <div class="article-container">

    <div class="article-style" itemprop="articleBody">
      


<p>Cuando visualizamos anomalías de precipitación y temperatura, simplemente usamos series temporales en un gráfico de barras indicando con color rojo y azul valores negativos y positivos. No obstante, para tener una imagen global necesitamos ambas anomalías en un único gráfico. Así podríamos responder directamente a la pregunta de si una estación del año o un mes en concreto fue seco-cálido o húmedo-frío, e incluso comparar estas anomalías en el contexto de años anteriores.</p>
<div id="paquetes" class="section level2">
<h2>Paquetes</h2>
<p>En este post usaremos los siguientes paquetes:</p>
<table>
<thead>
<tr class="header">
<th align="left">Paquete</th>
<th align="left">Descripción</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">tidyverse</td>
<td align="left">Conjunto de paquetes (visualización y manipulación de datos): ggplot2, dplyr, purrr,etc.</td>
</tr>
<tr class="even">
<td align="left">lubridate</td>
<td align="left">Fácil manipulación de fechas y tiempos</td>
</tr>
<tr class="odd">
<td align="left">ggrepel</td>
<td align="left">Etiquetas sin superposición con ggplot2</td>
</tr>
</tbody>
</table>
<pre class="r"><code>#instalamos los paquetes si hace falta
if(!require(&quot;tidyverse&quot;)) install.packages(&quot;tidyverse&quot;)
if(!require(&quot;ggrepel&quot;)) install.packages(&quot;ggrepel&quot;)
if(!require(&quot;lubridate&quot;)) install.packages(&quot;lubridate&quot;)

#paquetes
library(tidyverse)
library(lubridate)
library(ggrepel)</code></pre>
</div>
<div id="preparar-los-datos" class="section level2">
<h2>Preparar los datos</h2>
<p>Primero importamos la precipitación y temperatura diaria de la estación meteorológica seleccionada (<a href="/files/meteo_tenerife.csv">descarga</a>). Usaremos los datos de Tenerife Sur (España) [1981-2020] accesible a través de <a href="https://opendata.aemet.es/">Open Data AEMET</a>. En R existe un paquete <a href="https://vegmod.ctfc.cat/software/meteoland/"><code>meteoland</code></a> que facilita la descarga con funciones específicas para acceder a los datos de AEMET, Meteogalicia y Meteocat.</p>
<div id="paso-1-importar-los-datos" class="section level3">
<h3>Paso 1: importar los datos</h3>
<p>Importamos los datos en formato <em>csv</em>, siendo la primera columna la fecha, la segunda la precipitación (pr) y la última la temperatura media diaria (ta).</p>
<pre class="r"><code>data &lt;- read_csv(&quot;meteo_tenerife.csv&quot;) </code></pre>
<pre><code>## Parsed with column specification:
## cols(
##   date = col_date(format = &quot;&quot;),
##   pr = col_double(),
##   ta = col_double()
## )</code></pre>
<pre class="r"><code>data</code></pre>
<pre><code>## # A tibble: 14,303 x 3
##    date          pr    ta
##    &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt;
##  1 1981-01-02   0    17.6
##  2 1981-01-03   0    16.8
##  3 1981-01-04   0    17.4
##  4 1981-01-05   0    17.6
##  5 1981-01-06   0    17  
##  6 1981-01-07   0    17.6
##  7 1981-01-08   0    18.6
##  8 1981-01-09   0    19.8
##  9 1981-01-10   0    21.5
## 10 1981-01-11   3.8  17.6
## # ... with 14,293 more rows</code></pre>
</div>
<div id="paso-2-preparar-los-datos" class="section level3">
<h3>Paso 2: preparar los datos</h3>
<p>En el segundo paso preparamos los datos para calcular las anomalías. Para ello, creamos tres nuevas columnas: el mes, el año y la estación del año. Como nuestro objetivo son las anomalías invernales no podemos usar el año natural, ya que el invierno comprende el mes de diciembre de un año y los meses de enero y febrero del siguiente. La función personalizada <code>meteo_yr()</code> extrae el año de una fecha indicando el mes inicial. El concepto es similar al año hidrológico en el que se empieza en octubre.</p>
<pre class="r"><code>meteo_yr &lt;- function(dates, start_month = NULL) {
  # convertir a POSIXlt
  dates.posix &lt;- as.POSIXlt(dates)
  # la compensación
  offset &lt;- ifelse(dates.posix$mon &gt;= start_month - 1, 1, 0)
  # nuevo año
  adj.year = dates.posix$year + 1900 + offset
  return(adj.year)
}</code></pre>
<p>Usaremos las funciones de la colección de paquetes <code>tidyverse</code> (<a href="https://www.tidyverse.org/" class="uri">https://www.tidyverse.org/</a>). La función <code>mutate()</code> ayuda a añadir nuevas columnas o a cambiar otras existentes. Para definir las estaciones del año, empleamos la función <code>case_when()</code> del paquete <code>dplyr</code> lo que tiene muchas ventajas en comparación con una cadena de <code>ifelse()</code>. En la función <code>case_when()</code> usamos fórmulas en dos tiempos, por un lado la condición y por otro la acción cuando se cumpla esa condición. En R una fórmula de dos tiempos o dos lados se consistuye con el operador <code>~</code>. El operador binario <code>%in%</code> nos permite filtrar varios valores en un conjunto.</p>
<pre class="r"><code>data &lt;- mutate(data, 
               winter_yr = meteo_yr(date, 12),
               month = month(date), 
               season = case_when(month %in% c(12,1:2) ~ &quot;Winter&quot;,
                                  month %in% 3:5 ~ &quot;Spring&quot;,
                                  month %in% 6:8 ~ &quot;Summer&quot;,
                                  month %in% 9:11 ~ &quot;Autum&quot;))

data</code></pre>
<pre><code>## # A tibble: 14,303 x 6
##    date          pr    ta winter_yr month season
##    &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; 
##  1 1981-01-02   0    17.6      1981     1 Winter
##  2 1981-01-03   0    16.8      1981     1 Winter
##  3 1981-01-04   0    17.4      1981     1 Winter
##  4 1981-01-05   0    17.6      1981     1 Winter
##  5 1981-01-06   0    17        1981     1 Winter
##  6 1981-01-07   0    17.6      1981     1 Winter
##  7 1981-01-08   0    18.6      1981     1 Winter
##  8 1981-01-09   0    19.8      1981     1 Winter
##  9 1981-01-10   0    21.5      1981     1 Winter
## 10 1981-01-11   3.8  17.6      1981     1 Winter
## # ... with 14,293 more rows</code></pre>
</div>
<div id="paso-3-estimar-las-anomalías-invernales" class="section level3">
<h3>Paso 3: estimar las anomalías invernales</h3>
<p>En el siguiente paso creamos un subset del invierno. Después agrupamos por el año meteorológico y calculamos la suma y el promedio para la precipitación y la temperatura, respectivamente. Para facilitar el trabajo el paquete <code>magrittr</code> introduce el operador llamado <em>pipe</em> en la forma <code>%&gt;%</code> con el objetivo de combinar varias funciones sin la necesidad de asignar el resultado a un nuevo objeto. El operador <em>pipe</em> pasa la salida de una función aplicada al primer argumento de la siguiente función. Esta forma de combinar funciones permite encadenar varios pasos de forma simultánea. Se debe entender y pronunciar el <code>%&gt;%</code> como <em>“luego”</em> (<em>then</em>).</p>
<pre class="r"><code>data_inv &lt;- filter(data, 
                   season == &quot;Winter&quot;) %&gt;% 
              group_by(winter_yr) %&gt;%
                  summarise(pr = sum(pr, na.rm = TRUE),
                            ta = mean(ta, na.rm = TRUE))</code></pre>
<p>Sólo nos quedan por calcular las anomalías de precipitación y temperatura. Las columnas <code>pr_mean</code> y <code>ta_mean</code> contendrán el promedio climatico, la referencia de las anomalías respecto al periodo normal 1981-2010. Por eso debemos filtrar los valores al periodo antes de 2010, lo que haremos de la forma habitual de filtrado de vectores en R. Una vez que tenemos las referencias estimamos las anomalías <code>pr_anom</code> y <code>ta_anom</code>. Para facilitar la interpretación, en el caso de la precipitación lo expresamos en porcentaje, pero poniendo el promedio en 0% en lugar del 100%.</p>
<p>Además, añadimmos tres columnas con información necesaria en la creación del gráfico. 1) <code>labyr</code> contiene el año de cada anomalía siempre y cuando haya sido mayor/menor del -+10% o -+0,5ºC, respectivamente (lo hago para que no haya demasiadas etiquetas), 2) <code>symb_point</code> una variable dummy para poder crear un simbolo diferencial entre los casos de (1), y 3) <code>lab_font</code> destacaremos en negrita el año 2020.</p>
<pre class="r"><code>data_inv &lt;-  mutate(data_inv, pr_mean = mean(pr[winter_yr &lt;= 2010]), 
                              ta_mean = mean(ta[winter_yr &lt;= 2010]),
                              pr_anom = (pr*100/pr_mean)-100, 
                              ta_anom = ta-ta_mean,
                              
                              labyr = case_when(pr_anom &lt; -10 &amp; ta_anom &lt; -.5 ~ winter_yr,
                                                pr_anom &lt; -10 &amp; ta_anom &gt; .5 ~ winter_yr,
                                                pr_anom &gt; 10 &amp; ta_anom &lt; -.5 ~ winter_yr,
                                                pr_anom &gt; 10 &amp; ta_anom &gt; .5 ~ winter_yr),
                              symb_point = ifelse(!is.na(labyr), &quot;yes&quot;, &quot;no&quot;),
                              lab_font = ifelse(labyr == 2020, &quot;bold&quot;, &quot;plain&quot;)
                    )</code></pre>
</div>
</div>
<div id="crear-el-gráfico" class="section level2">
<h2>Crear el gráfico</h2>
<p>El gráfico lo construiremos añadiendo capa por capa los diferentes elementos: 1) el fondo con las diferentes cuadrículas (Seco-Cálido, Seco-Frío, etc.) 2) los puntos y etiquetas, y 3) los últimos ajustes de estilo.</p>
<div id="parte-1" class="section level3">
<h3>Parte 1</h3>
<p>La idea es que tengamos los puntos con anomalías seco-cálido en el cuadrante I (arriba-derecha) y los de húmedo-frío en el cuadrante III (abajo-izquierda). Por eso, debemos invertir el signo en las anomalías de precipitación. Después creamos un <code>data.frame</code> con las posiciones de las etiquetas de los cuatro cuadrantes. Para las posiciones en <em>x</em> y <em>y</em> se usan <code>Inf</code> y <code>-Inf</code> lo que equivale al punto máximo dentro del <em>panel</em>. No obstante, es necesario ajustar la posición hacia los puntos extremos dentro del marco gráfico con los argumentos conocidos de <code>ggplot2</code>: <em>hjust</em> y <em>vjust</em>.</p>
<pre class="r"><code>data_inv_p &lt;- mutate(data_inv, pr_anom = pr_anom * -1)

bglab &lt;- data.frame(x = c(-Inf, Inf, -Inf, Inf), 
                    y = c(Inf, Inf, -Inf, -Inf),
                    hjust = c(1, 1, 0, 0), 
                    vjust = c(1, 0, 1, 0),
                    lab = c(&quot;Húmedo-Cálido&quot;, &quot;Seco-Cálido&quot;,
                              &quot;Húmedo-Frío&quot;, &quot;Seco-Frío&quot;))

  
bglab</code></pre>
<pre><code>##      x    y hjust vjust           lab
## 1 -Inf  Inf     1     1 Húmedo-Cálido
## 2  Inf  Inf     1     0   Seco-Cálido
## 3 -Inf -Inf     0     1   Húmedo-Frío
## 4  Inf -Inf     0     0     Seco-Frío</code></pre>
</div>
<div id="parte-2" class="section level3">
<h3>Parte 2</h3>
<p>En la segunda podemos empezar a construir el gráfico añadiendo todos los elementos gráficos. En esta parte creamos el fondo con los diferentes colores de cada cuadrante. La función <code>annotate()</code> permite añadir capas de geometría sin el uso de variables dentro de un <code>data.frame</code>. Con la función <code>geom_hline()</code> y <code>geom_vline()</code> marcamos los cuadrantes en horizontal y vertical usando una linea discontinua. Por último, dibujamos las etiquetas de cada cuadrante, empleando la función <code>geom_text()</code>. Cuando usamos diferentes fuentes de <code>data.frames</code>, uno diferente al principal usado en <code>ggplot()</code>, debemos indicarlo con el argumento <code>data</code> en la función de geomtría correspondiente.</p>
<pre class="r"><code>g1 &lt;- ggplot(data_inv_p, 
             aes(pr_anom, ta_anom)) +
         annotate(&quot;rect&quot;, xmin = -Inf, xmax = 0, ymin = 0, ymax = Inf, fill = &quot;#fc9272&quot;, alpha = .6) + #humedo-calido
         annotate(&quot;rect&quot;, xmin = 0, xmax = Inf, ymin = 0, ymax = Inf, fill = &quot;#cb181d&quot;, alpha = .6) + #seco-calido
         annotate(&quot;rect&quot;, xmin = -Inf, xmax = 0, ymin = -Inf, ymax = 0, fill = &quot;#2171b5&quot;, alpha = .6) + #humedo-frio
         annotate(&quot;rect&quot;, xmin = 0, xmax = Inf, ymin = -Inf, ymax = 0, fill = &quot;#c6dbef&quot;, alpha = .6) + #seco-frio
       geom_hline(yintercept = 0,
                  linetype = &quot;dashed&quot;) +
       geom_vline(xintercept = 0,
                  linetype = &quot;dashed&quot;) +
       geom_text(data = bglab, 
                     aes(x, y, label = lab, hjust = hjust, vjust = vjust),
                     fontface = &quot;italic&quot;, size = 5, 
                     angle = 90, colour = &quot;white&quot;)

g1</code></pre>
<p><img src="/post/es/2020-03-29-anomalias-climaticas/index.es_files/figure-html/unnamed-chunk-9-1.png" width="3507" /></p>
</div>
<div id="parte-3" class="section level3">
<h3>Parte 3</h3>
<p>En la tercera parte simplemente añadimos los puntos de las anomalías y las etiquetas de los años. La función <code>geom_text_repel()</code> es similar a la que conocemos por defecto en <code>ggplot2</code>, <code>geom_text()</code>, pero evita el sobrlapso entre sí.</p>
<pre class="r"><code>g2 &lt;- g1 + geom_point(aes(fill = symb_point, colour = symb_point),
                      size = 2.8, shape = 21, show.legend = FALSE) +
           geom_text_repel(aes(label = labyr, fontface = lab_font),
                           max.iter = 5000, 
                           size = 3.5) 
g2</code></pre>
<pre><code>## Warning: Removed 25 rows containing missing values (geom_text_repel).</code></pre>
<p><img src="/post/es/2020-03-29-anomalias-climaticas/index.es_files/figure-html/unnamed-chunk-10-1.png" width="3507" /></p>
</div>
<div id="parte-4" class="section level3">
<h3>Parte 4</h3>
<p>En la última parte ajustamos, además del estilo general, los ejes, el tipo de color y el (sub)título. Recuerda que cambiamos el signo en las anomalías de precipitación. Por eso, debemos usar los argumentos <code>breaks</code> y <code>labels</code> en la función <code>scale_x_continouous()</code> para revertir el signo en las etiquetas correspondientes a los cortes.</p>
<pre class="r"><code>g3 &lt;- g2 + scale_x_continuous(&quot;Anomalía de precipitación en %&quot;,
                              breaks = seq(-100, 250, 10) * -1,
                              labels = seq(-100, 250, 10),
                              limits = c(min(data_inv_p$pr_anom), 100)) +
           scale_y_continuous(&quot;Anomalía de temperatura media en ºC&quot;,
                              breaks = seq(-2, 2, 0.5)) +
           scale_fill_manual(values = c(&quot;black&quot;, &quot;white&quot;)) +
           scale_colour_manual(values = rev(c(&quot;black&quot;, &quot;white&quot;))) +
           labs(title = &quot;Anomalías invernales en Tenerife Sur&quot;, 
                caption = &quot;Datos: AEMET\nPeriodo normal 1981-2010&quot;) +
           theme_bw()

g3</code></pre>
<pre><code>## Warning: Removed 25 rows containing missing values (geom_text_repel).</code></pre>
<p><img src="/post/es/2020-03-29-anomalias-climaticas/index.es_files/figure-html/unnamed-chunk-11-1.png" width="3507" /></p>
</div>
</div>

    </div>

    


<div class="article-tags">
  
  <a class="badge badge-light" href="/es/tags/anomal%C3%ADa/">anomalía</a>
  
  <a class="badge badge-light" href="/es/tags/precipitaci%C3%B3n/">precipitación</a>
  
  <a class="badge badge-light" href="/es/tags/temperatura/">temperatura</a>
  
  <a class="badge badge-light" href="/es/tags/clima/">clima</a>
  
  <a class="badge badge-light" href="/es/tags/puntos/">puntos</a>
  
</div>



    






<div class="media author-card" itemscope itemtype="http://schema.org/Person">
  
  <img class="portrait mr-3" src="/img/potrai_domi.jpg" itemprop="image" alt="Avatar">
  
  <div class="media-body">
    <h5 class="card-title" itemprop="name"><a href="/es">Dr. Dominic Royé</a></h5>
    
    
    <ul class="network-icon" aria-hidden="true">
      
      
      
      
      
      
      
      
      <li>
        <a itemprop="sameAs" href="mailto:dominic.roye@usc.es" >
          <i class="fa fa-envelope"></i>
        </a>
      </li>
      
      
      
      
        
      
      
      
      
      
        
      
      <li>
        <a itemprop="sameAs" href="//twitter.com/dr_xeo" >
          <i class="fab fa-twitter"></i>
        </a>
      </li>
      
      
      
      
      
      
      
      
        
      
      <li>
        <a itemprop="sameAs" href="https://www.researchgate.net/profile/Dominic_Roye" target="_blank" rel="noopener">
          <i class="ai ai-researchgate"></i>
        </a>
      </li>
      
      
      
      
        
      
      
      
      
      
        
      
      <li>
        <a itemprop="sameAs" href="//github.com/dominicroye" >
          <i class="fab fa-github"></i>
        </a>
      </li>
      
    </ul>
  </div>
</div>




    
    
    <div class="article-widget">
      <div class="hr-light"></div>
      <h3>Relacionado</h3>
      <ul>
        
        <li><a href="/es/2019/visualizar-anomal%C3%ADas-de-precipitaci%C3%B3n-mensual/">Visualizar anomalías de precipitación mensual</a></li>
        
        <li><a href="/es/graphs/climate/">Clima y tiempo</a></li>
        
        <li><a href="/es/2020/distancias-geogr%C3%A1ficas/">Distancias geográficas</a></li>
        
        <li><a href="/es/publication/os_tempos_2019/">Os tempos e o clima de Galicia</a></li>
        
        <li><a href="/es/publication/ncdf_2015/">El uso de bases de datos climáticos netCDF con estructura matricial en el entorno de R</a></li>
        
      </ul>
    </div>
    

    
    <div class="article-widget">
      <div class="post-nav">
  
  <div class="post-nav-item">
    <div class="meta-nav">Siguiente</div>
    <a href="/es/2020/una-muy-breve-introducci%C3%B3n-a-tidyverse/" rel="next">Una muy breve introducción a Tidyverse</a>
  </div>
  
  
  <div class="post-nav-item">
    <div class="meta-nav">Anterior</div>
    <a href="/es/2020/distancias-geogr%C3%A1ficas/" rel="prev">Distancias geográficas</a>
  </div>
  
</div>

    </div>
    

    
<section id="comments">
  <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "https-dominicroye-github-io" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</section>



  </div>
</article>

<div class="container">
  <footer class="site-footer">
  

  <p class="powered-by">
    &copy; 2018-2020 Dominic Royé. All rights reserved. &middot; 

    Powered by the
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

    
    <span class="float-right" aria-hidden="true">
      <a href="#" id="back_to_top">
        <span class="button_icon">
          <i class="fas fa-chevron-up fa-2x"></i>
        </span>
      </a>
    </span>
    
  </p>
</footer>

</div>


<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Citar</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copiar
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Descargar
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

    

    
    

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha512-+NqPlbbtM1QqiK8ZAo4Yrj2c4lNQoGv8P79DPtKzj++l5jnN39rHA/xsqn8zE9l0uSoxaCdrOgFs6yjyfbBxSg==" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.3/imagesloaded.pkgd.min.js" integrity="sha512-umsR78NN0D23AzgoZ11K7raBD+R6hqKojyBZs1w8WvYlsI+QuKRGBx3LFCwhatzBunCjDuJpDHwxD13sLMbpRA==" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha256-VsEqElsCHSGmnmHXGQzvoWjWwoznFSZc6hs7ARLRacQ=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.4/isotope.pkgd.min.js" integrity="sha512-VDBOIlDbuC4VWxGJNmuFRQ0Li0SKkDpmGyuhAG5LTDLd/dJ/S0WMVxriR2Y+CyPL5gzjpN4f/6iqWVBJlht0tQ==" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" integrity="sha256-X5PoE3KU5l+JcX+w09p/wHl9AzK333C4hJ2I9S5mD4M=" crossorigin="anonymous"></script>

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>
        
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/r.min.js"></script>
        
      

      
      
    

    
    

    
    
    
    <script id="dsq-count-scr" src="//https-dominicroye-github-io.disqus.com/count.js" async></script>
    

    
    
    <script>hljs.initHighlightingOnLoad();</script>
    

    

    
    

    

    
    

    
    

    
    
    
    
    
    
    
    
    <script src="/js/academic.min.d037ee5294b166a79dec317c58aea9cc.js"></script>

    

  </body>
</html>

