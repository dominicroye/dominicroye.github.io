<!DOCTYPE html>
<html lang="en-us">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 3.2.0">
  <meta name="generator" content="Hugo 0.53" />
  <meta name="author" content="Dr. Dominic Royé">

  
  
  
  
    
  
  <meta name="description" content="La Dirección General del Catastro de España dispone de información espacial de toda la edificación a excepción del País Vasco y Navarra. Este conjunto de datos forma parte de la implantación de [INSPIRE](https://inspire.ec.europa.eu/), la Infraestructura de Información Espacial en Europa. Más información podemos encontrar [aquí](http://www.catastro.meh.es/webinspire/index.html). Utilizaremos los enlaces (*urls*) en formato *ATOM*, que es un formato de redifusión de tipo RSS, permitiéndonos obtener el enlace de descarga para cada municipio.">

  
  <link rel="alternate" hreflang="en-us" href="/es/2019/visualizar-el-crecimiento-urbano/">

  


  

  

  

  

  

  

  
  
  
  <meta name="theme-color" content="#2962ff">
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha256-eSi1q2PG6J7g7ib17yAaWMcrr5GrtohYChqibrV7PBE=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.0/css/all.css" integrity="sha384-aOkxzJ5uQz7WBObEZcHvV5JvRW3TUc2rNPA7pe3AwnsUohiw1Vj2Rgx2KSOkF5+h" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" integrity="sha256-ygkqlh3CYSUri3LhQxzdcm0n1EQvH2Y+U5S2idbLtxs=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/dracula.min.css" crossorigin="anonymous">
      
    

    

    

  

  
  

  <link rel="stylesheet" href="/es/styles.css">
  
  <link rel="stylesheet" href="/css/override.css">
  

  
  
    <script>
      window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
      ga('create', 'UA-27463794-2', 'auto');
      ga('set', 'anonymizeIp', true);
      ga('require', 'eventTracker');
      ga('require', 'outboundLinkTracker');
      ga('require', 'urlChangeTracker');
      ga('send', 'pageview');
    </script>
    <script async src="//www.google-analytics.com/analytics.js"></script>
    
    <script async src="https://cdnjs.cloudflare.com/ajax/libs/autotrack/2.4.1/autotrack.js" integrity="sha512-HUmooslVKj4m6OBu0OgzjXXr+QuFYy/k7eLI5jdeEy/F4RSgMn6XRWRGkFi5IFaFgy7uFTkegp3Z0XnJf3Jq+g==" crossorigin="anonymous"></script>
    
  
  

  
  <link rel="alternate" href="/index.xml" type="application/rss+xml" title="Dominic Royé">
  <link rel="feed" href="/index.xml" type="application/rss+xml" title="Dominic Royé">
  

  <link rel="manifest" href="/site.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="/es/2019/visualizar-el-crecimiento-urbano/">

  
  
  
  
    
  
  <meta property="twitter:card" content="summary_large_image">
  
  <meta property="og:site_name" content="Dominic Royé">
  <meta property="og:url" content="/es/2019/visualizar-el-crecimiento-urbano/">
  <meta property="og:title" content="Visualizar el crecimiento urbano | Dominic Royé">
  <meta property="og:description" content="La Dirección General del Catastro de España dispone de información espacial de toda la edificación a excepción del País Vasco y Navarra. Este conjunto de datos forma parte de la implantación de [INSPIRE](https://inspire.ec.europa.eu/), la Infraestructura de Información Espacial en Europa. Más información podemos encontrar [aquí](http://www.catastro.meh.es/webinspire/index.html). Utilizaremos los enlaces (*urls*) en formato *ATOM*, que es un formato de redifusión de tipo RSS, permitiéndonos obtener el enlace de descarga para cada municipio."><meta property="og:image" content="/es/2019/visualizar-el-crecimiento-urbano/featured.png">
  <meta property="og:locale" content="en-us">
  
  <meta property="article:published_time" content="2019-11-01T00:00:00&#43;00:00">
  
  <meta property="article:modified_time" content="2019-11-01T00:00:00&#43;00:00">
  

  

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.0.3/cookieconsent.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.0.3/cookieconsent.min.js"></script>
<script>
  window.addEventListener("load", function(){
    window.cookieconsent.initialise({
      "palette": {
        "popup": {
          "background": "#2962ff",
          "text": "#fff"
        },
        "button": {
          "background": "#fff",
          "text": "#2962ff"
        }
      },
      "theme": "classic",
      "content": {
        "message": "Este sitio web utiliza cookies para garantizarle una mejor experiencia.",
        "dismiss": "Entendido!",
        "link": "Más información",
        "href": "https://cookies.insites.com"
      }
    })});
</script>


  

  <title>Visualizar el crecimiento urbano | Dominic Royé</title>

</head>
<body id="top" data-spy="scroll" data-target="#TableOfContents" data-offset="71" >
  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>

<nav class="navbar navbar-light fixed-top navbar-expand-lg py-0" id="navbar-main">
  <div class="container">

    
      <a class="navbar-brand" href="/es"><div style="position:relative;float:left">Dominic Royé<img src="/img/portrait.jpg" alt="Dominic Royé" style="float: left;"></div></a>
      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Barra de navegación">
        <span><i class="fas fa-bars"></i></span>
      </button>
      

    
    <div class="collapse navbar-collapse" id="navbar">

      
      
      <ul class="navbar-nav ml-auto">
        

        

        
        
        

        <li class="nav-item">
          <a class="nav-link" href="/es/#">
            
            <span>inicio</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/es/#posts">
            
            <span>blog</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/es/#publications_selected">
            
            <span>publicaciones</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/es/#graphs">
            
            <span>gráficos</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/es/#about">
            
            <span>mí</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/es/#teaching">
            
            <span>más</span>
            
          </a>
        </li>

        
        

      

        

        

        

        

      </ul>

    </div>
  </div>
</nav>


<article class="article" itemscope itemtype="http://schema.org/Article">

  













<div class="article-header d-xl-none">
  <div class="featured-image" style="background-image: url('/es/2019/visualizar-el-crecimiento-urbano/featured_hub4080f892236b2d5d5c2399d277679ce_998437_800x0_resize_box_2.png');"></div>
  
</div>


<div class="container-fluid split-header d-none d-xl-block">
  <div class="row">
    <div class="col-6">
      <div class="split-header-content">
        <h1 itemprop="name">Visualizar el crecimiento urbano</h1>

        

        

<div class="article-metadata">

  
  
  <span itemscope itemprop="author" itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Dr. Dominic Royé">
  </span>
  

  <span class="article-date">
    
    <meta content="2019-11-01 00:00:00 &#43;0000 UTC" itemprop="datePublished">
    <time datetime="2019-11-01 00:00:00 &#43;0000 UTC" itemprop="dateModified">
      2019-11-01
    </time>
  </span>
  <span itemscope itemprop="publisher" itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Dr. Dominic Royé">
  </span>

  

  
  
  <span class="middot-divider"></span>
  <a href="/es/2019/visualizar-el-crecimiento-urbano/#disqus_thread"></a>
  

  
  
  
  <span class="middot-divider"></span>
  <span class="article-categories">
    <i class="fas fa-folder"></i>
    
    <a href="/es/categories/visualizaci%C3%B3n/">visualización</a>, 
    
    <a href="/es/categories/r/">R</a>, 
    
    <a href="/es/categories/rprincipante/">R:principante</a>, 
    
    <a href="/es/categories/gis/">gis</a>
    
  </span>
  
  

  

</div>


        







  










        
<div class="share-box" aria-hidden="true">
  <ul class="share">
    <li>
      <a class="twitter"
         href="https://twitter.com/intent/tweet?text=Visualizar%20el%20crecimiento%20urbano&amp;url=%2fes%2f2019%2fvisualizar-el-crecimiento-urbano%2f"
         target="_blank" rel="noopener">
        <i class="fab fa-twitter"></i>
      </a>
    </li>
    <li>
      <a class="facebook"
         href="https://www.facebook.com/sharer.php?u=%2fes%2f2019%2fvisualizar-el-crecimiento-urbano%2f"
         target="_blank" rel="noopener">
        <i class="fab fa-facebook-f"></i>
      </a>
    </li>
    <li>
      <a class="linkedin"
         href="https://www.linkedin.com/shareArticle?mini=true&amp;url=%2fes%2f2019%2fvisualizar-el-crecimiento-urbano%2f&amp;title=Visualizar%20el%20crecimiento%20urbano"
         target="_blank" rel="noopener">
        <i class="fab fa-linkedin-in"></i>
      </a>
    </li>
    <li>
      <a class="weibo"
         href="http://service.weibo.com/share/share.php?url=%2fes%2f2019%2fvisualizar-el-crecimiento-urbano%2f&amp;title=Visualizar%20el%20crecimiento%20urbano"
         target="_blank" rel="noopener">
        <i class="fab fa-weibo"></i>
      </a>
    </li>
    <li>
      <a class="email"
         href="mailto:?subject=Visualizar%20el%20crecimiento%20urbano&amp;body=%2fes%2f2019%2fvisualizar-el-crecimiento-urbano%2f">
        <i class="fas fa-envelope"></i>
      </a>
    </li>
  </ul>
</div>


      </div>
    </div>
    <div class="col-6">
      <div class="split-header-image">
        <img src="/es/2019/visualizar-el-crecimiento-urbano/featured_hub4080f892236b2d5d5c2399d277679ce_998437_680x500_fill_q90_box_smart1_2.png" itemprop="image" alt="">
        
      </div>
    </div>
  </div>
</div>

<div class="article-container d-xl-none">
  <h1 itemprop="name">Visualizar el crecimiento urbano</h1>

  

  

<div class="article-metadata">

  
  
  <span itemscope itemprop="author" itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Dr. Dominic Royé">
  </span>
  

  <span class="article-date">
    
    <meta content="2019-11-01 00:00:00 &#43;0000 UTC" itemprop="datePublished">
    <time datetime="2019-11-01 00:00:00 &#43;0000 UTC" itemprop="dateModified">
      2019-11-01
    </time>
  </span>
  <span itemscope itemprop="publisher" itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Dr. Dominic Royé">
  </span>

  

  
  
  <span class="middot-divider"></span>
  <a href="/es/2019/visualizar-el-crecimiento-urbano/#disqus_thread"></a>
  

  
  
  
  <span class="middot-divider"></span>
  <span class="article-categories">
    <i class="fas fa-folder"></i>
    
    <a href="/es/categories/visualizaci%C3%B3n/">visualización</a>, 
    
    <a href="/es/categories/r/">R</a>, 
    
    <a href="/es/categories/rprincipante/">R:principante</a>, 
    
    <a href="/es/categories/gis/">gis</a>
    
  </span>
  
  

  
  
<div class="share-box" aria-hidden="true">
  <ul class="share">
    <li>
      <a class="twitter"
         href="https://twitter.com/intent/tweet?text=Visualizar%20el%20crecimiento%20urbano&amp;url=%2fes%2f2019%2fvisualizar-el-crecimiento-urbano%2f"
         target="_blank" rel="noopener">
        <i class="fab fa-twitter"></i>
      </a>
    </li>
    <li>
      <a class="facebook"
         href="https://www.facebook.com/sharer.php?u=%2fes%2f2019%2fvisualizar-el-crecimiento-urbano%2f"
         target="_blank" rel="noopener">
        <i class="fab fa-facebook-f"></i>
      </a>
    </li>
    <li>
      <a class="linkedin"
         href="https://www.linkedin.com/shareArticle?mini=true&amp;url=%2fes%2f2019%2fvisualizar-el-crecimiento-urbano%2f&amp;title=Visualizar%20el%20crecimiento%20urbano"
         target="_blank" rel="noopener">
        <i class="fab fa-linkedin-in"></i>
      </a>
    </li>
    <li>
      <a class="weibo"
         href="http://service.weibo.com/share/share.php?url=%2fes%2f2019%2fvisualizar-el-crecimiento-urbano%2f&amp;title=Visualizar%20el%20crecimiento%20urbano"
         target="_blank" rel="noopener">
        <i class="fab fa-weibo"></i>
      </a>
    </li>
    <li>
      <a class="email"
         href="mailto:?subject=Visualizar%20el%20crecimiento%20urbano&amp;body=%2fes%2f2019%2fvisualizar-el-crecimiento-urbano%2f">
        <i class="fas fa-envelope"></i>
      </a>
    </li>
  </ul>
</div>


  

</div>


  







  









</div>



  <div class="article-container">

    <div class="article-style" itemprop="articleBody">
      


<p>La Dirección General del Catastro de España dispone de información espacial de toda la edificación a excepción del País Vasco y Navarra. Este conjunto de datos forma parte de la implantación de <a href="https://inspire.ec.europa.eu/">INSPIRE</a>, la Infraestructura de Información Espacial en Europa. Más información podemos encontrar <a href="http://www.catastro.meh.es/webinspire/index.html">aquí</a>. Utilizaremos los enlaces (<em>urls</em>) en formato <em>ATOM</em>, que es un formato de redifusión de tipo RSS, permitiéndonos obtener el enlace de descarga para cada municipio.</p>
<div class="alert alert-note">
  <p>Esta entrada de blog es una versión reducida del caso práctico que podéis encontrar en nuestra reciente publicación - <a href="https://dominicroye.github.io/es/publication/manual_rgis_2019/">Introducción a los SIG con R</a> - publicado por Dominic Royé y Roberto Serrano-Notivoli.</p>

</div>

<div id="paquetes" class="section level2">
<h2>Paquetes</h2>
<table>
<thead>
<tr class="header">
<th align="left">Paquete</th>
<th align="left">Descripción</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">tidyverse</td>
<td align="left">Conjunto de paquetes (visualización y manipulación de datos): ggplot2, dplyr, purrr,etc.</td>
</tr>
<tr class="even">
<td align="left">sf</td>
<td align="left">Simple Feature: importar, exportar y manipular datos vectoriales</td>
</tr>
<tr class="odd">
<td align="left">fs</td>
<td align="left">Proporciona una interfaz uniforme y multiplataforma para las operaciones del sistema de archivos</td>
</tr>
<tr class="even">
<td align="left">lubridate</td>
<td align="left">Fácil manipulación de fechas y tiempos</td>
</tr>
<tr class="odd">
<td align="left">feedeR</td>
<td align="left">Importar formatos de redifusión RSS</td>
</tr>
<tr class="even">
<td align="left">tmap</td>
<td align="left">Fácil creación de mapas temáticos</td>
</tr>
<tr class="odd">
<td align="left">classInt</td>
<td align="left">Para crear intervalos de clase univariantes</td>
</tr>
<tr class="even">
<td align="left">sysfonts</td>
<td align="left">Carga familias tipográficas del sistema y de Google</td>
</tr>
<tr class="odd">
<td align="left">showtext</td>
<td align="left">Usar familias tipográficas más fácilmente en gráficos R</td>
</tr>
</tbody>
</table>
<pre class="r"><code># instalamos los paquetes necesarios
if(!require(&quot;tidyverse&quot;)) install.packages(&quot;tidyverse&quot;)
if(!require(&quot;feedeR&quot;)) install.packages(&quot;feedeR&quot;)
if(!require(&quot;fs&quot;)) install.packages(&quot;fs&quot;)
if(!require(&quot;lubridate&quot;)) install.packages(&quot;lubridate&quot;)
if(!require(&quot;fs&quot;)) install.packages(&quot;fs&quot;)
if(!require(&quot;tmap&quot;)) install.packages(&quot;tmap&quot;)
if(!require(&quot;classInt&quot;)) install.packages(&quot;classInt&quot;)
if(!require(&quot;showtext&quot;)) install.packages(&quot;showtext&quot;)
if(!require(&quot;sysfonts&quot;)) install.packages(&quot;sysfonts&quot;)
if(!require(&quot;rvest&quot;)) install.packages(&quot;rvest&quot;)

# cargamos los paquetes
library(feedeR)
library(sf) 
library(fs)
library(tidyverse)
library(lubridate)
library(classInt)
library(tmap)
library(rvest)</code></pre>
</div>
<div id="enlaces-de-descarga" class="section level2">
<h2>Enlaces de descarga</h2>
<p>La primera <em>url</em> nos dará acceso a un listado de provincias, sedes territoriales (no siempre coinciden con la provincia), con nuevos enlaces RSS los cuales incluyen los enlaces finales de descarga para cada municipio. En este caso, descargaremos el edificado de Valencia. Los datos del Catastro se actualizan cada seis meses.</p>
<pre class="r"><code>url &lt;- &quot;http://www.catastro.minhap.es/INSPIRE/buildings/ES.SDGC.bu.atom.xml&quot;

# importamos los RSS con enlaces de provincias
prov_enlaces &lt;- feed.extract(url)
str(prov_enlaces) #estructura es lista</code></pre>
<pre><code>## List of 4
##  $ title  : chr &quot;Download service of Buildings. Territorial Office&quot;
##  $ link   : chr &quot;http://www.catastro.minhap.es/INSPIRE/buildings/ES.SDGC.BU.atom.xml&quot;
##  $ updated: POSIXct[1:1], format: &quot;2019-10-26&quot;
##  $ items  :&#39;data.frame&#39;: 52 obs. of  4 variables:
##   ..$ title: chr [1:52] &quot;Territorial office 02 Albacete&quot; &quot;Territorial office 03 Alicante&quot; &quot;Territorial office 04 AlmerÃ­a&quot; &quot;Territorial office 05 Avila&quot; ...
##   ..$ date : POSIXct[1:52], format: &quot;2019-10-26&quot; &quot;2019-10-26&quot; ...
##   ..$ link : chr [1:52] &quot;http://www.catastro.minhap.es/INSPIRE/buildings/02/ES.SDGC.bu.atom_02.xml&quot; &quot;http://www.catastro.minhap.es/INSPIRE/buildings/03/ES.SDGC.bu.atom_03.xml&quot; &quot;http://www.catastro.minhap.es/INSPIRE/buildings/04/ES.SDGC.bu.atom_04.xml&quot; &quot;http://www.catastro.minhap.es/INSPIRE/buildings/05/ES.SDGC.bu.atom_05.xml&quot; ...
##   ..$ hash : chr [1:52] &quot;d21ebb7975e59937&quot; &quot;bdba5e149f09e9d8&quot; &quot;03bcbcc7c5be2e17&quot; &quot;8a154202dd778143&quot; ...</code></pre>
<pre class="r"><code># extraemos la tabla con los enlaces
prov_enlaces_tab &lt;- as_tibble(prov_enlaces$items) %&gt;% 
                       mutate(title = repair_encoding(title))</code></pre>
<pre><code>## Best guess: UTF-8 (100% confident)</code></pre>
<pre class="r"><code>prov_enlaces_tab</code></pre>
<pre><code>## # A tibble: 52 x 4
##    title           date                link                            hash     
##    &lt;chr&gt;           &lt;dttm&gt;              &lt;chr&gt;                           &lt;chr&gt;    
##  1 Territorial of~ 2019-10-26 00:00:00 http://www.catastro.minhap.es/~ d21ebb79~
##  2 Territorial of~ 2019-10-26 00:00:00 http://www.catastro.minhap.es/~ bdba5e14~
##  3 Territorial of~ 2019-10-26 00:00:00 http://www.catastro.minhap.es/~ 03bcbcc7~
##  4 Territorial of~ 2019-10-26 00:00:00 http://www.catastro.minhap.es/~ 8a154202~
##  5 Territorial of~ 2019-10-26 00:00:00 http://www.catastro.minhap.es/~ 7d3fd376~
##  6 Territorial of~ 2019-10-26 00:00:00 http://www.catastro.minhap.es/~ 9c08741f~
##  7 Territorial of~ 2019-10-26 00:00:00 http://www.catastro.minhap.es/~ ff722b15~
##  8 Territorial of~ 2019-10-26 00:00:00 http://www.catastro.minhap.es/~ b431aa61~
##  9 Territorial of~ 2019-10-26 00:00:00 http://www.catastro.minhap.es/~ f79c6562~
## 10 Territorial of~ 2019-10-26 00:00:00 http://www.catastro.minhap.es/~ d702a6a8~
## # ... with 42 more rows</code></pre>
<p>Accedemos y descargamos los datos de Valencia. Para encontrar el enlace final de descarga usamos la función <code>filter()</code> del paquete <code>dplyr</code> buscando el nombre de la sede territorial y posteriormente el nombre del municipio en mayúsculas con la función <code>str_detect()</code> de <code>stringr</code>. La función <code>pull()</code> nos permite extraer una columna de un <code>data.frame</code>.</p>
<div class="alert alert-note">
  <p>Actualmente la función <code>feed.extract()</code> no importa correctamente en el <em>encoding</em> UTF-8 (Windows). Por eso, en algunas ciudades pueden aparecer una mala codificación de caracteres especiales “CÃ¡diz”. Para subsanar este problema aplicamos la función <code>repair_encoding()</code> del paquete <code>rvest</code>.</p>

</div>

<pre class="r"><code># filtramos la provincia y obtenemos la url RSS
val_atom &lt;- filter(prov_enlaces_tab, str_detect(title, &quot;Valencia&quot;)) %&gt;% pull(link)

# importamos la RSS
val_enlaces &lt;- feed.extract(val_atom)

# obtenemos la tabla con los enlaces de descarga
val_enlaces_tab &lt;- val_enlaces$items
val_enlaces_tab &lt;- mutate(val_enlaces_tab, title = repair_encoding(title),
                          link = repair_encoding(link)) </code></pre>
<pre><code>## Best guess: UTF-8 (100% confident)
## Best guess: UTF-8 (100% confident)</code></pre>
<pre class="r"><code># filtramos la tabla con el nombre de la ciudad
val_link &lt;- filter(val_enlaces_tab, str_detect(title, &quot;VALENCIA&quot;)) %&gt;% pull(link)
val_link</code></pre>
<pre><code>## [1] &quot;http://www.catastro.minhap.es/INSPIRE/Buildings/46/46900-VALENCIA/A.ES.SDGC.BU.46900.zip&quot;</code></pre>
</div>
<div id="descarga-de-datos" class="section level2">
<h2>Descarga de datos</h2>
<p>La descarga se realiza con la función <code>download.file()</code> que únicamente tiene dos argumentos principales, el enlace de descarga y la ruta con el nombre del archivo. En este caso hacemos uso de la función <code>tempfile()</code>, que nos es útil para crear archivos temporales, es decir, archivos que únicamente existen en la memoría RAM por un tiempo determinado.
El archivo que descargamos tiene extensión <code>*.zip</code>, por lo que debemos descomprimirlo con otra función (<code>unzip()</code>), que requiere el nombre del archivo y el nombre de la carpeta donde lo queremos descomprimir. Por último, la función <code>URLencode()</code> codifica una dirección <em>URL</em> que contiene caracteres especiales.</p>
<pre class="r"><code># creamos un archivo temporal 
temp &lt;- tempfile()

# descargamos los datos
download.file(URLencode(val_link), temp)

# descomprimimos a una carpeta llamda buildings
unzip(temp, exdir = &quot;buildings&quot;)</code></pre>
</div>
<div id="importar-los-datos" class="section level2">
<h2>Importar los datos</h2>
<p>Para importar los datos utilizamos la función <code>dir_ls()</code> del paquete <code>fs</code>, que nos permite obtener los archivos y carpetas de una ruta concreta al mismo tiempo que filtramos por un patrón de texto (<em>regexp</em>: expresión regular). Aplicamos la función <code>st_read()</code> del paquete <code>sf</code> al archivo espacial de formato <em>Geography Markup Language</em> (GML).</p>
<pre class="r"><code># obtenemos la ruta con el archivo
file_val &lt;- dir_ls(&quot;buildings&quot;, regexp = &quot;building.gml&quot;)

# importamos los datos
buildings_val &lt;- st_read(file_val)</code></pre>
<pre><code>## Reading layer `Building&#39; from data source `C:\Users\xeo19\Documents\GitHub\blogR_update\content\post\es\2019-11-01-visualizar-crecimiento-urbano\buildings\A.ES.SDGC.BU.46900.building.gml&#39; using driver `GML&#39;
## Simple feature collection with 36296 features and 24 fields
## geometry type:  MULTIPOLYGON
## dimension:      XY
## bbox:           xmin: 720608 ymin: 4351287 xmax: 734982.5 ymax: 4382906
## CRS:            25830</code></pre>
</div>
<div id="preparación-de-los-datos" class="section level2">
<h2>Preparación de los datos</h2>
<p>Únicamente convertimos la columna de la edad del edificio (<em>beginning</em>) en clase <code>Date</code>. La columna de la fecha contiene algunas fechas en formato <code>--01-01</code> lo que no corresponde a ninguna fecha reconocible. Por eso, reemplazamos el primer <code>-</code> por <code>0000</code>.</p>
<pre class="r"><code># 
buildings_val &lt;- mutate(buildings_val, 
               beginning = str_replace(beginning, &quot;^-&quot;, &quot;0000&quot;) %&gt;% 
                            ymd_hms() %&gt;% as_date()
               )</code></pre>
<pre><code>## Warning: 4 failed to parse.</code></pre>
</div>
<div id="gráfico-de-distribución" class="section level2">
<h2>Gráfico de distribución</h2>
<p>Antes de crear el mapa de la edad del edificado, lo que reflejará el crecimiento urbano, haremos un gráfico de distribución de la fecha de construcción de los edificios. Podremos identificar claramente períodos de expansión urbana. Usaremos el paquete <code>ggplot2</code> con la geometría de <code>geom_density()</code> para este objetivo. La función <code>font_add_google()</code> del paquete <code>sysfonts</code> nos permite descargar e incluir familias tipográficas de Google.</p>
<pre class="r"><code>#descarga de familia tipográfica
sysfonts::font_add_google(&quot;Montserrat&quot;, &quot;Montserrat&quot;)

#usar showtext para familias tipográficas
showtext::showtext_auto() </code></pre>
<pre class="r"><code>#limitamos al periodo posterior a 1750
filter(buildings_val, beginning &gt;= &quot;1750-01-01&quot;) %&gt;%
 ggplot(aes(beginning)) + 
    geom_density(fill = &quot;#2166ac&quot;, alpha = 0.7) +
  scale_x_date(date_breaks = &quot;20 year&quot;, 
               date_labels = &quot;%Y&quot;) +
  theme_minimal() +
  theme(title = element_text(family = &quot;Montserrat&quot;),
        axis.text = element_text(family = &quot;Montserrat&quot;)) +
  labs(y = &quot;&quot;,x = &quot;&quot;, title = &quot;Evolución del desarrollo urbano&quot;)</code></pre>
<p><img src="/post/es/2019-11-01-visualizar-crecimiento-urbano/index.es_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
</div>
<div id="buffer-de-25-km-de-valencia" class="section level2">
<h2>Buffer de 2,5 km de Valencia</h2>
<p>Para poder visualizar bien la distribución del crecimiento, limitamos el mapa a un radio de 2,5 km desde el centro de la ciudad. Usamos la función <code>geocode_OSM()</code> del paquete <code>tmaptools</code> para obtener las coordenadas de Valencia en clase <code>sf</code>. Después proyectamos los puntos al sistema que usamos para el edificado (EPSG:25830). Como último paso creamos con la función <code>st_buffer()</code> un <em>buffer</em> con 2500 m y la intersección con nuestros datos de los edificios. También es posible crear un buffer en forma de un rectángulo indicando el tipo de estilo con el argumento <code>endCapStyle = "SQUARE"</code>.</p>
<pre class="r"><code># obtenemos las coordinadas de Valencia
ciudad_point &lt;- tmaptools::geocode_OSM(&quot;Valencia&quot;, 
                                      as.sf = TRUE)

# proyectamos los datos
ciudad_point &lt;- st_transform(ciudad_point, 25830)

# creamos un buffer
point_bf &lt;- st_buffer(ciudad_point, 2500)


# obtenemos la intersección entre el buffer y la edificación
buildings_val25 &lt;- st_intersection(buildings_val, point_bf)</code></pre>
<pre><code>## Warning: attribute variables are assumed to be spatially constant throughout all
## geometries</code></pre>
</div>
<div id="preparar-los-datos-para-el-mapas" class="section level2">
<h2>Preparar los datos para el mapas</h2>
<p>Para poder visualizar bien las diferentes épocas de crecimiento, categorizamos el año en 15 grupos empleando cuartiles.</p>
<pre class="r"><code>#encontrar 15 clases
br &lt;- classIntervals(year(buildings_val25$beginning), 15, &quot;quantile&quot;)</code></pre>
<pre><code>## Warning in classIntervals(year(buildings_val25$beginning), 15, &quot;quantile&quot;): var
## has missing values, omitted in finding classes</code></pre>
<pre class="r"><code>#crear etiquetas
lab &lt;- names(print(br, under = &quot;&lt;&quot;, over = &quot;&gt;&quot;, cutlabels = FALSE))</code></pre>
<pre><code>## style: quantile
##      &lt; 1890 1890 - 1912 1912 - 1925 1925 - 1930 1930 - 1940 1940 - 1950 
##         940        1369         971         596        1719        1080 
## 1950 - 1957 1957 - 1962 1962 - 1966 1966 - 1970 1970 - 1973 1973 - 1977 
##        1227        1266        1233        1165        1161         932 
## 1977 - 1987 1987 - 1999      &gt; 1999 
##        1337        1197        1190</code></pre>
<pre class="r"><code>#categorizar el año
buildings_val25 &lt;- mutate(buildings_val25, 
               yr_cl = cut(year(beginning), br$brks, labels = lab, include.lowest = TRUE))</code></pre>
</div>
<div id="mapa-de-valencia" class="section level2">
<h2>Mapa de Valencia</h2>
<p>El mapa creamos con el paquete <code>tmap</code>. Es una interesante alternativa a <code>ggplot2</code>. Se trata de un paquete de funciones especializadas en crear mapas temáticos. La filosofía del paquete sigue a la de <code>ggplot2</code>, creando multiples capas con diferentes funciones, que siempre empiezan con <code>tm_*</code> y se combinan con <code>+</code>. La construcción de un mapa con <code>tmap</code> siempre comienza con <code>tm_shape()</code>, donde se definen los datos que queremos dibujar. Luego agregamos la geometría correspondiente al tipo de datos (<code>tm_polygon()</code>, <code>tm_border()</code>, <code>tm_dots()</code> o incluso <code>tm_raster()</code>). La función <code>tm_layout()</code> ayuda a configurar el estilo del mapa.</p>
<p>Cuando necesitamos más colores del máximo permitido por <code>RColorBrewer</code> podemos pasar los colores a la función <code>colorRampPalette()</code>. Esta función interpola para un mayor número más colores de la gama.</p>
<pre class="r"><code>#colores
col_spec &lt;- RColorBrewer::brewer.pal(11, &quot;Spectral&quot;)

#función de una gama de colores
col_spec_fun &lt;- colorRampPalette(col_spec)


#crear los mapas
tm_shape(buildings_val25) +
  tm_polygons(&quot;yr_cl&quot;, 
              border.col = &quot;transparent&quot;,
              palette = col_spec_fun(15),
              textNA = &quot;Sin dato&quot;,
              title = &quot;&quot;) +
 tm_layout(bg.color = &quot;black&quot;,
           outer.bg.color = &quot;black&quot;,
           legend.outside = TRUE,
           legend.text.color = &quot;white&quot;,
           legend.text.fontfamily = &quot;Montserrat&quot;, 
            panel.label.fontfamily = &quot;Montserrat&quot;,
            panel.label.color = &quot;white&quot;,
            panel.label.bg.color = &quot;black&quot;,
            panel.label.size = 5,
            panel.label.fontface = &quot;bold&quot;)</code></pre>
<p><img src="/post/es/2019-11-01-visualizar-crecimiento-urbano/index.es_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
</div>
<div id="mapa-dinámico-en-leaflet" class="section level2">
<h2>Mapa dinámico en leaflet</h2>
<p>Una ventaja muy interesante es la función <code>tmap_leaflet()</code> del paquete <code>tmap</code> para pasar de forma sencilla un mapa creado en el mismo marco a <code>leaflet</code>.</p>
<pre class="r"><code>#mapa tmap de Santiago
m &lt;-   tm_shape(buildings_val25) +
          tm_polygons(&quot;yr_cl&quot;, 
              border.col = &quot;transparent&quot;,
              palette = col_spec_fun(15),
              textNA = &quot;Without data&quot;,
              title = &quot;&quot;)


#mapa dinámico
tmap_leaflet(m)</code></pre>
<iframe src="/files/urban_growth_leaflet.html" width="672" height="500px">
</iframe>
</div>

    </div>

    


<div class="article-tags">
  
  <a class="badge badge-light" href="/es/tags/crecimiento-urbano/">crecimiento urbano</a>
  
  <a class="badge badge-light" href="/es/tags/ciudad/">ciudad</a>
  
  <a class="badge badge-light" href="/es/tags/geografia-urbana/">geografia urbana</a>
  
</div>



    






<div class="media author-card" itemscope itemtype="http://schema.org/Person">
  
  <img class="portrait mr-3" src="/img/potrai_domi.jpg" itemprop="image" alt="Avatar">
  
  <div class="media-body">
    <h5 class="card-title" itemprop="name"><a href="/es">Dr. Dominic Royé</a></h5>
    
    
    <ul class="network-icon" aria-hidden="true">
      
      
      
      
      
      
      
      
      <li>
        <a itemprop="sameAs" href="mailto:dominic.roye@usc.es" >
          <i class="fa fa-envelope"></i>
        </a>
      </li>
      
      
      
      
        
      
      
      
      
      
        
      
      <li>
        <a itemprop="sameAs" href="//twitter.com/dr_xeo" >
          <i class="fab fa-twitter"></i>
        </a>
      </li>
      
      
      
      
      
      
      
      
        
      
      <li>
        <a itemprop="sameAs" href="https://www.researchgate.net/profile/Dominic_Roye" target="_blank" rel="noopener">
          <i class="ai ai-researchgate"></i>
        </a>
      </li>
      
      
      
      
        
      
      
      
      
      
        
      
      <li>
        <a itemprop="sameAs" href="//github.com/dominicroye" >
          <i class="fab fa-github"></i>
        </a>
      </li>
      
    </ul>
  </div>
</div>




    
    

    
    <div class="article-widget">
      <div class="post-nav">
  
  <div class="post-nav-item">
    <div class="meta-nav">Siguiente</div>
    <a href="/es/2020/distancias-geogr%C3%A1ficas/" rel="next">Distancias geográficas</a>
  </div>
  
  
  <div class="post-nav-item">
    <div class="meta-nav">Anterior</div>
    <a href="/es/2019/visualizar-anomal%C3%ADas-de-precipitaci%C3%B3n-mensual/" rel="prev">Visualizar anomalías de precipitación mensual</a>
  </div>
  
</div>

    </div>
    

    
<section id="comments">
  <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "https-dominicroye-github-io" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</section>



  </div>
</article>

<div class="container">
  <footer class="site-footer">
  

  <p class="powered-by">
    &copy; 2018-2020 Dominic Royé. All rights reserved. &middot; 

    Powered by the
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

    
    <span class="float-right" aria-hidden="true">
      <a href="#" id="back_to_top">
        <span class="button_icon">
          <i class="fas fa-chevron-up fa-2x"></i>
        </span>
      </a>
    </span>
    
  </p>
</footer>

</div>


<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Citar</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copiar
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Descargar
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

    

    
    

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha512-+NqPlbbtM1QqiK8ZAo4Yrj2c4lNQoGv8P79DPtKzj++l5jnN39rHA/xsqn8zE9l0uSoxaCdrOgFs6yjyfbBxSg==" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.3/imagesloaded.pkgd.min.js" integrity="sha512-umsR78NN0D23AzgoZ11K7raBD+R6hqKojyBZs1w8WvYlsI+QuKRGBx3LFCwhatzBunCjDuJpDHwxD13sLMbpRA==" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha256-VsEqElsCHSGmnmHXGQzvoWjWwoznFSZc6hs7ARLRacQ=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.4/isotope.pkgd.min.js" integrity="sha512-VDBOIlDbuC4VWxGJNmuFRQ0Li0SKkDpmGyuhAG5LTDLd/dJ/S0WMVxriR2Y+CyPL5gzjpN4f/6iqWVBJlht0tQ==" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" integrity="sha256-X5PoE3KU5l+JcX+w09p/wHl9AzK333C4hJ2I9S5mD4M=" crossorigin="anonymous"></script>

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>
        
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/r.min.js"></script>
        
      

      
      
    

    
    

    
    
    
    <script id="dsq-count-scr" src="//https-dominicroye-github-io.disqus.com/count.js" async></script>
    

    
    
    <script>hljs.initHighlightingOnLoad();</script>
    

    

    
    

    

    
    

    
    

    
    
    
    
    
    
    
    
    <script src="/js/academic.min.d037ee5294b166a79dec317c58aea9cc.js"></script>

    

  </body>
</html>

