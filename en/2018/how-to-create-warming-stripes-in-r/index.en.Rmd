---
categories: ["datavis","R","R:elementary"]
title: How to create 'Warming Stripes' in R
date: '2018-12-05'
slug: how-to-create-warming-stripes-in-r
tags: ["ggplot2","warming stripes","global warming","visualization"]
header:
  caption: ''
  image: 'tiras_lisboa.png'
lang: en
summary: "This year, the so-called warming stripes, which were created by the scientist Ed Hawkins of the University of Reading, became very famous all over the world. These graphs represent and communicate climate change in a very illustrative and effective way."
---

This year, the so-called *warming stripes*, which were created by the scientist [Ed Hawkins](https://twitter.com/ed_hawkins?lang=es) of the University of Reading, became very famous all over the world. These graphs represent and communicate climate change in a very illustrative and effective way.

```{r echo=FALSE}
blogdown::shortcode('tweet', '999242147135188993')
```

From his idea, I created strips for examples of Spain, like the next one in Madrid.

```{r echo=FALSE}
blogdown::shortcode('tweet', '1002954473927561217')
```

In this post I will show how you can create these strips in R with the library *ggplot2*. Although I must say that there are many ways in R that can lead us to the same result or to a similar one, even within *ggplot2*.

## Data

In this case we will use the annual temperatures of Lisbon
[GISS Surface Temperature Analysis](https://data.giss.nasa.gov/gistemp/stdata/), homogenized time series, comprising the period from 1880 to 2018. Monthly temperatures or other time series could also be used. The file can be downloaded [here](/files/temp_lisboa.csv). First, we should, as long as we have not done it, install the collection of *tidyverse* libraries that also include *ggplot2*. In addition, we will need the library *lubridate* for the treatment of dates. Then, we import the data of Lisbon in csv format.

```{r,message=FALSE,error=FALSE,warning=FALSE}
#install the lubridate and tidyverse libraries
if(!require("lubridate")) install.packages("lubridate")
if(!require("tidyverse")) install.packages("tidyverse")

#packages
library(tidyverse)
library(lubridate)
library(RColorBrewer)

#import the annual temperatures
temp_lisboa <- read_csv("temp_lisboa.csv")

str(temp_lisboa)

```

We see in the columns that we have monthly and seasonal values, and the annual temperature value. But before proceeding to visualize the annual temperature, we must replace the missing values *999.9* with ``NA``, using the ``ifelse( )`` function that evaluates a condition and perform the given argument corresponding to true and false.

```{r,message=FALSE,error=FALSE,warning=FALSE}
#select only the annual temperature and year column
temp_lisboa_yr <- select(temp_lisboa, YEAR, metANN)

#rename the temperature column
temp_lisboa_yr <- rename(temp_lisboa_yr, ta = metANN)

#missing values 999.9
summary(temp_lisboa_yr) 

temp_lisboa_yr <- mutate(temp_lisboa_yr, ta = ifelse(ta == 999.9, NA, ta))

```


When we use the year as a variable, we do not usually convert it into a date object, however it is advisable. This allows us to use the date functions of the library *lubridate* and the support functions inside of *ggplot2*. The ``str_c( )`` function of the library *stringr*, part of the collection of *tidyverse*, is similar to ``paste( )`` of R Base that allows us to combine characters by specifying a separator (sep = "-"). The ``ymd( )`` (year month day) function of the *lubridate* library converts a date character into a *Date* object. It is possible to combine several functions
using the *pipe operator* ``%>%`` that helps to chain without assigning the result to a new object. Its use is very extended especially with the library *tidyverse*. If you want to know more about its use, [here](https://www.datacamp.com/community/tutorials/pipe-r-tutorial) you have a tutorial.

```{r,message=FALSE,error=FALSE,warning=FALSE}

temp_lisboa_yr <- mutate(temp_lisboa_yr, date = str_c(YEAR, "01-01", sep = "-") %>% ymd())

```

## Creating the strips

First, we create the style of the graph, specifying all the arguments of the theme we want to adjust. We start with the default style of ``theme_minimal( )``. In addition, we assign
the colors from *RColorBrewer* to an object *col_srip*. More information about the colors used [here](http://colorbrewer2.org).

```{r,message=FALSE,error=FALSE,warning=FALSE}

theme_strip <- theme_minimal()+
                 theme(axis.text.y = element_blank(),
                       axis.line.y = element_blank(),
                       axis.title = element_blank(),
                       panel.grid.major = element_blank(),
                       legend.title = element_blank(),
                       axis.text.x = element_text(vjust = 3),
                       panel.grid.minor = element_blank(),
                        plot.title = element_text(size = 14, face = "bold")
                       )


col_strip <- brewer.pal(11, "RdBu")

brewer.pal.info

```

For the final graphic we use the geometry ``geom_tile( )``. Since the data does not have a specific value for the Y axis, we need a *dummy* value, here I used 1. Also, I adjust the width of the color bar in the legend.

```{r,message=FALSE,error=FALSE,warning=FALSE,fig.width=12, fig.height=3}

     ggplot(temp_lisboa_yr,
             aes(x = date, y = 1, fill = ta))+
        geom_tile()+
           scale_x_date(date_breaks = "6 years",
                     date_labels = "%Y",
                     expand = c(0, 0))+
           scale_y_continuous(expand = c(0, 0))+
           scale_fill_gradientn(colors = rev(col_strip))+
             guides(fill = guide_colorbar(barwidth = 1))+
            labs(title = "LISBOA 1880-2018",
                caption = "Datos: GISS Surface Temperature Analysis")+
              theme_strip

```

In case we want to get only the strips, we can use ``theme_void( )`` and the argument *show.legend = FALSE* in ``geom_tile( )`` to remove all style elements. We can also change the color for the ``NA`` values, including the argument *na.value = "gray70"* in the ``scale_fill_gradientn( )`` function.

```{r,message=FALSE,error=FALSE,warning=FALSE,fig.width=12, fig.height=3}

     ggplot(temp_lisboa_yr,
             aes(x = date, y = 1, fill = ta))+
        geom_tile(show.legend = FALSE)+
           scale_x_date(date_breaks = "6 years",
                     date_labels = "%Y",
                     expand = c(0, 0))+
           scale_y_discrete(expand = c(0, 0))+
           scale_fill_gradientn(colors = rev(col_strip))+
             theme_void()

```
