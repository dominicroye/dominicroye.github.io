<!DOCTYPE html><html lang="en-us" >


<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  
  
  
    <meta name="generator" content="Wowchemy 5.3.0 for Hugo" />
  

  
  









  




  
  
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  

  
  
  
    
      
      <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap">
      <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media="print" onload="this.media='all'">
    
  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Dr. Dominic Royé" />

  
  
  
    
  
  <meta name="description" content="In April of this year, I made an animation of the 24-hour average temperature of January 2020, also showing the day-night cycle. My biggest problem was finding a way to project correctly the area at night without breaking the geometry. The easiest solution I found was rasterising the night polygon and then reprojecting it. Indeed, a vector approach could be used, but I have preferred to use raster data here." />

  
  <link rel="alternate" hreflang="en-us" href="https://dominicroye.github.io/en/2021/visualize-the-day-night-cycle-on-a-world-map/" />

  
  
  
    <meta name="theme-color" content="#1565c0" />
  

  
  

  

  <link rel="stylesheet" href="/css/vendor-bundle.min.f1ecf783c14edc00c9320c205831ad8e.css" media="print" onload="this.media='all'">

  
  
  
    
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha512-W0xM4mr6dEP9nREo7Z9z+9X70wytKvMGeDsj7ps2+xg5QPrEBXC8tAW1IFnzjR6eoJ90JmCnFzerQJTLzIEHjA==" crossorigin="anonymous" media="print" onload="this.media='all'">
    

    
    
    
    
      
      
    
    
    

    
    
    
      
    
    
      
      
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.2.1/build/styles/dracula.min.css" crossorigin="anonymous" title="hl-light" media="print" onload="this.media='all'">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.2.1/build/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" media="print" onload="this.media='all'" disabled>
      
    

    
    
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.7.1/dist/leaflet.min.css" integrity="" crossorigin="anonymous" media="print" onload="this.media='all'">
    

    

    
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      
        
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
  

  
  
  
  
  
  <link rel="stylesheet" href="/css/wowchemy.b48d89910a3f8560bb2d78fedea8d682.css" />

  




<script async src="https://www.googletagmanager.com/gtag/js?id=UA-27463794-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];

  function gtag() {
      dataLayer.push(arguments);
  }

  function trackOutboundLink(url, target) {
    gtag('event', 'click', {
         'event_category': 'outbound',
         'event_label': url,
         'transport_type': 'beacon',
         'event_callback': function () {
           if (target !== '_blank') {
             document.location = url;
           }
         }
    });
    console.debug("Outbound link clicked: " + url);
  }

  function onClickCallback(event) {
    if ((event.target.tagName !== 'A') || (event.target.host === window.location.host)) {
      return;
    }
    trackOutboundLink(event.target, event.target.getAttribute('target'));  
  }

  gtag('js', new Date());
  gtag('config', 'UA-27463794-2', {});
  gtag('set', {'cookie_flags': 'SameSite=None;Secure'});

  
  document.addEventListener('click', onClickCallback, false);
</script>


  

  

  




  
  
  

  

  
    <link rel="manifest" href="/en/manifest.webmanifest" />
  

  <link rel="icon" type="image/png" href="/media/icon_hu27cb63416a395b8c8d0d7112b85e26a9_17299_32x32_fill_lanczos_center_3.png" />
  <link rel="apple-touch-icon" type="image/png" href="/media/icon_hu27cb63416a395b8c8d0d7112b85e26a9_17299_180x180_fill_lanczos_center_3.png" />

  <link rel="canonical" href="https://dominicroye.github.io/en/2021/visualize-the-day-night-cycle-on-a-world-map/" />

  
  
  
  
  
  
  
  
    
  
  

  
  
    
    
  
  <meta property="twitter:card" content="summary_large_image" />
  
    <meta property="twitter:site" content="@@dr_xeo" />
    <meta property="twitter:creator" content="@@dr_xeo" />
  
  <meta property="og:site_name" content="Dr. Dominic Royé" />
  <meta property="og:url" content="https://dominicroye.github.io/en/2021/visualize-the-day-night-cycle-on-a-world-map/" />
  <meta property="og:title" content="Visualize the day-night cycle on a world map | Dr. Dominic Royé" />
  <meta property="og:description" content="In April of this year, I made an animation of the 24-hour average temperature of January 2020, also showing the day-night cycle. My biggest problem was finding a way to project correctly the area at night without breaking the geometry. The easiest solution I found was rasterising the night polygon and then reprojecting it. Indeed, a vector approach could be used, but I have preferred to use raster data here." /><meta property="og:image" content="https://dominicroye.github.io/en/2021/visualize-the-day-night-cycle-on-a-world-map/featured.png" />
    <meta property="twitter:image" content="https://dominicroye.github.io/en/2021/visualize-the-day-night-cycle-on-a-world-map/featured.png" /><meta property="og:locale" content="en-us" />
  
    
      <meta
        property="article:published_time"
        content="2021-12-20T00:00:00&#43;00:00"
      />
    
    <meta property="article:modified_time" content="2021-12-20T00:00:00&#43;00:00">
  

  


    






  




<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://dominicroye.github.io/en/2021/visualize-the-day-night-cycle-on-a-world-map/"
  },
  "headline": "Visualize the day-night cycle on a world map",
  
  "image": [
    "https://dominicroye.github.io/en/2021/visualize-the-day-night-cycle-on-a-world-map/featured.png"
  ],
  
  "datePublished": "2021-12-20T00:00:00Z",
  "dateModified": "2021-12-20T00:00:00Z",
  
  "author": {
    "@type": "Person",
    "name": "Dr. Dominic Royé"
  },
  
  "publisher": {
    "@type": "Organization",
    "name": "University of Santiago de Compostela",
    "logo": {
      "@type": "ImageObject",
      "url": "https://dominicroye.github.io/media/logo_hu6637600e1c36fe7812a10a6623aaebda_116520_192x192_fit_lanczos_3.png"
    }
  },
  "description": "In April of this year, I made an animation of the 24-hour average temperature of January 2020, also showing the day-night cycle. My biggest problem was finding a way to project correctly the area at night without breaking the geometry. The easiest solution I found was rasterising the night polygon and then reprojecting it. Indeed, a vector approach could be used, but I have preferred to use raster data here."
}
</script>

  

  

  

  





  <title>Visualize the day-night cycle on a world map | Dr. Dominic Royé</title>
</head>


<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" class="page-wrapper   " data-wc-page-id="2d7203b5c72c2d1515b98f57ed6f449a" >

  
  
  
  
  
  
  
  
  
  <script src="/js/wowchemy-init.min.2da3b1fa37e894630bf6de39b1b694b3.js"></script>

  




  <div class="page-header">
    







 



  


<header class="header--fixed">
  <nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
    <div class="container-xl">

      
      <div class="d-none d-lg-inline-flex">
        <a class="navbar-brand" href="/en/"><img src="/media/logo_hu6637600e1c36fe7812a10a6623aaebda_116520_0x70_resize_lanczos_3.png" alt="Dr. Dominic Royé"
            
            >
             <div style = "padding-top:0.5em;">Dr. Dominic Royé</div></a>
      </div>
      

      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar-content" aria-controls="navbar-content" aria-expanded="false" aria-label="Toggle navigation">
      <span><i class="fas fa-bars"></i></span>
      </button>
      

      
      <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
        <a class="navbar-brand" href="/en/"><img src="/media/logo_hu6637600e1c36fe7812a10a6623aaebda_116520_0x70_resize_lanczos_3.png" alt="Dr. Dominic Royé"
          
          ></a>
      </div>
      

      
      
      <div class="navbar-collapse main-menu-item collapse justify-content-end" id="navbar-content">

        
        <ul class="navbar-nav d-md-inline-flex">
          

          

          
          
          

          

          
          
          
          

          
            
            
          

          <li class="nav-item">
            <a class="nav-link " href="/en/#"><span>home</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/en/#posts"><span>blog</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/en/#featured"><span>publications</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/en/#projects"><span>graphs</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/en/#about"><span>me</span></a>
          </li>

          
          

        

          
        </ul>
      </div>

      <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">

        
        
          
            
            <li class="nav-item d-none d-lg-inline-flex">
              <a class="nav-link" href="https://twitter.com/dr_xeo" data-toggle="tooltip" data-placement="bottom" title="Follow me on Twitter" target="_blank" rel="noopener" aria-label="Follow me on Twitter">
                <i class="fab fa-twitter" aria-hidden="true"></i>
              </a>
            </li>
          
        

        
        

        
        

        
        

      </ul>

    </div>
  </nav>
</header>


  </div>

  <div class="page-body">
    <article class="article">

  




















  
  
    
  


<div class="article-container pt-3">
  <h1>Visualize the day-night cycle on a world map</h1>

  

  


<div class="article-metadata">

  
  

  
  <span class="article-date">
    
    
      
    
    2021-12-20
  </span>
  

  

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    8 min read
  </span>
  

  
  
  
  
  
  

  
  
  <span class="middot-divider"></span>
  <span class="article-categories">
    <i class="fas fa-folder mr-1"></i><a href="/en/category/gis/">gis</a>, <a href="/en/category/r/">R</a>, <a href="/en/category/rintermediate/">R:intermediate</a>, <a href="/en/category/visualization/">visualization</a></span>
  

</div>

  





</div>


<div class="article-header article-container featured-image-wrapper mt-4 mb-4" style="max-width: 720px; max-height: 365px;">
  <div style="position: relative">
    <img src="/en/2021/visualize-the-day-night-cycle-on-a-world-map/featured_hu3c463fd02e2559f14cd83f13dfc0e503_563001_720x0_resize_lanczos_3.png" width="720" height="365" alt="" class="featured-image">
    
  </div>
</div>



  <div class="article-container">

    <div class="article-style">
      
<script src="https://dominicroye.github.io/en/2021/visualize-the-day-night-cycle-on-a-world-map/index.en_files/header-attrs/header-attrs.js"></script>


<p>In April of this year, I made an animation of the 24-hour average temperature of January 2020, also showing the day-night cycle.</p>
<p><blockquote class="twitter-tweet"><p lang="en" dir="ltr">The average temperature of 24 hours in January 2020 with the day/night cycle. You can see a lot of geographic patterns. I love this kind of hypnotic temperature gifs. <a href="https://twitter.com/hashtag/rstats?src=hash&amp;ref_src=twsrc%5Etfw">#rstats</a> <a href="https://twitter.com/hashtag/rspatial?src=hash&amp;ref_src=twsrc%5Etfw">#rspatial</a> <a href="https://twitter.com/hashtag/dataviz?src=hash&amp;ref_src=twsrc%5Etfw">#dataviz</a> <a href="https://twitter.com/hashtag/climate?src=hash&amp;ref_src=twsrc%5Etfw">#climate</a> <a href="https://t.co/NA5haUlnie">pic.twitter.com/NA5haUlnie</a></p>&mdash; Dr. Dominic Royé (@dr_xeo) <a href="https://twitter.com/dr_xeo/status/1383486611707494406?ref_src=twsrc%5Etfw">April 17, 2021</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
</p>
<p>My biggest problem was finding a way to project correctly the area at night without breaking the geometry. The easiest solution I found was rasterising the night polygon and then reprojecting it. Indeed, a vector approach could be used, but I have preferred to use raster data here.</p>
<div id="packages" class="section level1">
<h1>Packages</h1>
<p>We will use the following packages:</p>
<table>
<colgroup>
<col width="12%" />
<col width="87%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Package</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">tidyverse</td>
<td align="left">Collection of packages (visualization, manipulation): ggplot2, dplyr, purrr, etc.</td>
</tr>
<tr class="even">
<td align="left">sf</td>
<td align="left">Simple Feature: import, export and manipulate vector data</td>
</tr>
<tr class="odd">
<td align="left">lubridate</td>
<td align="left">Easy manipulation of dates and times</td>
</tr>
<tr class="even">
<td align="left">hms</td>
<td align="left">Provides a simple class to store durations or time of day values and display them in hh:mm:ss format</td>
</tr>
<tr class="odd">
<td align="left">terra</td>
<td align="left">Import, export and manipulate raster (raster successor package)</td>
</tr>
<tr class="even">
<td align="left">lwgeom</td>
<td align="left">Access to the liblwgeom library with additional vector functions for sf</td>
</tr>
<tr class="odd">
<td align="left">rnaturalearth</td>
<td align="left">Vector maps of the world ‘Natural Earth’</td>
</tr>
<tr class="even">
<td align="left">gifski</td>
<td align="left">Creating animations in gif format</td>
</tr>
</tbody>
</table>
<pre class="r"><code># install the packages if necessary

if(!require(&quot;tidyverse&quot;)) install.packages(&quot;tidyverse&quot;)
if(!require(&quot;sf&quot;)) install.packages(&quot;sf&quot;)
if(!require(&quot;lubridate&quot;)) install.packages(&quot;lubridate&quot;)
if(!require(&quot;hms&quot;)) install.packages(&quot;hms&quot;)
if(!require(&quot;terra&quot;)) install.packages(&quot;terra&quot;)
if(!require(&quot;lwgeom&quot;)) install.packages(&quot;lwgeom&quot;)
if(!require(&quot;rnaturalearth&quot;)) install.packages(&quot;rnaturalearth&quot;)
if(!require(&quot;gifski&quot;)) install.packages(&quot;gifski&quot;)



# packages
library(rnaturalearth)
library(tidyverse)
library(lwgeom)
library(sf)
library(terra)
library(lubridate)
library(hms)
library(gifski)</code></pre>
<p><div class="alert alert-note">
  <div>
    To use the 50 and 10 m resolution of the <code>{rnaturalearth}</code> package it is necessary to install the following additional packages. The <code>{devtools}</code> package must be installed.
<code>devtools::install_github(&ldquo;ropensci/rnaturalearthdata&rdquo;)</code>
<code>devtools::install_github(&ldquo;ropensci/rnaturalearthhires&rdquo;)</code>
  </div>
</div>
</p>
</div>
<div id="preparation" class="section level1">
<h1>Preparation</h1>
<div id="external-functions" class="section level2">
<h2>External functions</h2>
<p>The functions to estimate the separator line between day and night are based on a javascript <em>L.Terminator.js</em> from the <code>{Leaflet}</code> package I found on <a href="https://stackoverflow.com/questions/48384058/world-map-showing-day-and-night-regions">stackoverflow</a>. You can download the script with the functions <a href="/files/terminator.R">here</a> or access it on <a href="https://github.com/JoGall/terminator/blob/master/terminator.R">github</a>.</p>
<pre class="r"><code>source(&quot;terminator.R&quot;) # import the functions</code></pre>
</div>
<div id="custom-functions" class="section level2">
<h2>Custom functions</h2>
<p>The primary function <code>terminator()</code> based on the javascript of <code>{Leaflet}</code> needs as arguments: the date-time, the minimum and maximum extension, as well as the resolution or the interval of longitude.</p>
<pre class="r"><code>t0 &lt;- Sys.time() # date and time of our operating system
t0</code></pre>
<pre><code>## [1] &quot;2022-03-27 11:36:26 CEST&quot;</code></pre>
<pre class="r"><code>coord_nightday &lt;- terminator(t0, -180, 180, 0.2) # estimate the day-night line

# convert it into a spatial object of class sf
line_nightday &lt;- st_linestring(as.matrix(coord_nightday)) %&gt;% st_sfc(crs = 4326) 

# plot
plot(line_nightday)</code></pre>
<p><img src="https://dominicroye.github.io/en/2021/visualize-the-day-night-cycle-on-a-world-map/index.en_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<p>In the next step, we obtain the polygons corresponding to the day and the night that separates the previously estimated line. To do this, we create a rectangle covering the entire planet and use the <code>st_split()</code> function from the <code>{lwgeom}</code> package that divides the rectangle.</p>
<pre class="r"><code># rectangle
wld_bbx &lt;- st_bbox(c(xmin = -180, xmax = 180,
                       ymin = -90, ymax = 90), 
                     crs = 4326) %&gt;% 
             st_as_sfc()

# division with the day-night line
poly_nightday &lt;-  st_split(wld_bbx, line_nightday) %&gt;% 
                      st_collection_extract(c(&quot;POLYGON&quot;)) %&gt;% 
                       st_sf() 

# plot
plot(poly_nightday)</code></pre>
<p><img src="https://dominicroye.github.io/en/2021/visualize-the-day-night-cycle-on-a-world-map/index.en_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p>The question now arises which of the two polygons corresponds to the night and which to the day. That will depend on what day of the year we are, given the changes in the Earth’s position concerning the Sun. Between the first summer equinox and the autumn equinox, it corresponds to the first polygon, when we can also observe the polar day at the north pole, and in the opposite case, it would be the second. The <code>{terra}</code> package only accepts its vector class called <code>SpatVector</code>, so we convert the vector object sf with the <code>vect()</code> function.</p>
<pre class="r"><code># select the second polygon
poly_nightday &lt;- slice(poly_nightday, 2) %&gt;% 
                    mutate(daynight = 1)

# create the raster with a resolution of 0.5º and the extent of the world
r &lt;- rast(vect(wld_bbx), resolution = .5)

# rasterize the night polygon 
night_rast &lt;- rasterize(vect(poly_nightday), r) 

# result in raster format
plot(night_rast)</code></pre>
<p><img src="https://dominicroye.github.io/en/2021/visualize-the-day-night-cycle-on-a-world-map/index.en_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>In the last step we reproject the raster to <a href="https://epsg.io/54009">Mollweide</a>.</p>
<pre class="r"><code># define the raster projection (WGS84)
crs(night_rast) &lt;- &quot;EPSG:4326&quot;

# reproject
night_rast_prj &lt;- project(night_rast, &quot;ESRI:54009&quot;, 
                          mask = TRUE, 
                          method = &quot;near&quot;)
# map
plot(night_rast_prj)</code></pre>
<p><img src="https://dominicroye.github.io/en/2021/visualize-the-day-night-cycle-on-a-world-map/index.en_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p>Finally we include the individual steps that we have done in a custom function.</p>
<pre class="r"><code>rast_determiner &lt;- function(x_min, date, res) {
  
  # create date with time adding the number of minutes
  t0 &lt;- as_date(date) + minutes(x_min) 
  # estimate the coordinates of the line that separates day and night
  night_step &lt;- terminator(t0, -180, 180, 0.2) %&gt;% as.matrix()
  # pass the points to line
  night_line &lt;- st_linestring(night_step) %&gt;% st_sfc(crs = 4326)
  
  # define the rectangle of the planet
  wld_bbx &lt;- st_bbox(c(xmin = -180, xmax = 180,
                       ymin = -90, ymax = 90), 
                     crs = 4326) %&gt;% 
             st_as_sfc()
  
  # divide the polygon with the day-night line
  poly_nightday &lt;-  st_split(wld_bbx, night_line) %&gt;% 
                      st_collection_extract(c(&quot;POLYGON&quot;)) %&gt;% 
                       st_sf()  
  
  # select the polygon according to the date
  if(date &lt;= make_date(year(date), 3, 20) | date &gt;= make_date(year(date), 9, 23)) {
    
    poly_nightday &lt;- slice(poly_nightday, 2) %&gt;% 
      mutate(daynight = 1)
    
  } else {
    
    poly_nightday &lt;- slice(poly_nightday, 1) %&gt;% 
      mutate(daynight = 1)
  }
  
  # create the raster with the resolution given in the argument res
  r &lt;- rast(vect(wld_bbx), resolution = res)
  
  # rasterize the night polygon
  night_rast &lt;- rasterize(vect(poly_nightday), r) 
  
  return(night_rast)
  
}</code></pre>
<p>Since we want to obtain the area at night for different day hours, we construct a second function to apply the first one at different day intervals (in minutes).</p>
<pre class="r"><code>night_determinator &lt;- function(time_seq, # minutes
                               date = Sys.Date(), # date (system default)
                               res = .5) { # raster resolution 0.5º

# apply the first function on a vector of day intervals
night_raster &lt;-  map(time_seq, 
                     rast_determiner,
                     date = date, 
                     res = res)

# convert the raster into an object with as many layers as day intervals
night_raster &lt;- rast(night_raster)

# define the WGS84 projection
crs(night_raster) &lt;- &quot;EPSG:4326&quot;

return(night_raster)
  
}</code></pre>
</div>
</div>
<div id="create-a-day-night-cycle" class="section level1">
<h1>Create a day-night cycle</h1>
<p>First, we create the area of nights for the day of our operating system with intervals of 30 minutes. Then we reproject it to <a href="https://epsg.io/54019">Winkel II</a>.</p>
<pre class="r"><code># apply our function for a 24 hour day in 30 minute intervals
night_rast &lt;- night_determinator(seq(0, 1410, 30), Sys.Date(), res = .5)

# reproject to Winkel II
night_raster_winkel &lt;- project(night_rast, 
                               &quot;ESRI:54019&quot;, 
                                mask = TRUE,
                                method = &quot;near&quot;)
# map of the first 5 intervals
plot(night_raster_winkel, maxnl = 5)</code></pre>
<p><img src="https://dominicroye.github.io/en/2021/visualize-the-day-night-cycle-on-a-world-map/index.en_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
</div>
<div id="animation-of-the-day-night-cycle" class="section level1">
<h1>Animation of the day-night cycle</h1>
<div id="preparation-1" class="section level2">
<h2>Preparation</h2>
<p>To create a 24-hour animation showing the movement of the night on the Earth, we must do a few previous steps. First we get the world boundaries with the <code>ne_countries()</code> function and reproject them to the new Winkel II projection. Then we convert the raster data into a <code>data.frame</code> indicating to keep missing values. We can see that each layer of the raster (of each 30-minute interval) is a column in the <code>data.frame</code>. We rename the columns and convert the table into a long format using the <code>pivot_longer()</code> function. What we do is to merge all the columns of the layers into a single one. As the last step, we exclude the missing values with the <code>filter()</code> function.</p>
<pre class="r"><code># country boundaries
wld &lt;- ne_countries(scale = 10, returnclass = &quot;sf&quot;) %&gt;% 
         st_transform(&quot;ESRI:54019&quot;)

# convert the raster to a data.frame with xyz
df_winkel &lt;- as.data.frame(night_raster_winkel, xy = TRUE, na.rm = FALSE)

# rename all the columns corresponding to the day intervals
names(df_winkel)[3:length(df_winkel)] &lt;- str_c(&quot;H&quot;, as_hms(seq(0, 1410, 30)*60))

# change to a long format
df_winkel &lt;- pivot_longer(df_winkel, 3:length(df_winkel), names_to = &quot;hour&quot;, values_to = &quot;night&quot;) 

# exclude missing values to reduce table size
df_winkel &lt;- filter(df_winkel, !is.na(night))</code></pre>
<p>It only remains to create a graticule and obtain the extent of the world map.</p>
<pre class="r"><code># graticule
grid &lt;- st_graticule() %&gt;%   st_transform(&quot;ESRI:54019&quot;)

# get the extension of the world
bbx &lt;- st_bbox(wld)</code></pre>
<p>Now we will build a map at a single interval with <code>ggplot2</code>, adding the vector geometry using the <code>geom_sf()</code> function (the boundaries and the graticule) and the raster data using the <code>geom_raster()</code> function. In the title, we are using a unicode symbol as a clock. We also define the map’s extent in <code>coord_sf()</code> to keet it constant over all maps in the animation. Finally, we make use of <code>{{ }}</code> from the <a href="https://www.tidyverse.org/blog/2019/06/rlang-0-4-0/">{rlang}</a> package within the <code>filter()</code>function to be able to filter our raster data in table form. So that our function can correctly evaluate the values that we pass in <code>x</code> (the intervals of the day) it is necessary to use this grammar of tidy evaluation due to data masking in <code>tidyverse</code>. Honestly, it is a topic for another post.</p>
<pre class="r"><code># example 5 UTC
x &lt;- &quot;H05:00:00&quot;
# map
ggplot() +
  # boundaries
  geom_sf(data = wld,
          fill = &quot;#74a9cf&quot;, 
          colour = &quot;white&quot;,
          size = .1) +
  # graticule
  geom_sf(data = grid, size = .1) +
  # filtered raster data 
  geom_raster(data = filter(df_winkel, hour == {{x}}), 
              aes(x, y), 
              fill = &quot;grey90&quot;,
              alpha = .6) +
  # title
  labs(title = str_c(&quot;\U1F551&quot;, str_remove(x, &quot;H&quot;), &quot; UTC&quot;)) + 
  # extension limits
  coord_sf(xlim = bbx[c(1, 3)], 
           ylim = bbx[c(2, 4)])  +
  # map style
  theme_void() +
  theme(plot.title = element_text(hjust = .1, vjust = .9))</code></pre>
</div>
<div id="animation" class="section level2">
<h2>Animation</h2>
<p>We create the animation by applying the <code>walk()</code> function, which in turn will go through the interval vector to filter our data and map each step using <code>ggplot</code>.</p>
<pre class="r"><code>walk(str_c(&quot;H&quot;, as_hms(seq(0, 1410, 30)*60)), function(step){
  
  g &lt;- ggplot() +
    geom_sf(data = wld,
            fill = &quot;#74a9cf&quot;, 
            colour = &quot;white&quot;,
            size = .1) +
    geom_sf(data = grid,
            size = .1) +
    geom_raster(data = filter(df_winkel, hour == {{step}}), aes(x, y), 
                fill = &quot;grey90&quot;,
                alpha = .6) +
    labs(title = str_c(&quot;\U1F551&quot;, str_remove(x, &quot;H&quot;), &quot; UTC&quot;)) + 
    coord_sf(xlim = bbx[c(1, 3)], ylim = bbx[c(2, 4)])  +
    theme_void() +
    theme(plot.title = element_text(hjust = .1, vjust = .9))
  
  
  ggsave(str_c(&quot;wld_night_&quot;, str_remove_all(step, &quot;:&quot;), &quot;.png&quot;), g,
         height = 4.3, width = 8.4, bg = &quot;white&quot;, dpi = 300, units = &quot;in&quot;)
  
})</code></pre>
<p>The creation of the final gif is done with <code>gifski()</code> passing it the names of the images in the order as they should appear in the animation.</p>
<pre class="r"><code>files &lt;- str_c(&quot;wld_night_H&quot;, str_remove_all(as_hms(seq(0, 1410, 30)*60), &quot;:&quot;), &quot;.png&quot;)

gifski(files, &quot;night_day.gif&quot;, width = 807, height = 409, loop = TRUE, delay = 0.1)</code></pre>
<p><img src="night_day.gif" /><!-- --></p>
<p><a href="https://www.buymeacoffee.com/drxeo" target="_blank"><img src="https://cdn.buymeacoffee.com/buttons/default-orange.png" alt="Buy Me A Coffee" height="41" width="174"></a></p>
</div>
</div>

    </div>

    






<div class="article-tags">
  
  <a class="badge badge-light" href="/en/tag/world-map/">world map</a>
  
  <a class="badge badge-light" href="/en/tag/day-night/">day-night</a>
  
  <a class="badge badge-light" href="/en/tag/animation/">animation</a>
  
</div>



<div class="share-box">
  <ul class="share">
    
      
      
      
        
      
      
      
      <li>
        <a href="https://twitter.com/intent/tweet?url=https://dominicroye.github.io/en/2021/visualize-the-day-night-cycle-on-a-world-map/&amp;text=Visualize%20the%20day-night%20cycle%20on%20a%20world%20map" target="_blank" rel="noopener" class="share-btn-twitter" aria-label="twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.facebook.com/sharer.php?u=https://dominicroye.github.io/en/2021/visualize-the-day-night-cycle-on-a-world-map/&amp;t=Visualize%20the%20day-night%20cycle%20on%20a%20world%20map" target="_blank" rel="noopener" class="share-btn-facebook" aria-label="facebook">
          <i class="fab fa-facebook"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="mailto:?subject=Visualize%20the%20day-night%20cycle%20on%20a%20world%20map&amp;body=https://dominicroye.github.io/en/2021/visualize-the-day-night-cycle-on-a-world-map/" target="_blank" rel="noopener" class="share-btn-email" aria-label="envelope">
          <i class="fas fa-envelope"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.linkedin.com/shareArticle?url=https://dominicroye.github.io/en/2021/visualize-the-day-night-cycle-on-a-world-map/&amp;title=Visualize%20the%20day-night%20cycle%20on%20a%20world%20map" target="_blank" rel="noopener" class="share-btn-linkedin" aria-label="linkedin-in">
          <i class="fab fa-linkedin-in"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="whatsapp://send?text=Visualize%20the%20day-night%20cycle%20on%20a%20world%20map%20https://dominicroye.github.io/en/2021/visualize-the-day-night-cycle-on-a-world-map/" target="_blank" rel="noopener" class="share-btn-whatsapp" aria-label="whatsapp">
          <i class="fab fa-whatsapp"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://service.weibo.com/share/share.php?url=https://dominicroye.github.io/en/2021/visualize-the-day-night-cycle-on-a-world-map/&amp;title=Visualize%20the%20day-night%20cycle%20on%20a%20world%20map" target="_blank" rel="noopener" class="share-btn-weibo" aria-label="weibo">
          <i class="fab fa-weibo"></i>
        </a>
      </li>
    
  </ul>
</div>











  
  



  
  
  
    
  
  
  
  <div class="media author-card content-widget-hr">
    
      
      <a href="https://dominicroye.github.io/"><img class="avatar mr-3 avatar-circle" src="/en/author/dr.-dominic-roye/avatar_hu930bec32484cd86675af8880de95caa2_508993_270x270_fill_q75_lanczos_center.jpg" alt="Dr. Dominic Royé"></a>
    

    <div class="media-body">
      <h5 class="card-title"><a href="https://dominicroye.github.io/">Dr. Dominic Royé</a></h5>
      <h6 class="card-subtitle">Senior postdoctoral researcher</h6>
      
      <ul class="network-icon" aria-hidden="true">
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://twitter.com/dr_xeo" target="_blank" rel="noopener">
        <i class="fab fa-twitter"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="/en/#contact" >
        <i class="fas fa-envelope"></i>
      </a>
    </li>
  
    
    
    
    
    
    
    
      
    
    <li>
      <a href="https://scholar.google.es/citations?user=EoYa8jUAAAAJ&amp;hl=es" target="_blank" rel="noopener">
        <i class="ai ai-google-scholar"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://github.com/dominicroye" target="_blank" rel="noopener">
        <i class="fab fa-github"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://www.linkedin.com/in/dominicroye/" target="_blank" rel="noopener">
        <i class="fab fa-linkedin"></i>
      </a>
    </li>
  
    
    
    
    
    
    
    
      
    
    <li>
      <a href="https://www.researchgate.net/profile/Dominic_Roye" target="_blank" rel="noopener">
        <i class="ai ai-researchgate"></i>
      </a>
    </li>
  
</ul>

    </div>
  </div>
















  
  
  <div class="article-widget content-widget-hr">
    <h3>Related</h3>
    <ul>
      
      <li><a href="/en/2022/hillshade-effects/">Hillshade effects</a></li>
      
      <li><a href="/en/2021/firefly-cartography/">Firefly cartography</a></li>
      
      <li><a href="/en/2020/climate-animation-of-maximum-temperatures/">Climate animation of maximum temperatures</a></li>
      
      <li><a href="/en/2022/use-of-multidimensional-spatial-data/">Use of multidimensional spatial data</a></li>
      
      <li><a href="/en/2021/bivariate-dasymetric-map/">Bivariate dasymetric map</a></li>
      
    </ul>
  </div>
  





  </div>
</article>
  </div>

  <div class="page-footer">
    
    
    <div class="container">
      <footer class="site-footer">

  



  

  

  
  <p class="powered-by">
    © 2018-2022 Dominic Royé. All rights reserved
  </p>
  

  
  






  <p class="powered-by">
    
    
    
      
      
      
      
      
      
      Published with <a href="https://wowchemy.com/?utm_campaign=poweredby" target="_blank" rel="noopener">Wowchemy</a> — the free, <a href="https://github.com/wowchemy/wowchemy-hugo-themes" target="_blank" rel="noopener">open source</a> website builder that empowers creators.
    
  </p>
</footer>

    </div>
    
  </div>

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

      

    
    <script src="/js/vendor-bundle.min.b73dfaac3b6499dc997741748a7c3fe2.js"></script>

    
    
    
      
      
        <script src="https://cdn.jsdelivr.net/gh/desandro/imagesloaded@v4.1.4/imagesloaded.pkgd.min.js" integrity="sha512-S5PZ9GxJZO16tT9r3WJp/Safn31eu8uWrzglMahDT4dsmgqWonRY9grk3j+3tfuPr9WJNsfooOR7Gi7HL5W2jw==" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/gh/metafizzy/isotope@v3.0.6/dist/isotope.pkgd.min.js" integrity="sha512-Zq2BOxyhvnRFXu0+WE6ojpZLOU2jdnqbrM1hmVdGzyeCa1DgM3X5Q4A/Is9xA1IkbUeDd7755dNNI/PzSf2Pew==" crossorigin="anonymous"></script>
      

      
      

      

      
        
        <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.2.1/build/highlight.min.js" integrity="sha512-Ypjm0o7jOxAd4hpdoppSEN0TQOC19UtPAqD+4s5AlXmUvbmmS/YMxYqAqarQYyxTnB6/rqip9qcxlNB/3U9Wdg==" crossorigin="anonymous"></script>
        
        
        <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.2.1/build/languages/r.min.js" crossorigin="anonymous"></script>
        
      

    

    
    
    
      <script src="https://cdn.jsdelivr.net/npm/leaflet@1.7.1/dist/leaflet.min.js" integrity="" crossorigin="anonymous"></script>
    

    
    

    
    
    

    
    

    
    
    
    

    
    

    
    
    
    
    
    
    
    
    
    <script src="/en/js/wowchemy.min.50d3bf3df0c53b31631bb48a62b35f92.js"></script>

    
  <script async defer src="https://buttons.github.io/buttons.js"></script>




</body>
</html>
