<!DOCTYPE html><html lang="en-us" >


<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  
  
  
    <meta name="generator" content="Wowchemy 5.3.0 for Hugo" />
  

  
  









  




  
  
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  

  
  
  
    
      
      <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap">
      <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media="print" onload="this.media='all'">
    
  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Dr. Dominic Royé" />

  
  
  
    
  
  <meta name="description" content="A disadvantage of choropleth maps is that they tend to distort the relationship between the true underlying geography and the represented variable. It is because the administrative divisions do not usually coincide with the geographical reality where people live. Besides, large areas appear to have a weight that they do not really have because of sparsely populated regions. To better reflect reality, more realistic population distributions are used, such as land use. With Geographic Information Systems techniques, it is possible to redistribute the variable of interest as a function of a variable with a smaller spatial unit." />

  
  <link rel="alternate" hreflang="en-us" href="https://dominicroye.github.io/en/2021/bivariate-dasymetric-map/" />

  
  
  
    <meta name="theme-color" content="#1565c0" />
  

  
  

  

  <link rel="stylesheet" href="/css/vendor-bundle.min.f1ecf783c14edc00c9320c205831ad8e.css" media="print" onload="this.media='all'">

  
  
  
    
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha512-W0xM4mr6dEP9nREo7Z9z+9X70wytKvMGeDsj7ps2+xg5QPrEBXC8tAW1IFnzjR6eoJ90JmCnFzerQJTLzIEHjA==" crossorigin="anonymous" media="print" onload="this.media='all'">
    

    
    
    
    
      
      
    
    
    

    
    
    
      
    
    
      
      
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.2.1/build/styles/dracula.min.css" crossorigin="anonymous" title="hl-light" media="print" onload="this.media='all'">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.2.1/build/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" media="print" onload="this.media='all'" disabled>
      
    

    
    
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.7.1/dist/leaflet.min.css" integrity="" crossorigin="anonymous" media="print" onload="this.media='all'">
    

    

    
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      
        
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
  

  
  
  
  
  
  <link rel="stylesheet" href="/css/wowchemy.b48d89910a3f8560bb2d78fedea8d682.css" />

  




<script async src="https://www.googletagmanager.com/gtag/js?id=UA-27463794-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];

  function gtag() {
      dataLayer.push(arguments);
  }

  function trackOutboundLink(url, target) {
    gtag('event', 'click', {
         'event_category': 'outbound',
         'event_label': url,
         'transport_type': 'beacon',
         'event_callback': function () {
           if (target !== '_blank') {
             document.location = url;
           }
         }
    });
    console.debug("Outbound link clicked: " + url);
  }

  function onClickCallback(event) {
    if ((event.target.tagName !== 'A') || (event.target.host === window.location.host)) {
      return;
    }
    trackOutboundLink(event.target, event.target.getAttribute('target'));  
  }

  gtag('js', new Date());
  gtag('config', 'UA-27463794-2', {});
  gtag('set', {'cookie_flags': 'SameSite=None;Secure'});

  
  document.addEventListener('click', onClickCallback, false);
</script>


  

  

  




  
  
  

  

  
    <link rel="manifest" href="/en/manifest.webmanifest" />
  

  <link rel="icon" type="image/png" href="/media/icon_hu27cb63416a395b8c8d0d7112b85e26a9_17299_32x32_fill_lanczos_center_3.png" />
  <link rel="apple-touch-icon" type="image/png" href="/media/icon_hu27cb63416a395b8c8d0d7112b85e26a9_17299_180x180_fill_lanczos_center_3.png" />

  <link rel="canonical" href="https://dominicroye.github.io/en/2021/bivariate-dasymetric-map/" />

  
  
  
  
  
  
  
  
    
  
  

  
  
    
    
  
  <meta property="twitter:card" content="summary_large_image" />
  
    <meta property="twitter:site" content="@@dr_xeo" />
    <meta property="twitter:creator" content="@@dr_xeo" />
  
  <meta property="og:site_name" content="Dr. Dominic Royé" />
  <meta property="og:url" content="https://dominicroye.github.io/en/2021/bivariate-dasymetric-map/" />
  <meta property="og:title" content="Bivariate dasymetric map | Dr. Dominic Royé" />
  <meta property="og:description" content="A disadvantage of choropleth maps is that they tend to distort the relationship between the true underlying geography and the represented variable. It is because the administrative divisions do not usually coincide with the geographical reality where people live. Besides, large areas appear to have a weight that they do not really have because of sparsely populated regions. To better reflect reality, more realistic population distributions are used, such as land use. With Geographic Information Systems techniques, it is possible to redistribute the variable of interest as a function of a variable with a smaller spatial unit." /><meta property="og:image" content="https://dominicroye.github.io/en/2021/bivariate-dasymetric-map/featured.png" />
    <meta property="twitter:image" content="https://dominicroye.github.io/en/2021/bivariate-dasymetric-map/featured.png" /><meta property="og:locale" content="en-us" />
  
    
      <meta
        property="article:published_time"
        content="2021-03-01T00:00:00&#43;00:00"
      />
    
    <meta property="article:modified_time" content="2021-03-01T00:00:00&#43;00:00">
  

  


    






  




<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://dominicroye.github.io/en/2021/bivariate-dasymetric-map/"
  },
  "headline": "Bivariate dasymetric map",
  
  "image": [
    "https://dominicroye.github.io/en/2021/bivariate-dasymetric-map/featured.png"
  ],
  
  "datePublished": "2021-03-01T00:00:00Z",
  "dateModified": "2021-03-01T00:00:00Z",
  
  "author": {
    "@type": "Person",
    "name": "Dr. Dominic Royé"
  },
  
  "publisher": {
    "@type": "Organization",
    "name": "University of Santiago de Compostela",
    "logo": {
      "@type": "ImageObject",
      "url": "https://dominicroye.github.io/media/logo_hu6637600e1c36fe7812a10a6623aaebda_116520_192x192_fit_lanczos_3.png"
    }
  },
  "description": "A disadvantage of choropleth maps is that they tend to distort the relationship between the true underlying geography and the represented variable. It is because the administrative divisions do not usually coincide with the geographical reality where people live. Besides, large areas appear to have a weight that they do not really have because of sparsely populated regions. To better reflect reality, more realistic population distributions are used, such as land use. With Geographic Information Systems techniques, it is possible to redistribute the variable of interest as a function of a variable with a smaller spatial unit."
}
</script>

  

  

  

  





  <title>Bivariate dasymetric map | Dr. Dominic Royé</title>
</head>


<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" class="page-wrapper   " data-wc-page-id="158a61691cc8516959fe965538fcd83d" >

  
  
  
  
  
  
  
  
  
  <script src="/js/wowchemy-init.min.2da3b1fa37e894630bf6de39b1b694b3.js"></script>

  




  <div class="page-header">
    







 



  


<header class="header--fixed">
  <nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
    <div class="container-xl">

      
      <div class="d-none d-lg-inline-flex">
        <a class="navbar-brand" href="/en/"><img src="/media/logo_hu6637600e1c36fe7812a10a6623aaebda_116520_0x70_resize_lanczos_3.png" alt="Dr. Dominic Royé"
            
            >
             <div style = "padding-top:0.5em;">Dr. Dominic Royé</div></a>
      </div>
      

      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar-content" aria-controls="navbar-content" aria-expanded="false" aria-label="Toggle navigation">
      <span><i class="fas fa-bars"></i></span>
      </button>
      

      
      <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
        <a class="navbar-brand" href="/en/"><img src="/media/logo_hu6637600e1c36fe7812a10a6623aaebda_116520_0x70_resize_lanczos_3.png" alt="Dr. Dominic Royé"
          
          ></a>
      </div>
      

      
      
      <div class="navbar-collapse main-menu-item collapse justify-content-end" id="navbar-content">

        
        <ul class="navbar-nav d-md-inline-flex">
          

          

          
          
          

          

          
          
          
          

          
            
            
          

          <li class="nav-item">
            <a class="nav-link " href="/en/#"><span>home</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/en/#posts"><span>blog</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/en/#featured"><span>publications</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/en/#projects"><span>graphs</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/en/#about"><span>me</span></a>
          </li>

          
          

        

          
        </ul>
      </div>

      <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">

        
        
          
            
            <li class="nav-item d-none d-lg-inline-flex">
              <a class="nav-link" href="https://twitter.com/dr_xeo" data-toggle="tooltip" data-placement="bottom" title="Follow me on Twitter" target="_blank" rel="noopener" aria-label="Follow me on Twitter">
                <i class="fab fa-twitter" aria-hidden="true"></i>
              </a>
            </li>
          
        

        
        

        
        

        
        

      </ul>

    </div>
  </nav>
</header>


  </div>

  <div class="page-body">
    <article class="article">

  




















  
  
    
  


<div class="article-container pt-3">
  <h1>Bivariate dasymetric map</h1>

  

  


<div class="article-metadata">

  
  

  
  <span class="article-date">
    
    
      
    
    2021-03-01
  </span>
  

  

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    7 min read
  </span>
  

  
  
  
  
  
  

  
  
  <span class="middot-divider"></span>
  <span class="article-categories">
    <i class="fas fa-folder mr-1"></i><a href="/en/category/gis/">gis</a>, <a href="/en/category/r/">R</a>, <a href="/en/category/radvanced/">R:advanced</a>, <a href="/en/category/visualization/">visualization</a></span>
  

</div>

  





</div>


<div class="article-header article-container featured-image-wrapper mt-4 mb-4" style="max-width: 720px; max-height: 409px;">
  <div style="position: relative">
    <img src="/en/2021/bivariate-dasymetric-map/featured_hubff03f7fd17096ad35f696c764335434_692102_720x0_resize_lanczos_3.png" width="720" height="409" alt="" class="featured-image">
    
  </div>
</div>



  <div class="article-container">

    <div class="article-style">
      
<script src="https://dominicroye.github.io/en/2021/bivariate-dasymetric-map/index.en_files/header-attrs/header-attrs.js"></script>


<div id="initial-considerations" class="section level1">
<h1>Initial considerations</h1>
<p>A disadvantage of choropleth maps is that they tend to distort the relationship between the true underlying geography and the represented variable. It is because the administrative divisions do not usually coincide with the geographical reality where people live. Besides, large areas appear to have a weight that they do not really have because of sparsely populated regions. To better reflect reality, more realistic population distributions are used, such as land use. With Geographic Information Systems techniques, it is possible to redistribute the variable of interest as a function of a variable with a smaller spatial unit.</p>
<p>With point data, the redistribution process is simply clipping points with population based on land use, usually classified as urban. We could also crop and mask with land use polygons when we have a vectorial polygon layer, but an interesting alternative is the same data in raster format. We will see how we can make a dasymetric map using raster data with a resolution of 100 m. This post will use data from census sections of the median income and the Gini index for Spain. We will make a dasymetric and bivariate map, representing both variables with two ranges of colours on the same map.</p>
</div>
<div id="packages" class="section level1">
<h1>Packages</h1>
<p>In this post we will use the following packages:</p>
<table>
<colgroup>
<col width="10%" />
<col width="89%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Package</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">tidyverse</td>
<td align="left">Collection of packages (visualization, manipulation): ggplot2, dplyr, purrr, etc.</td>
</tr>
<tr class="even">
<td align="left">patchwork</td>
<td align="left">Simple grammar to combine separate ggplots into the same graphic</td>
</tr>
<tr class="odd">
<td align="left">raster</td>
<td align="left">Import, export and manipulate raster</td>
</tr>
<tr class="even">
<td align="left">sf</td>
<td align="left">Simple Feature: import, export and manipulate vector data</td>
</tr>
<tr class="odd">
<td align="left">biscale</td>
<td align="left">Tools and Palettes for Bivariate Thematic Mapping</td>
</tr>
<tr class="even">
<td align="left">sysfonts</td>
<td align="left">Load fonts in R</td>
</tr>
<tr class="odd">
<td align="left">showtext</td>
<td align="left">Use fonts more easily in R graphs</td>
</tr>
</tbody>
</table>
<pre class="r"><code># install the packages if necessary
if(!require(&quot;tidyverse&quot;)) install.packages(&quot;tidyverse&quot;)
if(!require(&quot;patchwork&quot;)) install.packages(&quot;patchwork&quot;)
if(!require(&quot;sf&quot;)) install.packages(&quot;sf&quot;)
if(!require(&quot;raster&quot;)) install.packages(&quot;raster&quot;)
if(!require(&quot;biscale&quot;)) install.packages(&quot;biscale&quot;)
if(!require(&quot;sysfonts&quot;)) install.packages(&quot;sysfonts&quot;)
if(!require(&quot;showtext&quot;)) install.packages(&quot;showtext&quot;)

# packages
library(tidyverse)
library(sf)
library(readxl)
library(biscale)
library(patchwork)
library(raster)
library(sysfonts)
library(showtext)
library(raster)</code></pre>
</div>
<div id="preparation" class="section level1">
<h1>Preparation</h1>
<div id="data" class="section level2">
<h2>Data</h2>
<p>First we download all the necessary data. With the exception of the CORINE Land Cover (~ 200 MB), the data stored on this blog can be obtained directly via the indicated links.</p>
<ul>
<li>CORINE Land Cover 2018 (geotiff): <a href="https://land.copernicus.eu/pan-european/corine-land-cover/clc2018?tab=download">COPERNICUS</a></li>
<li>Income data and Gini index (excel) [INE]: <a href="/files/renta.zip">download</a></li>
<li>Census limits of Spain (vectorial) [INE]: <a href="/files/SECC_CE_20200101.zip">download</a></li>
</ul>
</div>
<div id="import" class="section level2">
<h2>Import</h2>
<p>The first thing we do is to import the land use raster, the income and Gini index data, and the census boundaries.</p>
<pre class="r"><code># raster of CORINE LAND COVER 2018
urb &lt;- raster(&quot;U2018_CLC2018_V2020_20u1.tif&quot;)

# income data and Gini index
renta &lt;- read_excel(&quot;30824.xlsx&quot;)
gini &lt;- read_excel(&quot;37677.xlsx&quot;)

# census boundaries
limits &lt;- read_sf(&quot;SECC_CE_20200101.shp&quot;) </code></pre>
</div>
<div id="land-uses" class="section level2">
<h2>Land uses</h2>
<p>In this first step we filter the census sections to obtain those of the Autonomous Community of Madrid, and we create the municipal limits. To dissolve the polygons of census tracts we apply the function <code>group_by()</code> in combination with <code>summarise()</code>.</p>
<pre class="r"><code># filter the Autonomous Community of Madrid
limits &lt;- filter(limits, NCA == &quot;Comunidad de Madrid&quot;)

# obtain the municipal limits
mun_limit &lt;- group_by(limits, CUMUN) %&gt;% summarise()</code></pre>
<p>In the next step we cut the land use raster with the limits of Madrid. I recommend always using the <code>crop()</code> function first and then <code>mask()</code>, the first function crop to the required extent and the second mask the values. Subsequently, we remove all the cells that correspond to 1 or 2 (urban continuous, discontinuous). Finally, we project the raster.</p>
<pre class="r"><code># project the limits
limits_prj &lt;- st_transform(limits, projection(urb))

# crop and mask 
urb_mad &lt;- crop(urb, limits_prj) %&gt;% 
              mask(limits_prj)

# remove non-urban pixels
urb_mad[!urb_mad %in% 1:2] &lt;- NA 

# plot the raster
plot(urb_mad)</code></pre>
<p><img src="https://dominicroye.github.io/en/2021/bivariate-dasymetric-map/index.en_files/figure-html/unnamed-chunk-6-1.png" width="2100" /></p>
<pre class="r"><code># project
urb_mad &lt;- projectRaster(urb_mad, crs = CRS(&quot;+proj=longlat +datum=WGS84 +no_defs&quot;))</code></pre>
<p>In this step, we convert the raster data into a point <code>sf</code> object.</p>
<pre class="r"><code># transform the raster to xyz and a sf object
urb_mad &lt;- as.data.frame(urb_mad, xy = TRUE, na.rm = TRUE) %&gt;%
                st_as_sf(coords = c(&quot;x&quot;, &quot;y&quot;), crs = 4326)

# add the columns of the coordinates
urb_mad &lt;- urb_mad %&gt;% rename(urb = 1) %&gt;% cbind(st_coordinates(urb_mad))</code></pre>
</div>
<div id="income-data-and-gini-index" class="section level2">
<h2>Income data and Gini index</h2>
<p>The format of the Excels does not coincide with the original of the INE, since I have cleaned the format before in order to make this post easier. What remains is to create a column with the codes of the census sections and exclude data that correspond to another administrative level.</p>
<pre class="r"><code>## income and Gini index data

renta_sec &lt;- mutate(renta, NATCODE = str_extract(CUSEC, &quot;[0-9]{5,10}&quot;), 
                nc_len = str_length(NATCODE),
                mun_name = str_remove(CUSEC, NATCODE) %&gt;% str_trim()) %&gt;%
             filter(nc_len &gt; 5)

gini_sec &lt;- mutate(gini, NATCODE = str_extract(CUSEC, &quot;[0-9]{5,10}&quot;), 
               nc_len = str_length(NATCODE),
               mun_name = str_remove(CUSEC, NATCODE) %&gt;% str_trim()) %&gt;%
             filter(nc_len &gt; 5)</code></pre>
<p>In the next step we join both tables with the census tracts using <code>left_join()</code> and convert columns of interest in numerical mode.</p>
<pre class="r"><code># join both the income and Gini tables with the census limits
mad &lt;- left_join(limits, renta_sec, by = c(&quot;CUSEC&quot;=&quot;NATCODE&quot;)) %&gt;% 
          left_join(gini_sec, by = c(&quot;CUSEC&quot;=&quot;NATCODE&quot;))

# convert selected columns to numeric
mad &lt;- mutate_at(mad, c(23:27, 30:31), as.numeric)</code></pre>
</div>
<div id="bivariate-variable" class="section level2">
<h2>Bivariate variable</h2>
<p>To create a bivariate map we must construct a single variable that combines different classes of two variables. Usually we make three classes of each variable which leads to nine combinations; in our case, the average income and the Gini index. The <code>biscale</code> package includes helper functions to carry out this process. With the <code>bi_class()</code> function we create the classification variable using quantiles as algorithm. Since in both variables we find missing values, we correct those combinations between both variables where an <code>NA</code> appears.</p>
<pre class="r"><code># create bivariate classification
mapbivar &lt;- bi_class(mad, GINI_2017, RNMP_2017, style = &quot;quantile&quot;, dim = 3) %&gt;% 
             mutate(bi_class = ifelse(str_detect(bi_class, &quot;NA&quot;), NA, bi_class))

# results
head(dplyr::select(mapbivar, GINI_2017, RNMP_2017, bi_class))</code></pre>
<pre><code>## Simple feature collection with 6 features and 3 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: 415538.9 ymin: 4451487 xmax: 469341.7 ymax: 4552422
## Projected CRS: ETRS89 / UTM zone 30N
## # A tibble: 6 x 4
##   GINI_2017 RNMP_2017 bi_class                                          geometry
##       &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;                                   &lt;MULTIPOLYGON [m]&gt;
## 1      NA          NA &lt;NA&gt;     (((446007.9 4552348, 446133.7 4552288, 446207.8 ~
## 2      31       13581 2-2      (((460243.8 4487756, 460322.4 4487739, 460279 44~
## 3      30       12407 2-2      (((457392.5 4486262, 457391.6 4486269, 457391.1 ~
## 4      34.3     13779 3-2      (((468720.8 4481374, 468695.5 4481361, 468664.6 ~
## 5      33.5      9176 3-1      (((417140.2 4451736, 416867.5 4451737, 416436.8 ~
## 6      26.2     10879 1-1      (((469251.9 4480826, 469268.1 4480797, 469292.6 ~</code></pre>
<p>We finish by redistributing the inequality variable over the pixels of urban land use. The <code>st_join()</code> function joins the data with the land use points.</p>
<pre class="r"><code># redistribute urban pixels to inequality
mapdasi &lt;- st_join(urb_mad, st_transform(mapbivar, 4326))</code></pre>
</div>
</div>
<div id="map-building" class="section level1">
<h1>Map building</h1>
<div id="legend-and-font" class="section level2">
<h2>Legend and font</h2>
<p>Before constructing both maps we must create the legend using the <code>bi_legend()</code> function. In the function we define the titles for each variable, the number of dimensions and the color scale. Finally, we add the Montserrat font for the final titles in the graphic.</p>
<pre class="r"><code># bivariate legend
legend2 &lt;- bi_legend(pal = &quot;DkViolet&quot;,
                     dim = 3,
                     xlab = &quot;Higher inequality&quot;,
                     ylab = &quot;Higher income&quot;,
                     size = 9)


# download font
font_add_google(&quot;Montserrat&quot;, &quot;Montserrat&quot;)
showtext_auto()</code></pre>
</div>
<div id="dasymetric-map" class="section level2">
<h2>Dasymetric map</h2>
<p>We build this map using <code>geom_tile()</code> for the pixels and <code>geom_sf()</code> for the municipal boundaries. In addition, it will be the map on the right where we also place the legend. To add the legend we use the <code>annotation_custom()</code> function indicating the position in the geographical coordinates of the map. The <code>biscale</code> package also helps us with the color definition via the <code>bi_scale_fill()</code> function.</p>
<pre class="r"><code>p2 &lt;- ggplot(mapdasi) + 
  geom_tile(aes(X, Y, 
                fill = bi_class), 
            show.legend = FALSE) +
  geom_sf(data = mun_limit,  
          color = &quot;grey80&quot;, 
          fill = NA, 
          size = 0.2) +
  annotation_custom(ggplotGrob(legend2), 
                    xmin = -3.25, xmax = -2.65,
                    ymin = 40.55, ymax = 40.95) +
  bi_scale_fill(pal = &quot;DkViolet&quot;, 
                dim = 3, 
                na.value = &quot;grey90&quot;) +
  labs(title = &quot;dasymetric&quot;, x = &quot;&quot;, y =&quot;&quot;) +
  bi_theme() +
  theme(plot.title = element_text(family = &quot;Montserrat&quot;, size = 30, face = &quot;bold&quot;)) +
  coord_sf(crs = 4326)</code></pre>
</div>
<div id="choropleth-map" class="section level2">
<h2>Choropleth map</h2>
<p>The choropleth map is built in a similar way to the previous map with the difference that we use <code>geom_sf()</code>.</p>
<pre class="r"><code>p1 &lt;- ggplot(mapbivar) + 
  geom_sf(aes(fill = bi_class), 
          colour = NA, 
          size = .1, 
          show.legend = FALSE) +
  geom_sf(data = mun_limit,  
          color = &quot;white&quot;, 
          fill = NA, 
          size = 0.2) +
  bi_scale_fill(pal = &quot;DkViolet&quot;, 
                dim = 3, 
                na.value = &quot;grey90&quot;) +
  labs(title = &quot;choropleth&quot;,  x = &quot;&quot;, y =&quot;&quot;) +
  bi_theme() +
  theme(plot.title = element_text(family = &quot;Montserrat&quot;, size = 30, face = &quot;bold&quot;)) +
  coord_sf(crs = 4326)</code></pre>
</div>
<div id="merge-both-maps" class="section level2">
<h2>Merge both maps</h2>
<p>With the help of the <code>patchwork</code> package, we combine both maps in a single row, first the choropleth map and on its right the dasymmetric map. More details of the grammar used for the combination of graphics <a href="https://patchwork.data-imaginist.com/">here</a>.</p>
<pre class="r"><code># combine 
p &lt;- p1 | p2

# final map
p</code></pre>
<p><img src="https://dominicroye.github.io/en/2021/bivariate-dasymetric-map/index.en_files/figure-html/unnamed-chunk-15-1.png" width="3300" /></p>
<p><a href="https://www.buymeacoffee.com/drxeo" target="_blank"><img src="https://cdn.buymeacoffee.com/buttons/default-orange.png" alt="Buy Me A Coffee" height="41" width="174"></a></p>
</div>
</div>

    </div>

    






<div class="article-tags">
  
  <a class="badge badge-light" href="/en/tag/bivariate/">bivariate</a>
  
  <a class="badge badge-light" href="/en/tag/map/">map</a>
  
  <a class="badge badge-light" href="/en/tag/inequality/">inequality</a>
  
  <a class="badge badge-light" href="/en/tag/income/">income</a>
  
  <a class="badge badge-light" href="/en/tag/madrid/">Madrid</a>
  
  <a class="badge badge-light" href="/en/tag/urban/">urban</a>
  
</div>



<div class="share-box">
  <ul class="share">
    
      
      
      
        
      
      
      
      <li>
        <a href="https://twitter.com/intent/tweet?url=https://dominicroye.github.io/en/2021/bivariate-dasymetric-map/&amp;text=Bivariate%20dasymetric%20map" target="_blank" rel="noopener" class="share-btn-twitter" aria-label="twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.facebook.com/sharer.php?u=https://dominicroye.github.io/en/2021/bivariate-dasymetric-map/&amp;t=Bivariate%20dasymetric%20map" target="_blank" rel="noopener" class="share-btn-facebook" aria-label="facebook">
          <i class="fab fa-facebook"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="mailto:?subject=Bivariate%20dasymetric%20map&amp;body=https://dominicroye.github.io/en/2021/bivariate-dasymetric-map/" target="_blank" rel="noopener" class="share-btn-email" aria-label="envelope">
          <i class="fas fa-envelope"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.linkedin.com/shareArticle?url=https://dominicroye.github.io/en/2021/bivariate-dasymetric-map/&amp;title=Bivariate%20dasymetric%20map" target="_blank" rel="noopener" class="share-btn-linkedin" aria-label="linkedin-in">
          <i class="fab fa-linkedin-in"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="whatsapp://send?text=Bivariate%20dasymetric%20map%20https://dominicroye.github.io/en/2021/bivariate-dasymetric-map/" target="_blank" rel="noopener" class="share-btn-whatsapp" aria-label="whatsapp">
          <i class="fab fa-whatsapp"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://service.weibo.com/share/share.php?url=https://dominicroye.github.io/en/2021/bivariate-dasymetric-map/&amp;title=Bivariate%20dasymetric%20map" target="_blank" rel="noopener" class="share-btn-weibo" aria-label="weibo">
          <i class="fab fa-weibo"></i>
        </a>
      </li>
    
  </ul>
</div>











  
  



  
  
  
    
  
  
  
  <div class="media author-card content-widget-hr">
    
      
      <a href="https://dominicroye.github.io/"><img class="avatar mr-3 avatar-circle" src="/en/author/dr.-dominic-roye/avatar_hu930bec32484cd86675af8880de95caa2_508993_270x270_fill_q75_lanczos_center.jpg" alt="Dr. Dominic Royé"></a>
    

    <div class="media-body">
      <h5 class="card-title"><a href="https://dominicroye.github.io/">Dr. Dominic Royé</a></h5>
      <h6 class="card-subtitle">Senior postdoctoral researcher</h6>
      
      <ul class="network-icon" aria-hidden="true">
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://twitter.com/dr_xeo" target="_blank" rel="noopener">
        <i class="fab fa-twitter"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="/en/#contact" >
        <i class="fas fa-envelope"></i>
      </a>
    </li>
  
    
    
    
    
    
    
    
      
    
    <li>
      <a href="https://scholar.google.es/citations?user=EoYa8jUAAAAJ&amp;hl=es" target="_blank" rel="noopener">
        <i class="ai ai-google-scholar"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://github.com/dominicroye" target="_blank" rel="noopener">
        <i class="fab fa-github"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://www.linkedin.com/in/dominicroye/" target="_blank" rel="noopener">
        <i class="fab fa-linkedin"></i>
      </a>
    </li>
  
    
    
    
    
    
    
    
      
    
    <li>
      <a href="https://www.researchgate.net/profile/Dominic_Roye" target="_blank" rel="noopener">
        <i class="ai ai-researchgate"></i>
      </a>
    </li>
  
</ul>

    </div>
  </div>
















  
  
  <div class="article-widget content-widget-hr">
    <h3>Related</h3>
    <ul>
      
      <li><a href="/en/2021/firefly-cartography/">Firefly cartography</a></li>
      
      <li><a href="/en/2022/use-of-multidimensional-spatial-data/">Use of multidimensional spatial data</a></li>
      
      <li><a href="/en/2021/visualize-the-day-night-cycle-on-a-world-map/">Visualize the day-night cycle on a world map</a></li>
      
      <li><a href="/en/2020/climate-animation-of-maximum-temperatures/">Climate animation of maximum temperatures</a></li>
      
      <li><a href="/en/2020/river-flow-directions/">River flow directions</a></li>
      
    </ul>
  </div>
  





  </div>
</article>
  </div>

  <div class="page-footer">
    
    
    <div class="container">
      <footer class="site-footer">

  



  

  

  
  <p class="powered-by">
    © 2018-2022 Dominic Royé. All rights reserved
  </p>
  

  
  






  <p class="powered-by">
    
    
    
      
      
      
      
      
      
      Published with <a href="https://wowchemy.com/?utm_campaign=poweredby" target="_blank" rel="noopener">Wowchemy</a> — the free, <a href="https://github.com/wowchemy/wowchemy-hugo-themes" target="_blank" rel="noopener">open source</a> website builder that empowers creators.
    
  </p>
</footer>

    </div>
    
  </div>

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

      

    
    <script src="/js/vendor-bundle.min.b73dfaac3b6499dc997741748a7c3fe2.js"></script>

    
    
    
      
      
        <script src="https://cdn.jsdelivr.net/gh/desandro/imagesloaded@v4.1.4/imagesloaded.pkgd.min.js" integrity="sha512-S5PZ9GxJZO16tT9r3WJp/Safn31eu8uWrzglMahDT4dsmgqWonRY9grk3j+3tfuPr9WJNsfooOR7Gi7HL5W2jw==" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/gh/metafizzy/isotope@v3.0.6/dist/isotope.pkgd.min.js" integrity="sha512-Zq2BOxyhvnRFXu0+WE6ojpZLOU2jdnqbrM1hmVdGzyeCa1DgM3X5Q4A/Is9xA1IkbUeDd7755dNNI/PzSf2Pew==" crossorigin="anonymous"></script>
      

      
      

      

      
        
        <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.2.1/build/highlight.min.js" integrity="sha512-Ypjm0o7jOxAd4hpdoppSEN0TQOC19UtPAqD+4s5AlXmUvbmmS/YMxYqAqarQYyxTnB6/rqip9qcxlNB/3U9Wdg==" crossorigin="anonymous"></script>
        
        
        <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.2.1/build/languages/r.min.js" crossorigin="anonymous"></script>
        
      

    

    
    
    
      <script src="https://cdn.jsdelivr.net/npm/leaflet@1.7.1/dist/leaflet.min.js" integrity="" crossorigin="anonymous"></script>
    

    
    

    
    
    

    
    

    
    
    
    

    
    

    
    
    
    
    
    
    
    
    
    <script src="/en/js/wowchemy.min.50d3bf3df0c53b31631bb48a62b35f92.js"></script>

    
  <script async defer src="https://buttons.github.io/buttons.js"></script>




</body>
</html>
