<!DOCTYPE html><html lang="en-us" >


<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  
  
  
    <meta name="generator" content="Wowchemy 5.3.0 for Hugo" />
  

  
  









  




  
  
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  

  
  
  
    
      
      <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap">
      <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media="print" onload="this.media='all'">
    
  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Dr. Dominic Royé" />

  
  
  
    
  
  <meta name="description" content="Normally when we visualize monthly precipitation anomalies, we simply use a bar graph indicating negative and positive values with red and blue. However, it does not explain the general context of these anomalies. For example, what was the highest or lowest anomaly in each month? In principle, we could use a *boxplot* to visualize the distribution of the anomalies, but in this particular case they would not fit aesthetically, so we should look for an alternative. Here I present a very useful graphic form." />

  
  <link rel="alternate" hreflang="en-us" href="https://dominicroye.github.io/en/2019/visualize-monthly-precipitation-anomalies/" />

  
  
  
    <meta name="theme-color" content="#1565c0" />
  

  
  

  

  <link rel="stylesheet" href="/css/vendor-bundle.min.f1ecf783c14edc00c9320c205831ad8e.css" media="print" onload="this.media='all'">

  
  
  
    
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha512-W0xM4mr6dEP9nREo7Z9z+9X70wytKvMGeDsj7ps2+xg5QPrEBXC8tAW1IFnzjR6eoJ90JmCnFzerQJTLzIEHjA==" crossorigin="anonymous" media="print" onload="this.media='all'">
    

    
    
    
    
      
      
    
    
    

    
    
    
      
    
    
      
      
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.2.1/build/styles/dracula.min.css" crossorigin="anonymous" title="hl-light" media="print" onload="this.media='all'">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.2.1/build/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" media="print" onload="this.media='all'" disabled>
      
    

    
    
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.7.1/dist/leaflet.min.css" integrity="" crossorigin="anonymous" media="print" onload="this.media='all'">
    

    

    
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      
        
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
  

  
  
  
  
  
  <link rel="stylesheet" href="/css/wowchemy.b48d89910a3f8560bb2d78fedea8d682.css" />

  




<script async src="https://www.googletagmanager.com/gtag/js?id=UA-27463794-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];

  function gtag() {
      dataLayer.push(arguments);
  }

  function trackOutboundLink(url, target) {
    gtag('event', 'click', {
         'event_category': 'outbound',
         'event_label': url,
         'transport_type': 'beacon',
         'event_callback': function () {
           if (target !== '_blank') {
             document.location = url;
           }
         }
    });
    console.debug("Outbound link clicked: " + url);
  }

  function onClickCallback(event) {
    if ((event.target.tagName !== 'A') || (event.target.host === window.location.host)) {
      return;
    }
    trackOutboundLink(event.target, event.target.getAttribute('target'));  
  }

  gtag('js', new Date());
  gtag('config', 'UA-27463794-2', {});
  gtag('set', {'cookie_flags': 'SameSite=None;Secure'});

  
  document.addEventListener('click', onClickCallback, false);
</script>


  

  

  




  
  
  

  

  
    <link rel="manifest" href="/en/manifest.webmanifest" />
  

  <link rel="icon" type="image/png" href="/media/icon_hu27cb63416a395b8c8d0d7112b85e26a9_17299_32x32_fill_lanczos_center_3.png" />
  <link rel="apple-touch-icon" type="image/png" href="/media/icon_hu27cb63416a395b8c8d0d7112b85e26a9_17299_180x180_fill_lanczos_center_3.png" />

  <link rel="canonical" href="https://dominicroye.github.io/en/2019/visualize-monthly-precipitation-anomalies/" />

  
  
  
  
  
  
  
  
    
  
  

  
  
    
    
  
  <meta property="twitter:card" content="summary_large_image" />
  
    <meta property="twitter:site" content="@@dr_xeo" />
    <meta property="twitter:creator" content="@@dr_xeo" />
  
  <meta property="og:site_name" content="Dr. Dominic Royé" />
  <meta property="og:url" content="https://dominicroye.github.io/en/2019/visualize-monthly-precipitation-anomalies/" />
  <meta property="og:title" content="Visualize monthly precipitation anomalies | Dr. Dominic Royé" />
  <meta property="og:description" content="Normally when we visualize monthly precipitation anomalies, we simply use a bar graph indicating negative and positive values with red and blue. However, it does not explain the general context of these anomalies. For example, what was the highest or lowest anomaly in each month? In principle, we could use a *boxplot* to visualize the distribution of the anomalies, but in this particular case they would not fit aesthetically, so we should look for an alternative. Here I present a very useful graphic form." /><meta property="og:image" content="https://dominicroye.github.io/en/2019/visualize-monthly-precipitation-anomalies/featured.png" />
    <meta property="twitter:image" content="https://dominicroye.github.io/en/2019/visualize-monthly-precipitation-anomalies/featured.png" /><meta property="og:locale" content="en-us" />
  
    
      <meta
        property="article:published_time"
        content="2019-07-07T00:00:00&#43;00:00"
      />
    
    <meta property="article:modified_time" content="2019-07-07T00:00:00&#43;00:00">
  

  


    






  




<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://dominicroye.github.io/en/2019/visualize-monthly-precipitation-anomalies/"
  },
  "headline": "Visualize monthly precipitation anomalies",
  
  "image": [
    "https://dominicroye.github.io/en/2019/visualize-monthly-precipitation-anomalies/featured.png"
  ],
  
  "datePublished": "2019-07-07T00:00:00Z",
  "dateModified": "2019-07-07T00:00:00Z",
  
  "author": {
    "@type": "Person",
    "name": "Dr. Dominic Royé"
  },
  
  "publisher": {
    "@type": "Organization",
    "name": "University of Santiago de Compostela",
    "logo": {
      "@type": "ImageObject",
      "url": "https://dominicroye.github.io/media/logo_hu6637600e1c36fe7812a10a6623aaebda_116520_192x192_fit_lanczos_3.png"
    }
  },
  "description": "Normally when we visualize monthly precipitation anomalies, we simply use a bar graph indicating negative and positive values with red and blue. However, it does not explain the general context of these anomalies. For example, what was the highest or lowest anomaly in each month? In principle, we could use a *boxplot* to visualize the distribution of the anomalies, but in this particular case they would not fit aesthetically, so we should look for an alternative. Here I present a very useful graphic form."
}
</script>

  

  

  

  





  <title>Visualize monthly precipitation anomalies | Dr. Dominic Royé</title>
</head>


<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" class="page-wrapper   " data-wc-page-id="280e92215b675beff1eedf9a9cc4df0c" >

  
  
  
  
  
  
  
  
  
  <script src="/js/wowchemy-init.min.2da3b1fa37e894630bf6de39b1b694b3.js"></script>

  




  <div class="page-header">
    







 



  


<header class="header--fixed">
  <nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
    <div class="container-xl">

      
      <div class="d-none d-lg-inline-flex">
        <a class="navbar-brand" href="/en/"><img src="/media/logo_hu6637600e1c36fe7812a10a6623aaebda_116520_0x70_resize_lanczos_3.png" alt="Dr. Dominic Royé"
            
            >
             <div style = "padding-top:0.5em;">Dr. Dominic Royé</div></a>
      </div>
      

      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar-content" aria-controls="navbar-content" aria-expanded="false" aria-label="Toggle navigation">
      <span><i class="fas fa-bars"></i></span>
      </button>
      

      
      <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
        <a class="navbar-brand" href="/en/"><img src="/media/logo_hu6637600e1c36fe7812a10a6623aaebda_116520_0x70_resize_lanczos_3.png" alt="Dr. Dominic Royé"
          
          ></a>
      </div>
      

      
      
      <div class="navbar-collapse main-menu-item collapse justify-content-end" id="navbar-content">

        
        <ul class="navbar-nav d-md-inline-flex">
          

          

          
          
          

          

          
          
          
          

          
            
            
          

          <li class="nav-item">
            <a class="nav-link " href="/en/#"><span>home</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/en/#posts"><span>blog</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/en/#featured"><span>publications</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/en/#projects"><span>graphs</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/en/#about"><span>me</span></a>
          </li>

          
          

        

          
        </ul>
      </div>

      <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">

        
        
          
            
            <li class="nav-item d-none d-lg-inline-flex">
              <a class="nav-link" href="https://twitter.com/dr_xeo" data-toggle="tooltip" data-placement="bottom" title="Follow me on Twitter" target="_blank" rel="noopener" aria-label="Follow me on Twitter">
                <i class="fab fa-twitter" aria-hidden="true"></i>
              </a>
            </li>
          
        

        
        

        
        

        
        

      </ul>

    </div>
  </nav>
</header>


  </div>

  <div class="page-body">
    <article class="article">

  




















  
  
    
  


<div class="article-container pt-3">
  <h1>Visualize monthly precipitation anomalies</h1>

  

  


<div class="article-metadata">

  
  

  
  <span class="article-date">
    
    
      
    
    2019-07-07
  </span>
  

  

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    10 min read
  </span>
  

  
  
  
  
  
  

  
  
  <span class="middot-divider"></span>
  <span class="article-categories">
    <i class="fas fa-folder mr-1"></i><a href="/en/category/visualization/">visualization</a>, <a href="/en/category/r/">R</a>, <a href="/en/category/rintermediate/">R:intermediate</a></span>
  

</div>

  





</div>


<div class="article-header article-container featured-image-wrapper mt-4 mb-4" style="max-width: 720px; max-height: 373px;">
  <div style="position: relative">
    <img src="/en/2019/visualize-monthly-precipitation-anomalies/featured_hu270b7df5c7d8474a74ad480372608501_84861_720x0_resize_lanczos_3.png" width="720" height="373" alt="" class="featured-image">
    
  </div>
</div>



  <div class="article-container">

    <div class="article-style">
      
<script src="https://dominicroye.github.io/en/2019/visualize-monthly-precipitation-anomalies/index.en_files/header-attrs/header-attrs.js"></script>


<p>Normally when we visualize monthly precipitation anomalies, we simply use a bar graph indicating negative and positive values with red and blue. However, it does not explain the general context of these anomalies. For example, what was the highest or lowest anomaly in each month? In principle, we could use a <em>boxplot</em> to visualize the distribution of the anomalies, but in this particular case they would not fit aesthetically, so we should look for an alternative. Here I present a very useful graphic form.</p>
<div id="packages" class="section level2">
<h2>Packages</h2>
<p>In this post we will use the following packages:</p>
<table>
<colgroup>
<col width="10%" />
<col width="89%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Package</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">tidyverse</td>
<td align="left">Collection of packages (visualization, manipulation): ggplot2, dplyr, purrr, etc.</td>
</tr>
<tr class="even">
<td align="left">readr</td>
<td align="left">Import data</td>
</tr>
<tr class="odd">
<td align="left">ggthemes</td>
<td align="left">Themes for ggplot2</td>
</tr>
<tr class="even">
<td align="left">lubridate</td>
<td align="left">Easy manipulation of dates and times</td>
</tr>
<tr class="odd">
<td align="left">cowplot</td>
<td align="left">Easy creation of multiple graphics with ggplot2</td>
</tr>
</tbody>
</table>
<pre class="r"><code>#we install the packages if necessary
if(!require(&quot;tidyverse&quot;)) install.packages(&quot;tidyverse&quot;)
if(!require(&quot;ggthemes&quot;)) install.packages(&quot;broom&quot;)
if(!require(&quot;cowplot&quot;)) install.packages(&quot;cowplot&quot;)
if(!require(&quot;lubridate&quot;)) install.packages(&quot;lubridate&quot;)

#packages
library(tidyverse) #include readr
library(ggthemes)
library(cowplot)
library(lubridate)</code></pre>
</div>
<div id="preparing-the-data" class="section level2">
<h2>Preparing the data</h2>
<p>First we import the daily precipitation of the selected weather station (<a href="/files/RR_STAID001394.txt">download</a>). We will use data from Santiago de Compostela (Spain) accessible through <a href="https://eca.knmi.nl">ECA&amp;D</a>.</p>
<div id="step-1-import-the-data" class="section level3">
<h3>Step 1: import the data</h3>
<p>We not only import the data in <em>csv</em> format, but we also make the first changes. We skip the first 21 rows that contain information about the weather station. In addition, we convert the date to the <code>date</code> class and replace missing values (-9999) with <code>NA</code>. The precipitation is given in 0.1 mm, therefore, we must divide the values by 10. Then we select the columns <em>DATE</em> and <em>RR</em>, and rename them.</p>
<pre class="r"><code>data &lt;- read_csv(&quot;RR_STAID001394.txt&quot;, skip = 21) %&gt;%
             mutate(DATE = ymd(DATE), RR = ifelse(RR == -9999, NA, RR/10)) %&gt;%
               select(DATE:RR) %&gt;% 
             rename(date = DATE, pr = RR)</code></pre>
<pre><code>## Rows: 27606 Columns: 5
## -- Column specification --------------------------------------------------------
## Delimiter: &quot;,&quot;
## dbl (5): STAID, SOUID, DATE, RR, Q_RR
## 
## i Use `spec()` to retrieve the full column specification for this data.
## i Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<pre class="r"><code>data</code></pre>
<pre><code>## # A tibble: 27,606 x 2
##    date          pr
##    &lt;date&gt;     &lt;dbl&gt;
##  1 1943-11-01   0.6
##  2 1943-11-02   0  
##  3 1943-11-03   0  
##  4 1943-11-04   0  
##  5 1943-11-05   0  
##  6 1943-11-06   0  
##  7 1943-11-07   0  
##  8 1943-11-08   0  
##  9 1943-11-09   0  
## 10 1943-11-10   0  
## # ... with 27,596 more rows</code></pre>
</div>
<div id="step-2-creating-monthly-values" class="section level3">
<h3>Step 2: creating monthly values</h3>
<p>In the second step we calculate the monthly amounts of precipitation. To do this, a) we limit the period to the years after 1950, b) we add the month with its labels and the year as variables.</p>
<pre class="r"><code>data &lt;- mutate(data, mo = month(date, label = TRUE), yr = year(date)) %&gt;%
            filter(date &gt;= &quot;1950-01-01&quot;) %&gt;%
                group_by(yr, mo) %&gt;% 
                   summarise(prs = sum(pr, na.rm = TRUE))</code></pre>
<pre><code>## `summarise()` has grouped output by &#39;yr&#39;. You can override using the `.groups`
## argument.</code></pre>
<pre class="r"><code>data</code></pre>
<pre><code>## # A tibble: 833 x 3
## # Groups:   yr [70]
##       yr mo      prs
##    &lt;dbl&gt; &lt;ord&gt; &lt;dbl&gt;
##  1  1950 Jan    55.6
##  2  1950 Feb   349. 
##  3  1950 Mar    85.8
##  4  1950 Apr    33.4
##  5  1950 May   272. 
##  6  1950 Jun   111. 
##  7  1950 Jul    35.4
##  8  1950 Aug    76.4
##  9  1950 Sep    85  
## 10  1950 Oct    53  
## # ... with 823 more rows</code></pre>
</div>
<div id="step-3-estimating-anomalies" class="section level3">
<h3>Step 3: estimating anomalies</h3>
<p>Now we must estimate the normals of each month and join this table to our main data in order to calculate the monthly anomaly. We express the anomalies in percentage and subtract 100 to set the average to 0. In addition, we create a variable which indicates if the anomaly is negative or positive, and another with the date.</p>
<pre class="r"><code>pr_ref &lt;- filter(data, yr &gt; 1981, yr &lt;= 2010) %&gt;%
                   group_by(mo) %&gt;%
                      summarise(pr_ref = mean(prs))

data &lt;- left_join(data, pr_ref, by = &quot;mo&quot;)

data &lt;- mutate(data, 
               anom = (prs*100/pr_ref)-100, 
               date = str_c(yr, as.numeric(mo), 1, sep = &quot;-&quot;) %&gt;% ymd(),
               sign= ifelse(anom &gt; 0, &quot;pos&quot;, &quot;neg&quot;) %&gt;% factor(c(&quot;pos&quot;, &quot;neg&quot;)))</code></pre>
<p>We can do a first test graph of anomalies (the classic one), for that we filter the year 2018. In this case we use a bar graph, remember that by default the function <code>geom_bar()</code> applies the counting of the variable. However, in this case we know <code>y</code>, hence we indicate with the argument <code>stat = "identity"</code> that it should use the given value in <code>aes()</code>.</p>
<pre class="r"><code>filter(data, yr == 2018) %&gt;%
   ggplot(aes(date, anom, fill = sign)) + 
       geom_bar(stat = &quot;identity&quot;, show.legend = FALSE) + 
    scale_x_date(date_breaks = &quot;month&quot;, date_labels = &quot;%b&quot;) +
    scale_y_continuous(breaks = seq(-100, 100, 20)) +
    scale_fill_manual(values = c(&quot;#99000d&quot;, &quot;#034e7b&quot;)) +
         labs(y = &quot;Precipitation anomaly (%)&quot;, x = &quot;&quot;) +
          theme_hc()</code></pre>
<p><img src="https://dominicroye.github.io/en/2019/visualize-monthly-precipitation-anomalies/index.en_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
</div>
<div id="step-4-calculating-the-statistical-metrics" class="section level3">
<h3>Step 4: calculating the statistical metrics</h3>
<p>In this last step we estimate the maximum, minimum value, the 25%/75% quantiles and the interquartile range per month of the entire time series.</p>
<pre class="r"><code>data_norm &lt;-     group_by(data, mo) %&gt;%
                     summarise(mx = max(anom),
                               min = min(anom),
                               q25 = quantile(anom, .25),
                               q75 = quantile(anom, .75),
                               iqr = q75-q25)
data_norm</code></pre>
<pre><code>## # A tibble: 12 x 6
##    mo       mx    min   q25   q75   iqr
##    &lt;ord&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 Jan    193.  -89.6 -43.6 56.3   99.9
##  2 Feb    320.  -96.5 -51.2 77.7  129. 
##  3 Mar    381. -100   -40.6 88.2  129. 
##  4 Apr    198.  -93.6 -51.2 17.1   68.3
##  5 May    141.  -90.1 -45.2 17.0   62.2
##  6 Jun    419.  -99.3 -58.2 50.0  108. 
##  7 Jul    311.  -98.2 -77.3 27.1  104. 
##  8 Aug    264. -100   -68.2 39.8  108. 
##  9 Sep    241.  -99.2 -64.9 48.6  113. 
## 10 Oct    220.  -99.0 -54.5  4.69  59.2
## 11 Nov    137.  -98.8 -44.0 39.7   83.7
## 12 Dec    245.  -91.8 -49.8 36.0   85.8</code></pre>
</div>
</div>
<div id="creating-the-graph" class="section level2">
<h2>Creating the graph</h2>
<p>To create the anomaly graph with legend it is necessary to separate the main graph from the legends.</p>
<div id="part-1" class="section level3">
<h3>Part 1</h3>
<p>In this first part we are adding layer by layer the different elements: 1) the range of anomalies maximum-minimum 2) the interquartile range and 3) the anomalies of the year 2018.</p>
<pre class="r"><code>#range of anomalies maximum-minimum
g1.1 &lt;- ggplot(data_norm)+
           geom_crossbar(aes(x = mo, y = 0, ymin = min, ymax = mx),
                        fatten = 0, fill = &quot;grey90&quot;, colour = &quot;NA&quot;)

g1.1</code></pre>
<p><img src="https://dominicroye.github.io/en/2019/visualize-monthly-precipitation-anomalies/index.en_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<pre class="r"><code>#adding interquartile range
g1.2 &lt;- g1.1 + geom_crossbar(aes(x = mo, y = 0, ymin = q25, ymax = q75),
                              fatten = 0, fill = &quot;grey70&quot;)

g1.2</code></pre>
<p><img src="https://dominicroye.github.io/en/2019/visualize-monthly-precipitation-anomalies/index.en_files/figure-html/unnamed-chunk-9-2.png" width="672" /></p>
<pre class="r"><code>#adding anomalies of the year 2018 

g1.3 &lt;- g1.2 + geom_crossbar(data = filter(data, yr == 2018),
                aes(x = mo, y = 0, ymin = 0, ymax = anom, fill = sign),
                fatten = 0, width = 0.7, alpha = .7, colour = &quot;NA&quot;,
                show.legend = FALSE)
g1.3</code></pre>
<p><img src="https://dominicroye.github.io/en/2019/visualize-monthly-precipitation-anomalies/index.en_files/figure-html/unnamed-chunk-9-3.png" width="672" /></p>
<p>Finally we change some last style settings.</p>
<pre class="r"><code>g1 &lt;- g1.3 + geom_hline(yintercept = 0)+
               scale_fill_manual(values=c(&quot;#99000d&quot;,&quot;#034e7b&quot;))+
               scale_y_continuous(&quot;Precipitation anomaly (%)&quot;,
                                   breaks = seq(-100, 500, 25),
                                   expand = c(0, 5))+
            labs(x = &quot;&quot;,
                 title = &quot;Precipitation anomaly in Santiago de Compostela 2018&quot;,
                 caption=&quot;Dominic Royé (@dr_xeo) | Data: eca.knmi.nl&quot;)+
            theme_hc()
g1</code></pre>
<p><img src="https://dominicroye.github.io/en/2019/visualize-monthly-precipitation-anomalies/index.en_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
</div>
<div id="part-2" class="section level3">
<h3>Part 2</h3>
<p>We still need a legend. First we create it for the normals.</p>
<pre class="r"><code>#legend data
legend &lt;- filter(data_norm, mo == &quot;Jan&quot;)

legend_lab &lt;- gather(legend, stat, y, mx:q75) %&gt;%
                 mutate(stat = factor(stat, stat, c(&quot;maximum&quot;,
                                                   &quot;minimum&quot;,
                                                   &quot;Quantile 25%&quot;,
                                                   &quot;Quantile 75%&quot;)) %&gt;%
                                            as.character())</code></pre>
<pre><code>## Warning: attributes are not identical across measure variables;
## they will be dropped</code></pre>
<pre class="r"><code>#legend graph
g2 &lt;- legend %&gt;% ggplot()+
                  geom_crossbar(aes(x = mo, y = 0, ymin = min, ymax = mx),
                                fatten = 0, fill = &quot;grey90&quot;, colour = &quot;NA&quot;, width = 0.2) +
                  geom_crossbar(aes(x = mo, y = 0, ymin = q25, ymax = q75),
                                fatten = 0, fill = &quot;grey70&quot;, width = 0.2) +
                  geom_text(data = legend_lab, 
                            aes(x = mo, y = y+c(12,-8,-10,12), label = stat), 
                            fontface = &quot;bold&quot;, size = 2) +
                   annotate(&quot;text&quot;, x = 1.18, y = 40, 
                            label = &quot;Period 1950-2018&quot;, angle = 90, size = 3) +
              theme_void() + 
                theme(plot.margin = unit(c(0, 0, 0, 0), &quot;cm&quot;))

g2</code></pre>
<p><img src="https://dominicroye.github.io/en/2019/visualize-monthly-precipitation-anomalies/index.en_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<p>Second, we create another legend for the current anomalies.</p>
<pre class="r"><code>#legend data
legend2 &lt;- filter(data, yr == 1950, mo %in% c(&quot;Jan&quot;,&quot;Feb&quot;)) %&gt;% 
              ungroup() %&gt;% 
            select(mo, anom, sign)

legend2[2,1] &lt;- &quot;Jan&quot;

legend_lab2 &lt;- data.frame(mo = rep(&quot;Jan&quot;, 3), 
                          anom= c(110, 3, -70), 
                          label = c(&quot;Positive anomaly&quot;, &quot;Average&quot;, &quot;Negative anomaly&quot;))

#legend graph
g3 &lt;-  ggplot() + 
         geom_bar(data = legend2,
                aes(x = mo, y = anom, fill = sign),
                   alpha = .6, colour = &quot;NA&quot;, stat = &quot;identity&quot;, show.legend = FALSE, width = 0.2) +
         geom_segment(aes(x = .85, y = 0, xend = 1.15, yend = 0), linetype = &quot;dashed&quot;) +
         geom_text(data = legend_lab2, 
                   aes(x = mo, y = anom+c(10,5,-13), label = label), 
                   fontface = &quot;bold&quot;, size = 2) +
         annotate(&quot;text&quot;, x = 1.25, y = 20, 
                  label =&quot;Reference 1971-2010&quot;, angle = 90, size = 3) +
         scale_fill_manual(values = c(&quot;#99000d&quot;, &quot;#034e7b&quot;)) +
        theme_void() +
         theme(plot.margin = unit(c(0, 0, 0, 0), &quot;cm&quot;))

g3</code></pre>
<p><img src="https://dominicroye.github.io/en/2019/visualize-monthly-precipitation-anomalies/index.en_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
</div>
<div id="part-3" class="section level3">
<h3>Part 3</h3>
<p>Finally, we only have to join the graph and the legends with the help of the <code>cowplot</code> package. The main function of <code>cowplot</code> is <code>plot_grid()</code> which is used for combining different graphs. However, in this case it is necessary to use more flexible functions to create less common formats. The <code>ggdraw()</code> function configures the basic layer of the graph, and the functions that are intended to operate on this layer start with <code>draw_*</code>.</p>
<pre class="r"><code>p &lt;- ggdraw() +
       draw_plot(g1, x = 0, y = .3, width = 1, height = 0.6) +
       draw_plot(g2, x = 0, y = .15, width = .2, height = .15) +
       draw_plot(g3, x = 0.08, y = .15, width = .2, height = .15)

p</code></pre>
<p><img src="https://dominicroye.github.io/en/2019/visualize-monthly-precipitation-anomalies/index.en_files/figure-html/unnamed-chunk-13-1.png" width="3729" /></p>
<pre class="r"><code>save_plot(&quot;pr_anomaly2016_scq.png&quot;, p, dpi = 300, base_width = 12.43, base_height = 8.42)</code></pre>
</div>
</div>
<div id="multiple-facets" class="section level2">
<h2>Multiple facets</h2>
<p>In this section we will make the same graph as in the previous one, but for several years.</p>
<div id="part-1-1" class="section level3">
<h3>Part 1</h3>
<p>First we need to filter again by set of years, in this case from 2016 to 2018, using the operator <code>%in%</code>, we also add the function <code>facet_grid()</code> to <code>ggplot</code>, which allows us to plot the graph according to a variable. The formula used for the facet function is similar to the use in models: <code>variable_by_row ~ variable_by_column</code>. When we do not have a variable in the column, we should use the <code>.</code>.</p>
<pre class="r"><code>#range of anomalies maximum-minimum
g1.1 &lt;- ggplot(data_norm)+
           geom_crossbar(aes(x = mo, y = 0, ymin = min, ymax = mx),
                        fatten = 0, fill = &quot;grey90&quot;, colour = &quot;NA&quot;)

g1.1</code></pre>
<p><img src="https://dominicroye.github.io/en/2019/visualize-monthly-precipitation-anomalies/index.en_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
<pre class="r"><code>#adding the interquartile range
g1.2 &lt;- g1.1 + geom_crossbar(aes(x = mo, y = 0, ymin = q25, ymax = q75),
                              fatten = 0, fill = &quot;grey70&quot;)

g1.2</code></pre>
<p><img src="https://dominicroye.github.io/en/2019/visualize-monthly-precipitation-anomalies/index.en_files/figure-html/unnamed-chunk-14-2.png" width="672" /></p>
<pre class="r"><code>#adding the anomalies of the year 2016-2018

g1.3 &lt;- g1.2 + geom_crossbar(data = filter(data, yr %in% 2016:2018),
                aes(x = mo, y = 0, ymin = 0, ymax = anom, fill = sign),
                fatten = 0, width = 0.7, alpha = .7, colour = &quot;NA&quot;,
                show.legend = FALSE) +
               facet_grid(yr ~ .)
g1.3</code></pre>
<p><img src="https://dominicroye.github.io/en/2019/visualize-monthly-precipitation-anomalies/index.en_files/figure-html/unnamed-chunk-14-3.png" width="672" /></p>
<p>Finally we change some last style settings.</p>
<pre class="r"><code>g1 &lt;- g1.3 + geom_hline(yintercept = 0)+
               scale_fill_manual(values=c(&quot;#99000d&quot;,&quot;#034e7b&quot;))+
               scale_y_continuous(&quot;Anomalía de precipitación (%)&quot;,
                                   breaks = seq(-100, 500, 50),
                                   expand = c(0, 5))+
            labs(x = &quot;&quot;,
                 title = &quot;Anomalía de precipitación en Santiago de Compostela&quot;,
                 caption=&quot;Dominic Royé (@dr_xeo) | Datos: eca.knmi.nl&quot;)+
            theme_hc()
g1</code></pre>
<p><img src="https://dominicroye.github.io/en/2019/visualize-monthly-precipitation-anomalies/index.en_files/figure-html/unnamed-chunk-15-1.png" width="3729" /></p>
<p>We use the same legend created for the previous graph.</p>
</div>
</div>
<div id="part-2-1" class="section level2">
<h2>Part 2</h2>
<p>Finally, we join the graph and the legends with the help of the <code>cowplot</code> package. The only thing we must adjust here are the arguments in the <code>draw_plot()</code> function to correctly place the different parts.</p>
<pre class="r"><code>p &lt;- ggdraw() +
       draw_plot(g1, x = 0, y = .18, width = 1, height = 0.8) +
       draw_plot(g2, x = 0, y = .08, width = .2, height = .15) +
       draw_plot(g3, x = 0.08, y = .08, width = .2, height = .15)

p</code></pre>
<p><img src="https://dominicroye.github.io/en/2019/visualize-monthly-precipitation-anomalies/index.en_files/figure-html/unnamed-chunk-16-1.png" width="3729" /></p>
<pre class="r"><code>save_plot(&quot;pr_anomaly20162018_scq.png&quot;, p, dpi = 300, base_width = 12.43, base_height = 8.42)</code></pre>
<p><a href="https://www.buymeacoffee.com/drxeo" target="_blank"><img src="https://cdn.buymeacoffee.com/buttons/default-orange.png" alt="Buy Me A Coffee" height="41" width="174"></a></p>
</div>

    </div>

    






<div class="article-tags">
  
  <a class="badge badge-light" href="/en/tag/anomalies/">anomalies</a>
  
  <a class="badge badge-light" href="/en/tag/precipitation/">precipitation</a>
  
  <a class="badge badge-light" href="/en/tag/climate/">climate</a>
  
  <a class="badge badge-light" href="/en/tag/boxplot/">boxplot</a>
  
</div>



<div class="share-box">
  <ul class="share">
    
      
      
      
        
      
      
      
      <li>
        <a href="https://twitter.com/intent/tweet?url=https://dominicroye.github.io/en/2019/visualize-monthly-precipitation-anomalies/&amp;text=Visualize%20monthly%20precipitation%20anomalies" target="_blank" rel="noopener" class="share-btn-twitter" aria-label="twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.facebook.com/sharer.php?u=https://dominicroye.github.io/en/2019/visualize-monthly-precipitation-anomalies/&amp;t=Visualize%20monthly%20precipitation%20anomalies" target="_blank" rel="noopener" class="share-btn-facebook" aria-label="facebook">
          <i class="fab fa-facebook"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="mailto:?subject=Visualize%20monthly%20precipitation%20anomalies&amp;body=https://dominicroye.github.io/en/2019/visualize-monthly-precipitation-anomalies/" target="_blank" rel="noopener" class="share-btn-email" aria-label="envelope">
          <i class="fas fa-envelope"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.linkedin.com/shareArticle?url=https://dominicroye.github.io/en/2019/visualize-monthly-precipitation-anomalies/&amp;title=Visualize%20monthly%20precipitation%20anomalies" target="_blank" rel="noopener" class="share-btn-linkedin" aria-label="linkedin-in">
          <i class="fab fa-linkedin-in"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="whatsapp://send?text=Visualize%20monthly%20precipitation%20anomalies%20https://dominicroye.github.io/en/2019/visualize-monthly-precipitation-anomalies/" target="_blank" rel="noopener" class="share-btn-whatsapp" aria-label="whatsapp">
          <i class="fab fa-whatsapp"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://service.weibo.com/share/share.php?url=https://dominicroye.github.io/en/2019/visualize-monthly-precipitation-anomalies/&amp;title=Visualize%20monthly%20precipitation%20anomalies" target="_blank" rel="noopener" class="share-btn-weibo" aria-label="weibo">
          <i class="fab fa-weibo"></i>
        </a>
      </li>
    
  </ul>
</div>











  
  



  
  
  
    
  
  
  
  <div class="media author-card content-widget-hr">
    
      
      <a href="https://dominicroye.github.io/"><img class="avatar mr-3 avatar-circle" src="/en/author/dr.-dominic-roye/avatar_hu930bec32484cd86675af8880de95caa2_508993_270x270_fill_q75_lanczos_center.jpg" alt="Dr. Dominic Royé"></a>
    

    <div class="media-body">
      <h5 class="card-title"><a href="https://dominicroye.github.io/">Dr. Dominic Royé</a></h5>
      <h6 class="card-subtitle">Senior postdoctoral researcher</h6>
      
      <ul class="network-icon" aria-hidden="true">
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://twitter.com/dr_xeo" target="_blank" rel="noopener">
        <i class="fab fa-twitter"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="/en/#contact" >
        <i class="fas fa-envelope"></i>
      </a>
    </li>
  
    
    
    
    
    
    
    
      
    
    <li>
      <a href="https://scholar.google.es/citations?user=EoYa8jUAAAAJ&amp;hl=es" target="_blank" rel="noopener">
        <i class="ai ai-google-scholar"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://github.com/dominicroye" target="_blank" rel="noopener">
        <i class="fab fa-github"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://www.linkedin.com/in/dominicroye/" target="_blank" rel="noopener">
        <i class="fab fa-linkedin"></i>
      </a>
    </li>
  
    
    
    
    
    
    
    
      
    
    <li>
      <a href="https://www.researchgate.net/profile/Dominic_Roye" target="_blank" rel="noopener">
        <i class="ai ai-researchgate"></i>
      </a>
    </li>
  
</ul>

    </div>
  </div>
















  
  
  <div class="article-widget content-widget-hr">
    <h3>Related</h3>
    <ul>
      
      <li><a href="/en/2020/visualize-climate-anomalies/">Visualize climate anomalies</a></li>
      
      <li><a href="/en/2020/a-heatmap-as-calendar/">A heatmap as calendar</a></li>
      
      <li><a href="/en/2021/climate-circles/">Climate circles</a></li>
      
      <li><a href="/en/2021/visualize-the-day-night-cycle-on-a-world-map/">Visualize the day-night cycle on a world map</a></li>
      
      <li><a href="/en/2021/firefly-cartography/">Firefly cartography</a></li>
      
    </ul>
  </div>
  





  </div>
</article>
  </div>

  <div class="page-footer">
    
    
    <div class="container">
      <footer class="site-footer">

  



  

  

  
  <p class="powered-by">
    © 2018-2022 Dominic Royé. All rights reserved
  </p>
  

  
  






  <p class="powered-by">
    
    
    
      
      
      
      
      
      
      Published with <a href="https://wowchemy.com/?utm_campaign=poweredby" target="_blank" rel="noopener">Wowchemy</a> — the free, <a href="https://github.com/wowchemy/wowchemy-hugo-themes" target="_blank" rel="noopener">open source</a> website builder that empowers creators.
    
  </p>
</footer>

    </div>
    
  </div>

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

      

    
    <script src="/js/vendor-bundle.min.b73dfaac3b6499dc997741748a7c3fe2.js"></script>

    
    
    
      
      
        <script src="https://cdn.jsdelivr.net/gh/desandro/imagesloaded@v4.1.4/imagesloaded.pkgd.min.js" integrity="sha512-S5PZ9GxJZO16tT9r3WJp/Safn31eu8uWrzglMahDT4dsmgqWonRY9grk3j+3tfuPr9WJNsfooOR7Gi7HL5W2jw==" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/gh/metafizzy/isotope@v3.0.6/dist/isotope.pkgd.min.js" integrity="sha512-Zq2BOxyhvnRFXu0+WE6ojpZLOU2jdnqbrM1hmVdGzyeCa1DgM3X5Q4A/Is9xA1IkbUeDd7755dNNI/PzSf2Pew==" crossorigin="anonymous"></script>
      

      
      

      

      
        
        <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.2.1/build/highlight.min.js" integrity="sha512-Ypjm0o7jOxAd4hpdoppSEN0TQOC19UtPAqD+4s5AlXmUvbmmS/YMxYqAqarQYyxTnB6/rqip9qcxlNB/3U9Wdg==" crossorigin="anonymous"></script>
        
        
        <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.2.1/build/languages/r.min.js" crossorigin="anonymous"></script>
        
      

    

    
    
    
      <script src="https://cdn.jsdelivr.net/npm/leaflet@1.7.1/dist/leaflet.min.js" integrity="" crossorigin="anonymous"></script>
    

    
    

    
    
    

    
    

    
    
    
    

    
    

    
    
    
    
    
    
    
    
    
    <script src="/en/js/wowchemy.min.50d3bf3df0c53b31631bb48a62b35f92.js"></script>

    
  <script async defer src="https://buttons.github.io/buttons.js"></script>




</body>
</html>
