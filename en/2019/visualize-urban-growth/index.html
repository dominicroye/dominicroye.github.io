<!DOCTYPE html>
<html lang="en-us">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 3.2.0">
  <meta name="generator" content="Hugo 0.53" />
  <meta name="author" content="Dr. Dominic Royé">

  
  
  
  
    
  
  <meta name="description" content="The General Directorate for the Cadastre of Spain has spatial information of the all buildings except for the Basque Country and Navarra. This data set is part of the implementation of [INSPIRE](https://inspire.ec.europa.eu/), the Space Information Infrastructure in Europe. More information can be found [here](http://www.catastro.meh.es/webinspire/index.html). We will use the links (*urls*) in *ATOM* format, which is an RSS type for web feeds, allowing us to obtain the download links for each municipality.">

  
  <link rel="alternate" hreflang="en-us" href="https://dominicroye.github.io/en/2019/visualize-urban-growth/">

  


  

  

  

  

  

  

  
  
  
  <meta name="theme-color" content="#2962ff">
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha256-eSi1q2PG6J7g7ib17yAaWMcrr5GrtohYChqibrV7PBE=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.0/css/all.css" integrity="sha384-aOkxzJ5uQz7WBObEZcHvV5JvRW3TUc2rNPA7pe3AwnsUohiw1Vj2Rgx2KSOkF5+h" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" integrity="sha256-ygkqlh3CYSUri3LhQxzdcm0n1EQvH2Y+U5S2idbLtxs=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/dracula.min.css" crossorigin="anonymous">
      
    

    

    

  

  
  

  <link rel="stylesheet" href="/en/styles.css">
  
  <link rel="stylesheet" href="/css/override.css">
  

  
  
    <script>
      window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
      ga('create', 'UA-27463794-2', 'auto');
      ga('set', 'anonymizeIp', true);
      ga('require', 'eventTracker');
      ga('require', 'outboundLinkTracker');
      ga('require', 'urlChangeTracker');
      ga('send', 'pageview');
    </script>
    <script async src="//www.google-analytics.com/analytics.js"></script>
    
    <script async src="https://cdnjs.cloudflare.com/ajax/libs/autotrack/2.4.1/autotrack.js" integrity="sha512-HUmooslVKj4m6OBu0OgzjXXr+QuFYy/k7eLI5jdeEy/F4RSgMn6XRWRGkFi5IFaFgy7uFTkegp3Z0XnJf3Jq+g==" crossorigin="anonymous"></script>
    
  
  

  
  <link rel="alternate" href="https://dominicroye.github.io/index.xml" type="application/rss+xml" title="Dominic Royé">
  <link rel="feed" href="https://dominicroye.github.io/index.xml" type="application/rss+xml" title="Dominic Royé">
  

  <link rel="manifest" href="/site.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="https://dominicroye.github.io/en/2019/visualize-urban-growth/">

  
  
  
  
    
  
  <meta property="twitter:card" content="summary_large_image">
  
  <meta property="og:site_name" content="Dominic Royé">
  <meta property="og:url" content="https://dominicroye.github.io/en/2019/visualize-urban-growth/">
  <meta property="og:title" content="Visualize urban growth | Dominic Royé">
  <meta property="og:description" content="The General Directorate for the Cadastre of Spain has spatial information of the all buildings except for the Basque Country and Navarra. This data set is part of the implementation of [INSPIRE](https://inspire.ec.europa.eu/), the Space Information Infrastructure in Europe. More information can be found [here](http://www.catastro.meh.es/webinspire/index.html). We will use the links (*urls*) in *ATOM* format, which is an RSS type for web feeds, allowing us to obtain the download links for each municipality."><meta property="og:image" content="https://dominicroye.github.io/en/2019/visualize-urban-growth/featured.png">
  <meta property="og:locale" content="en-us">
  
  <meta property="article:published_time" content="2019-11-01T00:00:00&#43;00:00">
  
  <meta property="article:modified_time" content="2019-11-01T00:00:00&#43;00:00">
  

  

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.0.3/cookieconsent.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.0.3/cookieconsent.min.js"></script>
<script>
  window.addEventListener("load", function(){
    window.cookieconsent.initialise({
      "palette": {
        "popup": {
          "background": "#2962ff",
          "text": "#fff"
        },
        "button": {
          "background": "#fff",
          "text": "#2962ff"
        }
      },
      "theme": "classic",
      "content": {
        "message": "This website uses cookies to ensure you get the best experience on our website.",
        "dismiss": "Got it!",
        "link": "Learn more",
        "href": "https://cookies.insites.com"
      }
    })});
</script>


  

  <title>Visualize urban growth | Dominic Royé</title>

</head>
<body id="top" data-spy="scroll" data-target="#TableOfContents" data-offset="71" >
  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>

<nav class="navbar navbar-light fixed-top navbar-expand-lg py-0" id="navbar-main">
  <div class="container">

    
      <a class="navbar-brand" href="/en/"><div style="position:relative;float:left">Dominic Royé<img src="/img/portrait.jpg" alt="Dominic Royé" style="float: left;"></div></a>
      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
        <span><i class="fas fa-bars"></i></span>
      </button>
      

    
    <div class="collapse navbar-collapse" id="navbar">

      
      
      <ul class="navbar-nav ml-auto">
        

        

        
        
        

        <li class="nav-item">
          <a class="nav-link" href="/en/#">
            
            <span>home</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/en/#posts">
            
            <span>blog</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/en/#publications_selected">
            
            <span>publications</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/en/#graphs">
            
            <span>graphs</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/en/#teaching">
            
            <span>more</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/en/#about">
            
            <span>me</span>
            
          </a>
        </li>

        
        

      

        

        

        

        

      </ul>

    </div>
  </div>
</nav>


<article class="article" itemscope itemtype="http://schema.org/Article">

  













<div class="article-header d-xl-none">
  <div class="featured-image" style="background-image: url('/en/2019/visualize-urban-growth/featured_hu654caca59e40d7b6b365bd862bfa13ef_998521_800x0_resize_box_2.png');"></div>
  
</div>


<div class="container-fluid split-header d-none d-xl-block">
  <div class="row">
    <div class="col-6">
      <div class="split-header-content">
        <h1 itemprop="name">Visualize urban growth</h1>

        

        

<div class="article-metadata">

  
  
  <span itemscope itemprop="author" itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Dr. Dominic Royé">
  </span>
  

  <span class="article-date">
    
    <meta content="2019-11-01 00:00:00 &#43;0000 UTC" itemprop="datePublished">
    <time datetime="2019-11-01 00:00:00 &#43;0000 UTC" itemprop="dateModified">
      2019-11-01
    </time>
  </span>
  <span itemscope itemprop="publisher" itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Dr. Dominic Royé">
  </span>

  

  
  
  <span class="middot-divider"></span>
  <a href="/en/2019/visualize-urban-growth/#disqus_thread"></a>
  

  
  
  
  <span class="middot-divider"></span>
  <span class="article-categories">
    <i class="fas fa-folder"></i>
    
    <a href="/en/categories/visualization/">visualization</a>, 
    
    <a href="/en/categories/r/">R</a>, 
    
    <a href="/en/categories/relementary/">R:elementary</a>, 
    
    <a href="/en/categories/gis/">gis</a>
    
  </span>
  
  

  

</div>


        







  










        
<div class="share-box" aria-hidden="true">
  <ul class="share">
    <li>
      <a class="twitter"
         href="https://twitter.com/intent/tweet?text=Visualize%20urban%20growth&amp;url=https%3a%2f%2fdominicroye.github.io%2fen%2f2019%2fvisualize-urban-growth%2f"
         target="_blank" rel="noopener">
        <i class="fab fa-twitter"></i>
      </a>
    </li>
    <li>
      <a class="facebook"
         href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fdominicroye.github.io%2fen%2f2019%2fvisualize-urban-growth%2f"
         target="_blank" rel="noopener">
        <i class="fab fa-facebook-f"></i>
      </a>
    </li>
    <li>
      <a class="linkedin"
         href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fdominicroye.github.io%2fen%2f2019%2fvisualize-urban-growth%2f&amp;title=Visualize%20urban%20growth"
         target="_blank" rel="noopener">
        <i class="fab fa-linkedin-in"></i>
      </a>
    </li>
    <li>
      <a class="weibo"
         href="http://service.weibo.com/share/share.php?url=https%3a%2f%2fdominicroye.github.io%2fen%2f2019%2fvisualize-urban-growth%2f&amp;title=Visualize%20urban%20growth"
         target="_blank" rel="noopener">
        <i class="fab fa-weibo"></i>
      </a>
    </li>
    <li>
      <a class="email"
         href="mailto:?subject=Visualize%20urban%20growth&amp;body=https%3a%2f%2fdominicroye.github.io%2fen%2f2019%2fvisualize-urban-growth%2f">
        <i class="fas fa-envelope"></i>
      </a>
    </li>
  </ul>
</div>


      </div>
    </div>
    <div class="col-6">
      <div class="split-header-image">
        <img src="/en/2019/visualize-urban-growth/featured_hu654caca59e40d7b6b365bd862bfa13ef_998521_680x500_fill_q90_box_smart1_2.png" itemprop="image" alt="">
        
      </div>
    </div>
  </div>
</div>

<div class="article-container d-xl-none">
  <h1 itemprop="name">Visualize urban growth</h1>

  

  

<div class="article-metadata">

  
  
  <span itemscope itemprop="author" itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Dr. Dominic Royé">
  </span>
  

  <span class="article-date">
    
    <meta content="2019-11-01 00:00:00 &#43;0000 UTC" itemprop="datePublished">
    <time datetime="2019-11-01 00:00:00 &#43;0000 UTC" itemprop="dateModified">
      2019-11-01
    </time>
  </span>
  <span itemscope itemprop="publisher" itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Dr. Dominic Royé">
  </span>

  

  
  
  <span class="middot-divider"></span>
  <a href="/en/2019/visualize-urban-growth/#disqus_thread"></a>
  

  
  
  
  <span class="middot-divider"></span>
  <span class="article-categories">
    <i class="fas fa-folder"></i>
    
    <a href="/en/categories/visualization/">visualization</a>, 
    
    <a href="/en/categories/r/">R</a>, 
    
    <a href="/en/categories/relementary/">R:elementary</a>, 
    
    <a href="/en/categories/gis/">gis</a>
    
  </span>
  
  

  
  
<div class="share-box" aria-hidden="true">
  <ul class="share">
    <li>
      <a class="twitter"
         href="https://twitter.com/intent/tweet?text=Visualize%20urban%20growth&amp;url=https%3a%2f%2fdominicroye.github.io%2fen%2f2019%2fvisualize-urban-growth%2f"
         target="_blank" rel="noopener">
        <i class="fab fa-twitter"></i>
      </a>
    </li>
    <li>
      <a class="facebook"
         href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fdominicroye.github.io%2fen%2f2019%2fvisualize-urban-growth%2f"
         target="_blank" rel="noopener">
        <i class="fab fa-facebook-f"></i>
      </a>
    </li>
    <li>
      <a class="linkedin"
         href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fdominicroye.github.io%2fen%2f2019%2fvisualize-urban-growth%2f&amp;title=Visualize%20urban%20growth"
         target="_blank" rel="noopener">
        <i class="fab fa-linkedin-in"></i>
      </a>
    </li>
    <li>
      <a class="weibo"
         href="http://service.weibo.com/share/share.php?url=https%3a%2f%2fdominicroye.github.io%2fen%2f2019%2fvisualize-urban-growth%2f&amp;title=Visualize%20urban%20growth"
         target="_blank" rel="noopener">
        <i class="fab fa-weibo"></i>
      </a>
    </li>
    <li>
      <a class="email"
         href="mailto:?subject=Visualize%20urban%20growth&amp;body=https%3a%2f%2fdominicroye.github.io%2fen%2f2019%2fvisualize-urban-growth%2f">
        <i class="fas fa-envelope"></i>
      </a>
    </li>
  </ul>
</div>


  

</div>


  







  









</div>



  <div class="article-container">

    <div class="article-style" itemprop="articleBody">
      


<p>The General Directorate for the Cadastre of Spain has spatial information of the all buildings except for the Basque Country and Navarra. This data set is part of the implementation of <a href="https://inspire.ec.europa.eu/">INSPIRE</a>, the Space Information Infrastructure in Europe. More information can be found <a href="http://www.catastro.meh.es/webinspire/index.html">here</a>. We will use the links (<em>urls</em>) in <em>ATOM</em> format, which is an RSS type for web feeds, allowing us to obtain the download link for each municipality.</p>
<div class="alert alert-note">
  <p>This blog post is a reduced version of the case study that you can find in our recent publication - <a href="https://dominicroye.github.io/es/publication/manual_rgis_2019/">Introduction to GIS with R</a> - published by Dominic Royé and Roberto Serrano-Notivoli (in Spanish).</p>

</div>

<div id="packages" class="section level2">
<h2>Packages</h2>
<table>
<thead>
<tr class="header">
<th align="left">Package</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">tidyverse</td>
<td align="left">Collection of packages (visualization, manipulation): ggplot2, dplyr, purrr, etc.</td>
</tr>
<tr class="even">
<td align="left">sf</td>
<td align="left">Simple Feature: import, export and manipulate vector data</td>
</tr>
<tr class="odd">
<td align="left">fs</td>
<td align="left">Provides a cross-platform, uniform interface to file system operations</td>
</tr>
<tr class="even">
<td align="left">lubridate</td>
<td align="left">Easy manipulation of dates and times</td>
</tr>
<tr class="odd">
<td align="left">feedeR</td>
<td align="left">Import feeds RSS or ATOM</td>
</tr>
<tr class="even">
<td align="left">tmap</td>
<td align="left">Easy creation of thematic maps</td>
</tr>
<tr class="odd">
<td align="left">classInt</td>
<td align="left">Create univariate class intervals</td>
</tr>
<tr class="even">
<td align="left">sysfonts</td>
<td align="left">Loading system fonts and Google Fonts</td>
</tr>
<tr class="odd">
<td align="left">showtext</td>
<td align="left">Using fonts more easily in R graphs</td>
</tr>
</tbody>
</table>
<pre class="r"><code># install the packages if necessary
if(!require(&quot;tidyverse&quot;)) install.packages(&quot;tidyverse&quot;)
if(!require(&quot;feedeR&quot;)) install.packages(&quot;feedeR&quot;)
if(!require(&quot;fs&quot;)) install.packages(&quot;fs&quot;)
if(!require(&quot;lubridate&quot;)) install.packages(&quot;lubridate&quot;)
if(!require(&quot;fs&quot;)) install.packages(&quot;fs&quot;)
if(!require(&quot;tmap&quot;)) install.packages(&quot;tmap&quot;)
if(!require(&quot;classInt&quot;)) install.packages(&quot;classInt&quot;)
if(!require(&quot;showtext&quot;)) install.packages(&quot;showtext&quot;)
if(!require(&quot;sysfonts&quot;)) install.packages(&quot;sysfonts&quot;)
if(!require(&quot;rvest&quot;)) install.packages(&quot;rvest&quot;)

# load packages
library(feedeR)
library(sf) 
library(fs)
library(tidyverse)
library(lubridate)
library(classInt)
library(tmap)
library(rvest)</code></pre>
</div>
<div id="download-links" class="section level2">
<h2>Download links</h2>
<p>The first <em>url</em> will give us access to a list of provinces, territorial headquarters (they do not always coincide with the oficial province), with new RSS links, which include the final download link for each municipality. In this case, we will download the buildings of Valencia. Cadastre data is updated every six months.</p>
<pre class="r"><code>url &lt;- &quot;http://www.catastro.minhap.es/INSPIRE/buildings/ES.SDGC.bu.atom.xml&quot;

# import RSS feed with provincial links
prov_enlaces &lt;- feed.extract(url)
str(prov_enlaces) # object is a list</code></pre>
<pre><code>## List of 4
##  $ title  : chr &quot;Download service of Buildings. Territorial Office&quot;
##  $ link   : chr &quot;http://www.catastro.minhap.es/INSPIRE/buildings/ES.SDGC.BU.atom.xml&quot;
##  $ updated: POSIXct[1:1], format: &quot;2019-10-26&quot;
##  $ items  :&#39;data.frame&#39;: 52 obs. of  4 variables:
##   ..$ title: chr [1:52] &quot;Territorial office 02 Albacete&quot; &quot;Territorial office 03 Alicante&quot; &quot;Territorial office 04 AlmerÃ­a&quot; &quot;Territorial office 05 Avila&quot; ...
##   ..$ date : POSIXct[1:52], format: &quot;2019-10-26&quot; &quot;2019-10-26&quot; ...
##   ..$ link : chr [1:52] &quot;http://www.catastro.minhap.es/INSPIRE/buildings/02/ES.SDGC.bu.atom_02.xml&quot; &quot;http://www.catastro.minhap.es/INSPIRE/buildings/03/ES.SDGC.bu.atom_03.xml&quot; &quot;http://www.catastro.minhap.es/INSPIRE/buildings/04/ES.SDGC.bu.atom_04.xml&quot; &quot;http://www.catastro.minhap.es/INSPIRE/buildings/05/ES.SDGC.bu.atom_05.xml&quot; ...
##   ..$ hash : chr [1:52] &quot;d21ebb7975e59937&quot; &quot;bdba5e149f09e9d8&quot; &quot;03bcbcc7c5be2e17&quot; &quot;8a154202dd778143&quot; ...</code></pre>
<pre class="r"><code># extract the table with the links
prov_enlaces_tab &lt;- as_tibble(prov_enlaces$items) %&gt;% 
                       mutate(title = repair_encoding(title))</code></pre>
<pre><code>## Best guess: UTF-8 (100% confident)</code></pre>
<pre class="r"><code>prov_enlaces_tab</code></pre>
<pre><code>## # A tibble: 52 x 4
##    title           date                link                            hash     
##    &lt;chr&gt;           &lt;dttm&gt;              &lt;chr&gt;                           &lt;chr&gt;    
##  1 Territorial of~ 2019-10-26 00:00:00 http://www.catastro.minhap.es/~ d21ebb79~
##  2 Territorial of~ 2019-10-26 00:00:00 http://www.catastro.minhap.es/~ bdba5e14~
##  3 Territorial of~ 2019-10-26 00:00:00 http://www.catastro.minhap.es/~ 03bcbcc7~
##  4 Territorial of~ 2019-10-26 00:00:00 http://www.catastro.minhap.es/~ 8a154202~
##  5 Territorial of~ 2019-10-26 00:00:00 http://www.catastro.minhap.es/~ 7d3fd376~
##  6 Territorial of~ 2019-10-26 00:00:00 http://www.catastro.minhap.es/~ 9c08741f~
##  7 Territorial of~ 2019-10-26 00:00:00 http://www.catastro.minhap.es/~ ff722b15~
##  8 Territorial of~ 2019-10-26 00:00:00 http://www.catastro.minhap.es/~ b431aa61~
##  9 Territorial of~ 2019-10-26 00:00:00 http://www.catastro.minhap.es/~ f79c6562~
## 10 Territorial of~ 2019-10-26 00:00:00 http://www.catastro.minhap.es/~ d702a6a8~
## # ... with 42 more rows</code></pre>
<p>Now, we access and download the data from Valencia. To filter the final download link we use the <code>filter()</code> function of the <code>dplyr</code> package, searching for the name of the territorial headquarter and then the name of the municipality in capital letters with the <code>str_detect()</code> function of <code>stringr</code>. The <code>pull()</code> function allows us to extract a column from a <code>data.frame</code>.</p>
<div class="alert alert-note">
  <p>Currently the <code>feed.extract()</code> function does not import correctly in the encoding UTF-8 under Windows. For this reason, in some cities a bad codification of special characters may appear “CÃ¡diz”. To solve this problem we apply the <code>repair_encoding()</code> function of the <code>rvest</code> package.</p>

</div>

<pre class="r"><code># filter the province and get the RSS link
val_atom &lt;- filter(prov_enlaces_tab, str_detect(title, &quot;Valencia&quot;)) %&gt;% pull(link)

# import the RSS
val_enlaces &lt;- feed.extract(val_atom)

# get the table with the download links
val_enlaces_tab &lt;- val_enlaces$items
val_enlaces_tab &lt;- mutate(val_enlaces_tab, title = repair_encoding(title),
                          link = repair_encoding(link)) </code></pre>
<pre><code>## Best guess: UTF-8 (100% confident)
## Best guess: UTF-8 (100% confident)</code></pre>
<pre class="r"><code>#  filter the table with the name of the city
val_link &lt;- filter(val_enlaces_tab, str_detect(title, &quot;VALENCIA&quot;)) %&gt;% pull(link)
val_link</code></pre>
<pre><code>## [1] &quot;http://www.catastro.minhap.es/INSPIRE/Buildings/46/46900-VALENCIA/A.ES.SDGC.BU.46900.zip&quot;</code></pre>
</div>
<div id="data-download" class="section level2">
<h2>Data download</h2>
<p>The download is done with the <code>download.file()</code> function that only has two main arguments, the download link and the path with the file name. In this case, we use the <code>tempfile()</code> function, which is useful for creating temporary files, that is, files that only exist in the memory for a certain time.
The file we download has the extension <code>*.zip</code>, so we must unzip it with another function (<code>unzip()</code>), which requires the name of the file and the name of the folder, where we want to unzip it. Finally, the <code>URLencode()</code> function encodes an <em>URL</em> address that contains special characters.</p>
<pre class="r"><code># create a temporary file
temp &lt;- tempfile()

# download the data
download.file(URLencode(val_link), temp)

# unzip to a folder called buildings
unzip(temp, exdir = &quot;buildings&quot;)</code></pre>
</div>
<div id="import-the-data" class="section level2">
<h2>Import the data</h2>
<p>To import the data we use the <code>dir_ls()</code> function of the <code>fs</code> package, which can obtain the files and folders of a specific path while filtering through a text pattern (<em>regexp </em>: regular expression). We apply the <code>st_read()</code> function of the <code>sf</code> package to the <em>Geography Markup Language</em> (GML) file.</p>
<pre class="r"><code># get the path with the file
file_val &lt;- dir_ls(&quot;buildings&quot;, regexp = &quot;building.gml&quot;)

# import the data
buildings_val &lt;- st_read(file_val)</code></pre>
<pre><code>## Reading layer `Building&#39; from data source `C:\Users\xeo19\Documents\GitHub\blogR_update\content\post\en\2019-11-01-visualize-urban-growth\buildings\A.ES.SDGC.BU.46900.building.gml&#39; using driver `GML&#39;
## Simple feature collection with 36296 features and 24 fields
## geometry type:  MULTIPOLYGON
## dimension:      XY
## bbox:           xmin: 720608 ymin: 4351287 xmax: 734982.5 ymax: 4382906
## CRS:            25830</code></pre>
</div>
<div id="data-preparation" class="section level2">
<h2>Data preparation</h2>
<p>We only have to convert the column of the construction year (beginning) into a <code>Date</code> class. The date column contains some dates in <code>--01-01</code> format, which does not correspond to any recognizable date. Therefore, we replace the first <code>-</code> with <code>0000</code>.</p>
<pre class="r"><code>buildings_val &lt;- mutate(buildings_val, 
               beginning = str_replace(beginning, &quot;^-&quot;, &quot;0000&quot;) %&gt;% 
                            ymd_hms() %&gt;% as_date()
               )</code></pre>
<pre><code>## Warning: 4 failed to parse.</code></pre>
</div>
<div id="distribution-chart" class="section level2">
<h2>Distribution chart</h2>
<p>Before creating the maps of the construction years, which will reflect urban growth, we will make a graph of distribution of the beginning variable. We can clearly identify periods of urban expansion. We will use the <code>ggplot2</code> package with the geometry of <code>geom_density()</code> for this purpose. The <code>font_add_google()</code> function of the <code>sysfonts</code> package allows us to download and include font families from Google.</p>
<pre class="r"><code>#font download
sysfonts::font_add_google(&quot;Montserrat&quot;, &quot;Montserrat&quot;)

#use showtext for fonts
showtext::showtext_auto() </code></pre>
<pre class="r"><code># limit the period after 1750
filter(buildings_val, beginning &gt;= &quot;1750-01-01&quot;) %&gt;%
 ggplot(aes(beginning)) + 
    geom_density(fill = &quot;#2166ac&quot;, alpha = 0.7) +
  scale_x_date(date_breaks = &quot;20 year&quot;, 
               date_labels = &quot;%Y&quot;) +
  theme_minimal() +
  theme(title = element_text(family = &quot;Montserrat&quot;),
        axis.text = element_text(family = &quot;Montserrat&quot;)) +
  labs(y = &quot;&quot;,x = &quot;&quot;, title = &quot;Evolution of urban development&quot;)</code></pre>
<p><img src="/post/en/2019-11-01-visualize-urban-growth/index.en_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
</div>
<div id="buffer-of-25-km-for-valencia" class="section level2">
<h2>Buffer of 2,5 km for Valencia</h2>
<p>To visualize better the distribution of urban growth, we limit the map to a radius of 2.5 km from the city center. Therefore, we use the <code>geocode_OSM()</code> function of the <code>tmaptools</code> package to obtain the coordinates of Valencia in class <code>sf</code>. Then we project the points to the system we use for the buildings (EPSG: 25830). Finally, we create with the function <code>st_buffer()</code> a buffer with 2500 m and the intersection with our building data. It is also possible to create a buffer in the form of a rectangle indicating the style with the argument <code>endCapStyle =" SQUARE "</code>.</p>
<pre class="r"><code># get the coordinates of Valencia
ciudad_point &lt;- tmaptools::geocode_OSM(&quot;Valencia&quot;, 
                                      as.sf = TRUE)

#  project the points
ciudad_point &lt;- st_transform(ciudad_point, 25830)

# create the buffer
point_bf &lt;- st_buffer(ciudad_point, 2500)


# get the intersection between the buffer and the building
buildings_val25 &lt;- st_intersection(buildings_val, point_bf)</code></pre>
<pre><code>## Warning: attribute variables are assumed to be spatially constant throughout all
## geometries</code></pre>
</div>
<div id="prepare-data-for-mapping" class="section level2">
<h2>Prepare data for mapping</h2>
<p>We categorize the year into 15 groups using quartiles.</p>
<pre class="r"><code># find 15 classes
br &lt;- classIntervals(year(buildings_val25$beginning), 15, &quot;quantile&quot;)</code></pre>
<pre><code>## Warning in classIntervals(year(buildings_val25$beginning), 15, &quot;quantile&quot;): var
## has missing values, omitted in finding classes</code></pre>
<pre class="r"><code># create labels
lab &lt;- names(print(br, under = &quot;&lt;&quot;, over = &quot;&gt;&quot;, cutlabels = FALSE))</code></pre>
<pre><code>## style: quantile
##      &lt; 1890 1890 - 1912 1912 - 1925 1925 - 1930 1930 - 1940 1940 - 1950 
##         940        1369         971         596        1719        1080 
## 1950 - 1957 1957 - 1962 1962 - 1966 1966 - 1970 1970 - 1973 1973 - 1977 
##        1227        1266        1233        1165        1161         932 
## 1977 - 1987 1987 - 1999      &gt; 1999 
##        1337        1197        1190</code></pre>
<pre class="r"><code># categorize the year
buildings_val25 &lt;- mutate(buildings_val25, 
               yr_cl = cut(year(beginning), br$brks, labels = lab, include.lowest = TRUE))</code></pre>
</div>
<div id="map-of-valencia" class="section level2">
<h2>Map of Valencia</h2>
<p>For the mapping, we will use the <code>tmap</code> package. It is an interesting alternative to <code>ggplot2</code>. It is a package of functions specialized in creating thematic maps. The philosophy of the package follows the same as in <code>ggplot2</code>, creating multiple layers with different functions, which always start with <code>tm_ *</code>and combine with <code>+</code>. Building a map with <em>tmap</em> always starts with <em>tm_shape()</em>, where the data, we want to draw, is defined. Then we add the corresponding geometry to the data type (<code>tm_polygon()</code>, <code>tm_border()</code>, <code>tm_dots()</code> or even <code>tm_raster()</code>). The <code>tm_layout()</code> function help us to configure the map style.</p>
<p>When we need more colors than the maximum allowed by <code>RColorBrewer</code>, we can pass the colors to the <code>colorRampPalette()</code> function. This function interpolates a set of given colors.</p>
<pre class="r"><code># colours
col_spec &lt;- RColorBrewer::brewer.pal(11, &quot;Spectral&quot;)

# colour ramp function
col_spec_fun &lt;- colorRampPalette(col_spec)


# create the final map
tm_shape(buildings_val25) +
  tm_polygons(&quot;yr_cl&quot;, 
              border.col = &quot;transparent&quot;,
              palette = col_spec_fun(15),
              textNA = &quot;Without data&quot;,
              title = &quot;&quot;) +
 tm_layout(bg.color = &quot;black&quot;,
           outer.bg.color = &quot;black&quot;,
           legend.outside = TRUE,
           legend.text.color = &quot;white&quot;,
           legend.text.fontfamily = &quot;Montserrat&quot;, 
            panel.label.fontfamily = &quot;Montserrat&quot;,
            panel.label.color = &quot;white&quot;,
            panel.label.bg.color = &quot;black&quot;,
            panel.label.size = 5,
            panel.label.fontface = &quot;bold&quot;)</code></pre>
<p><img src="/post/en/2019-11-01-visualize-urban-growth/index.en_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
</div>
<div id="dynamic-map-with-leaflet" class="section level2">
<h2>Dynamic map with leaflet</h2>
<p>A very interesting advantage is the <code>tmap_leaflet()</code> function of the <code>tmap</code> package to easily pass a map created in the same frame to <code>leaflet</code>.</p>
<pre class="r"><code># tmap object
m &lt;-   tm_shape(buildings_val25) +
          tm_polygons(&quot;yr_cl&quot;, 
              border.col = &quot;transparent&quot;,
              palette = col_spec_fun(15),
              textNA = &quot;Without data&quot;,
              title = &quot;&quot;)


# dynamic map
tmap_leaflet(m)</code></pre>
<iframe src="/files/urban_growth_leaflet.html" width="672" height="500px">
</iframe>
</div>

    </div>

    


<div class="article-tags">
  
  <a class="badge badge-light" href="/en/tags/urban-growth/">urban growth</a>
  
  <a class="badge badge-light" href="/en/tags/city/">city</a>
  
  <a class="badge badge-light" href="/en/tags/urban-geography/">urban geography</a>
  
</div>



    






<div class="media author-card" itemscope itemtype="http://schema.org/Person">
  
  <img class="portrait mr-3" src="/img/potrai_domi.jpg" itemprop="image" alt="Avatar">
  
  <div class="media-body">
    <h5 class="card-title" itemprop="name"><a href="/en/">Dr. Dominic Royé</a></h5>
    
    
    <ul class="network-icon" aria-hidden="true">
      
      
      
      
      
      
      
      
      <li>
        <a itemprop="sameAs" href="mailto:dominic.roye@usc.es" >
          <i class="fa fa-envelope"></i>
        </a>
      </li>
      
      
      
      
        
      
      
      
      
      
        
      
      <li>
        <a itemprop="sameAs" href="//twitter.com/dr_xeo" >
          <i class="fab fa-twitter"></i>
        </a>
      </li>
      
      
      
      
      
      
      
      
        
      
      <li>
        <a itemprop="sameAs" href="https://www.researchgate.net/profile/Dominic_Roye" target="_blank" rel="noopener">
          <i class="ai ai-researchgate"></i>
        </a>
      </li>
      
      
      
      
        
      
      
      
      
      
        
      
      <li>
        <a itemprop="sameAs" href="//github.com/dominicroye" >
          <i class="fab fa-github"></i>
        </a>
      </li>
      
    </ul>
  </div>
</div>




    
    

    
    <div class="article-widget">
      <div class="post-nav">
  
  <div class="post-nav-item">
    <div class="meta-nav">Next</div>
    <a href="https://dominicroye.github.io/en/2020/geographic-distance/" rel="next">Geographic distance</a>
  </div>
  
  
  <div class="post-nav-item">
    <div class="meta-nav">Previous</div>
    <a href="https://dominicroye.github.io/en/2019/visualize-monthly-precipitation-anomalies/" rel="prev">Visualize monthly precipitation anomalies</a>
  </div>
  
</div>

    </div>
    

    
<section id="comments">
  <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "https-dominicroye-github-io" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</section>



  </div>
</article>

<div class="container">
  <footer class="site-footer">
  

  <p class="powered-by">
    &copy; 2018-2020 Dominic Royé. All rights reserved. &middot; 

    Powered by the
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

    
    <span class="float-right" aria-hidden="true">
      <a href="#" id="back_to_top">
        <span class="button_icon">
          <i class="fas fa-chevron-up fa-2x"></i>
        </span>
      </a>
    </span>
    
  </p>
</footer>

</div>


<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

    

    
    

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha512-+NqPlbbtM1QqiK8ZAo4Yrj2c4lNQoGv8P79DPtKzj++l5jnN39rHA/xsqn8zE9l0uSoxaCdrOgFs6yjyfbBxSg==" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.3/imagesloaded.pkgd.min.js" integrity="sha512-umsR78NN0D23AzgoZ11K7raBD+R6hqKojyBZs1w8WvYlsI+QuKRGBx3LFCwhatzBunCjDuJpDHwxD13sLMbpRA==" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha256-VsEqElsCHSGmnmHXGQzvoWjWwoznFSZc6hs7ARLRacQ=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.4/isotope.pkgd.min.js" integrity="sha512-VDBOIlDbuC4VWxGJNmuFRQ0Li0SKkDpmGyuhAG5LTDLd/dJ/S0WMVxriR2Y+CyPL5gzjpN4f/6iqWVBJlht0tQ==" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" integrity="sha256-X5PoE3KU5l+JcX+w09p/wHl9AzK333C4hJ2I9S5mD4M=" crossorigin="anonymous"></script>

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>
        
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/r.min.js"></script>
        
      

      
      
    

    
    

    
    
    
    <script id="dsq-count-scr" src="//https-dominicroye-github-io.disqus.com/count.js" async></script>
    

    
    
    <script>hljs.initHighlightingOnLoad();</script>
    

    

    
    

    

    
    

    
    

    
    
    
    
    
    
    
    
    <script src="/js/academic.min.d037ee5294b166a79dec317c58aea9cc.js"></script>

    

  </body>
</html>

