<!DOCTYPE html><html lang="en-us" >


<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  
  
  
    <meta name="generator" content="Wowchemy 5.3.0 for Hugo" />
  

  
  









  




  
  
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  

  
  
  
    
      
      <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap">
      <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media="print" onload="this.media='all'">
    
  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Dr. Dominic Royé" />

  
  
  
    
  
  <meta name="description" content="The General Directorate for the Cadastre of Spain has spatial information of the all buildings except for the Basque Country and Navarra. This data set is part of the implementation of [INSPIRE](https://inspire.ec.europa.eu/), the Space Information Infrastructure in Europe. More information can be found [here](http://www.catastro.meh.es/webinspire/index.html). We will use the links (*urls*) in *ATOM* format, which is an RSS type for web feeds, allowing us to obtain the download links for each municipality." />

  
  <link rel="alternate" hreflang="en-us" href="https://dominicroye.github.io/en/2019/visualize-urban-growth/" />

  
  
  
    <meta name="theme-color" content="#1565c0" />
  

  
  

  

  <link rel="stylesheet" href="/css/vendor-bundle.min.f1ecf783c14edc00c9320c205831ad8e.css" media="print" onload="this.media='all'">

  
  
  
    
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha512-W0xM4mr6dEP9nREo7Z9z+9X70wytKvMGeDsj7ps2+xg5QPrEBXC8tAW1IFnzjR6eoJ90JmCnFzerQJTLzIEHjA==" crossorigin="anonymous" media="print" onload="this.media='all'">
    

    
    
    
    
      
      
    
    
    

    
    
    
      
    
    
      
      
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.2.1/build/styles/dracula.min.css" crossorigin="anonymous" title="hl-light" media="print" onload="this.media='all'">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.2.1/build/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" media="print" onload="this.media='all'" disabled>
      
    

    
    
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.7.1/dist/leaflet.min.css" integrity="" crossorigin="anonymous" media="print" onload="this.media='all'">
    

    

    
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      
        
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
  

  
  
  
  
  
  <link rel="stylesheet" href="/css/wowchemy.b48d89910a3f8560bb2d78fedea8d682.css" />

  




<script async src="https://www.googletagmanager.com/gtag/js?id=UA-27463794-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];

  function gtag() {
      dataLayer.push(arguments);
  }

  function trackOutboundLink(url, target) {
    gtag('event', 'click', {
         'event_category': 'outbound',
         'event_label': url,
         'transport_type': 'beacon',
         'event_callback': function () {
           if (target !== '_blank') {
             document.location = url;
           }
         }
    });
    console.debug("Outbound link clicked: " + url);
  }

  function onClickCallback(event) {
    if ((event.target.tagName !== 'A') || (event.target.host === window.location.host)) {
      return;
    }
    trackOutboundLink(event.target, event.target.getAttribute('target'));  
  }

  gtag('js', new Date());
  gtag('config', 'UA-27463794-2', {});
  gtag('set', {'cookie_flags': 'SameSite=None;Secure'});

  
  document.addEventListener('click', onClickCallback, false);
</script>


  

  

  




  
  
  

  

  
    <link rel="manifest" href="/en/manifest.webmanifest" />
  

  <link rel="icon" type="image/png" href="/media/icon_hu27cb63416a395b8c8d0d7112b85e26a9_17299_32x32_fill_lanczos_center_3.png" />
  <link rel="apple-touch-icon" type="image/png" href="/media/icon_hu27cb63416a395b8c8d0d7112b85e26a9_17299_180x180_fill_lanczos_center_3.png" />

  <link rel="canonical" href="https://dominicroye.github.io/en/2019/visualize-urban-growth/" />

  
  
  
  
  
  
  
  
    
  
  

  
  
    
    
  
  <meta property="twitter:card" content="summary_large_image" />
  
    <meta property="twitter:site" content="@@dr_xeo" />
    <meta property="twitter:creator" content="@@dr_xeo" />
  
  <meta property="og:site_name" content="Dr. Dominic Royé" />
  <meta property="og:url" content="https://dominicroye.github.io/en/2019/visualize-urban-growth/" />
  <meta property="og:title" content="Visualize urban growth | Dr. Dominic Royé" />
  <meta property="og:description" content="The General Directorate for the Cadastre of Spain has spatial information of the all buildings except for the Basque Country and Navarra. This data set is part of the implementation of [INSPIRE](https://inspire.ec.europa.eu/), the Space Information Infrastructure in Europe. More information can be found [here](http://www.catastro.meh.es/webinspire/index.html). We will use the links (*urls*) in *ATOM* format, which is an RSS type for web feeds, allowing us to obtain the download links for each municipality." /><meta property="og:image" content="https://dominicroye.github.io/en/2019/visualize-urban-growth/featured.png" />
    <meta property="twitter:image" content="https://dominicroye.github.io/en/2019/visualize-urban-growth/featured.png" /><meta property="og:locale" content="en-us" />
  
    
      <meta
        property="article:published_time"
        content="2019-11-01T00:00:00&#43;00:00"
      />
    
    <meta property="article:modified_time" content="2019-11-01T00:00:00&#43;00:00">
  

  


    






  




<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://dominicroye.github.io/en/2019/visualize-urban-growth/"
  },
  "headline": "Visualize urban growth",
  
  "image": [
    "https://dominicroye.github.io/en/2019/visualize-urban-growth/featured.png"
  ],
  
  "datePublished": "2019-11-01T00:00:00Z",
  "dateModified": "2019-11-01T00:00:00Z",
  
  "author": {
    "@type": "Person",
    "name": "Dr. Dominic Royé"
  },
  
  "publisher": {
    "@type": "Organization",
    "name": "University of Santiago de Compostela",
    "logo": {
      "@type": "ImageObject",
      "url": "https://dominicroye.github.io/media/logo_hu6637600e1c36fe7812a10a6623aaebda_116520_192x192_fit_lanczos_3.png"
    }
  },
  "description": "The General Directorate for the Cadastre of Spain has spatial information of the all buildings except for the Basque Country and Navarra. This data set is part of the implementation of [INSPIRE](https://inspire.ec.europa.eu/), the Space Information Infrastructure in Europe. More information can be found [here](http://www.catastro.meh.es/webinspire/index.html). We will use the links (*urls*) in *ATOM* format, which is an RSS type for web feeds, allowing us to obtain the download links for each municipality."
}
</script>

  

  

  

  





  <title>Visualize urban growth | Dr. Dominic Royé</title>
</head>


<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" class="page-wrapper   " data-wc-page-id="d741a3234b312561aff3984c44cc1e2e" >

  
  
  
  
  
  
  
  
  
  <script src="/js/wowchemy-init.min.2da3b1fa37e894630bf6de39b1b694b3.js"></script>

  




  <div class="page-header">
    







 



  


<header class="header--fixed">
  <nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
    <div class="container-xl">

      
      <div class="d-none d-lg-inline-flex">
        <a class="navbar-brand" href="/en/"><img src="/media/logo_hu6637600e1c36fe7812a10a6623aaebda_116520_0x70_resize_lanczos_3.png" alt="Dr. Dominic Royé"
            
            >
             <div style = "padding-top:0.5em;">Dr. Dominic Royé</div></a>
      </div>
      

      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar-content" aria-controls="navbar-content" aria-expanded="false" aria-label="Toggle navigation">
      <span><i class="fas fa-bars"></i></span>
      </button>
      

      
      <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
        <a class="navbar-brand" href="/en/"><img src="/media/logo_hu6637600e1c36fe7812a10a6623aaebda_116520_0x70_resize_lanczos_3.png" alt="Dr. Dominic Royé"
          
          ></a>
      </div>
      

      
      
      <div class="navbar-collapse main-menu-item collapse justify-content-end" id="navbar-content">

        
        <ul class="navbar-nav d-md-inline-flex">
          

          

          
          
          

          

          
          
          
          

          
            
            
          

          <li class="nav-item">
            <a class="nav-link " href="/en/#"><span>home</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/en/#posts"><span>blog</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/en/#featured"><span>publications</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/en/#projects"><span>graphs</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/en/#about"><span>me</span></a>
          </li>

          
          

        

          
        </ul>
      </div>

      <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">

        
        
          
            
            <li class="nav-item d-none d-lg-inline-flex">
              <a class="nav-link" href="https://twitter.com/dr_xeo" data-toggle="tooltip" data-placement="bottom" title="Follow me on Twitter" target="_blank" rel="noopener" aria-label="Follow me on Twitter">
                <i class="fab fa-twitter" aria-hidden="true"></i>
              </a>
            </li>
          
        

        
        

        
        

        
        

      </ul>

    </div>
  </nav>
</header>


  </div>

  <div class="page-body">
    <article class="article">

  




















  
  
    
  


<div class="article-container pt-3">
  <h1>Visualize urban growth</h1>

  

  


<div class="article-metadata">

  
  

  
  <span class="article-date">
    
    
      
    
    2019-11-01
  </span>
  

  

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    10 min read
  </span>
  

  
  
  
  
  
  

  
  
  <span class="middot-divider"></span>
  <span class="article-categories">
    <i class="fas fa-folder mr-1"></i><a href="/en/category/visualization/">visualization</a>, <a href="/en/category/r/">R</a>, <a href="/en/category/relementary/">R:elementary</a>, <a href="/en/category/gis/">gis</a></span>
  

</div>

  





</div>


<div class="article-header article-container featured-image-wrapper mt-4 mb-4" style="max-width: 720px; max-height: 709px;">
  <div style="position: relative">
    <img src="/en/2019/visualize-urban-growth/featured_hu654caca59e40d7b6b365bd862bfa13ef_998521_720x0_resize_lanczos_3.png" width="720" height="709" alt="" class="featured-image">
    
  </div>
</div>



  <div class="article-container">

    <div class="article-style">
      
<script src="https://dominicroye.github.io/en/2019/visualize-urban-growth/index.en_files/header-attrs/header-attrs.js"></script>


<p>The General Directorate for the Cadastre of Spain has spatial information of the all buildings except for the Basque Country and Navarra. This data set is part of the implementation of <a href="https://inspire.ec.europa.eu/">INSPIRE</a>, the Space Information Infrastructure in Europe. More information can be found <a href="http://www.catastro.meh.es/webinspire/index.html">here</a>. We will use the links (<em>urls</em>) in <em>ATOM</em> format, which is an RSS type for web feeds, allowing us to obtain the download link for each municipality.</p>
<p><div class="alert alert-note">
  <div>
    This blog post is a reduced version of the case study that you can find in our recent publication - <a href="https://dominicroye.github.io/es/publication/manual_rgis_2019/">Introduction to GIS with R</a> - published by Dominic Royé and Roberto Serrano-Notivoli (in Spanish).
  </div>
</div>
</p>
<div id="packages" class="section level2">
<h2>Packages</h2>
<table>
<colgroup>
<col width="10%" />
<col width="89%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Package</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">tidyverse</td>
<td align="left">Collection of packages (visualization, manipulation): ggplot2, dplyr, purrr, etc.</td>
</tr>
<tr class="even">
<td align="left">sf</td>
<td align="left">Simple Feature: import, export and manipulate vector data</td>
</tr>
<tr class="odd">
<td align="left">fs</td>
<td align="left">Provides a cross-platform, uniform interface to file system operations</td>
</tr>
<tr class="even">
<td align="left">lubridate</td>
<td align="left">Easy manipulation of dates and times</td>
</tr>
<tr class="odd">
<td align="left">feedeR</td>
<td align="left">Import feeds RSS or ATOM</td>
</tr>
<tr class="even">
<td align="left">tmap</td>
<td align="left">Easy creation of thematic maps</td>
</tr>
<tr class="odd">
<td align="left">classInt</td>
<td align="left">Create univariate class intervals</td>
</tr>
<tr class="even">
<td align="left">sysfonts</td>
<td align="left">Loading system fonts and Google Fonts</td>
</tr>
<tr class="odd">
<td align="left">showtext</td>
<td align="left">Using fonts more easily in R graphs</td>
</tr>
</tbody>
</table>
<pre class="r"><code># install the packages if necessary
if(!require(&quot;tidyverse&quot;)) install.packages(&quot;tidyverse&quot;)
if(!require(&quot;feedeR&quot;)) install.packages(&quot;feedeR&quot;)
if(!require(&quot;fs&quot;)) install.packages(&quot;fs&quot;)
if(!require(&quot;lubridate&quot;)) install.packages(&quot;lubridate&quot;)
if(!require(&quot;fs&quot;)) install.packages(&quot;fs&quot;)
if(!require(&quot;tmap&quot;)) install.packages(&quot;tmap&quot;)
if(!require(&quot;classInt&quot;)) install.packages(&quot;classInt&quot;)
if(!require(&quot;showtext&quot;)) install.packages(&quot;showtext&quot;)
if(!require(&quot;sysfonts&quot;)) install.packages(&quot;sysfonts&quot;)
if(!require(&quot;rvest&quot;)) install.packages(&quot;rvest&quot;)

# load packages
library(feedeR)
library(sf) 
library(fs)
library(tidyverse)
library(lubridate)
library(classInt)
library(tmap)
library(rvest)</code></pre>
</div>
<div id="download-links" class="section level2">
<h2>Download links</h2>
<p>The first <em>url</em> will give us access to a list of provinces, territorial headquarters (they do not always coincide with the oficial province), with new RSS links, which include the final download link for each municipality. In this case, we will download the buildings of Valencia. Cadastre data is updated every six months.</p>
<pre class="r"><code>url &lt;- &quot;http://www.catastro.minhap.es/INSPIRE/buildings/ES.SDGC.bu.atom.xml&quot;

# import RSS feed with provincial links
prov_enlaces &lt;- feed.extract(url)
str(prov_enlaces) # object is a list</code></pre>
<pre><code>## List of 4
##  $ title  : chr &quot;Download service of Buildings. Territorial Office&quot;
##  $ link   : chr &quot;http://www.catastro.minhap.es/INSPIRE/buildings/ES.SDGC.BU.atom.xml&quot;
##  $ updated: POSIXct[1:1], format: &quot;2022-03-14&quot;
##  $ items  : tibble [52 x 5] (S3: tbl_df/tbl/data.frame)
##   ..$ title      : chr [1:52] &quot;Territorial office 02 Albacete&quot; &quot;Territorial office 03 Alicante&quot; &quot;Territorial office 04 Almería&quot; &quot;Territorial office 05 Avila&quot; ...
##   ..$ date       : POSIXct[1:52], format: &quot;2022-03-14&quot; &quot;2022-03-14&quot; ...
##   ..$ link       : chr [1:52] &quot;http://www.catastro.minhap.es/INSPIRE/buildings/02/ES.SDGC.bu.atom_02.xml&quot; &quot;http://www.catastro.minhap.es/INSPIRE/buildings/03/ES.SDGC.bu.atom_03.xml&quot; &quot;http://www.catastro.minhap.es/INSPIRE/buildings/04/ES.SDGC.bu.atom_04.xml&quot; &quot;http://www.catastro.minhap.es/INSPIRE/buildings/05/ES.SDGC.bu.atom_05.xml&quot; ...
##   ..$ description: chr [1:52] &quot;\n\n\t\t  &quot; &quot;\n\n\t\t  &quot; &quot;\n\n\t\t  &quot; &quot;\n\n\t\t  &quot; ...
##   ..$ hash       : chr [1:52] &quot;d21ebb7975e59937&quot; &quot;bdba5e149f09e9d8&quot; &quot;03bcbcc7c5be2e17&quot; &quot;8a154202dd778143&quot; ...</code></pre>
<pre class="r"><code># extract the table with the links
prov_enlaces_tab &lt;- as_tibble(prov_enlaces$items) %&gt;% 
                       mutate(title = repair_encoding(title))</code></pre>
<pre><code>## Warning: `html_encoding_repair()` was deprecated in rvest 1.0.0.
## Instead, re-load using the `encoding` argument of `read_html()`
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_lifecycle_warnings()` to see where this warning was generated.</code></pre>
<pre><code>## Best guess: UTF-8 (100% confident)</code></pre>
<pre class="r"><code>prov_enlaces_tab</code></pre>
<pre><code>## # A tibble: 52 x 5
##    title                             date                link  description hash 
##    &lt;chr&gt;                             &lt;dttm&gt;              &lt;chr&gt; &lt;chr&gt;       &lt;chr&gt;
##  1 &quot;Territorial office 02 Albacete&quot;  2022-03-14 00:00:00 http~ &quot;\n\n\t\t ~ d21e~
##  2 &quot;Territorial office 03 Alicante&quot;  2022-03-14 00:00:00 http~ &quot;\n\n\t\t ~ bdba~
##  3 &quot;Territorial office 04 Almería&quot;   2022-03-14 00:00:00 http~ &quot;\n\n\t\t ~ 03bc~
##  4 &quot;Territorial office 05 Avila&quot;     2022-03-14 00:00:00 http~ &quot;\n\n\t\t ~ 8a15~
##  5 &quot;Territorial office 06 Badajoz&quot;   2022-03-14 00:00:00 http~ &quot;\n\n\t\t ~ 7d3f~
##  6 &quot;Territorial office 07 Baleares &quot; 2022-03-14 00:00:00 http~ &quot;\n\n\t\t ~ 9c08~
##  7 &quot;Territorial office 08 Barcelona&quot; 2022-03-14 00:00:00 http~ &quot;\n\n\t\t ~ ff72~
##  8 &quot;Territorial office 09 Burgos &quot;   2022-03-14 00:00:00 http~ &quot;\n\n\t\t ~ b431~
##  9 &quot;Territorial office 10 Cáceres &quot;  2022-03-14 00:00:00 http~ &quot;\n\n\t\t ~ f79c~
## 10 &quot;Territorial office 11 Cádiz &quot;    2022-03-14 00:00:00 http~ &quot;\n\n\t\t ~ d702~
## # ... with 42 more rows</code></pre>
<p>Now, we access and download the data from Valencia. To filter the final download link we use the <code>filter()</code> function of the <code>dplyr</code> package, searching for the name of the territorial headquarter and then the name of the municipality in capital letters with the <code>str_detect()</code> function of <code>stringr</code>. The <code>pull()</code> function allows us to extract a column from a <code>data.frame</code>.</p>
<p><div class="alert alert-note">
  <div>
    Currently the <code>feed.extract()</code> function does not import correctly in the encoding UTF-8 under Windows. For this reason, in some cities a bad codification of special characters may appear “CÃ¡diz”. To solve this problem we apply the <code>repair_encoding()</code> function of the <code>rvest</code> package. Nevertheless, problems can arise that have to be corrected manually.
  </div>
</div>
</p>
<pre class="r"><code># filter the province and get the RSS link
val_atom &lt;- filter(prov_enlaces_tab, str_detect(title, &quot;Valencia&quot;)) %&gt;% pull(link)

# import the RSS
val_enlaces &lt;- feed.extract(val_atom)

# get the table with the download links
val_enlaces_tab &lt;- val_enlaces$items
val_enlaces_tab &lt;- mutate(val_enlaces_tab, title = repair_encoding(title),
                          link = repair_encoding(link)) </code></pre>
<pre><code>## Best guess: UTF-8 (80% confident)</code></pre>
<pre><code>## Warning in stringi::stri_conv(x, from): the Unicode code point \U0000fffd cannot
## be converted to destination encoding

## Warning in stringi::stri_conv(x, from): the Unicode code point \U0000fffd cannot
## be converted to destination encoding</code></pre>
<pre><code>## Best guess: UTF-8 (80% confident)</code></pre>
<pre><code>## Warning in stringi::stri_conv(x, from): the Unicode code point \U0000fffd cannot
## be converted to destination encoding

## Warning in stringi::stri_conv(x, from): the Unicode code point \U0000fffd cannot
## be converted to destination encoding</code></pre>
<pre class="r"><code>#  filter the table with the name of the city
val_link &lt;- filter(val_enlaces_tab, str_detect(title, &quot;VALENCIA&quot;)) %&gt;% pull(link)
val_link</code></pre>
<pre><code>## [1] &quot;http://www.catastro.minhap.es/INSPIRE/Buildings/46/46900-VALENCIA/A.ES.SDGC.BU.46900.zip&quot;</code></pre>
</div>
<div id="data-download" class="section level2">
<h2>Data download</h2>
<p>The download is done with the <code>download.file()</code> function that only has two main arguments, the download link and the path with the file name. In this case, we use the <code>tempfile()</code> function, which is useful for creating temporary files, that is, files that only exist in the memory for a certain time.
The file we download has the extension <code>*.zip</code>, so we must unzip it with another function (<code>unzip()</code>), which requires the name of the file and the name of the folder, where we want to unzip it. Finally, the <code>URLencode()</code> function encodes an <em>URL</em> address that contains special characters.</p>
<pre class="r"><code># create a temporary file
temp &lt;- tempfile()

# download the data
download.file(URLencode(val_link), temp)

# unzip to a folder called buildings
unzip(temp, exdir = &quot;buildings_valencia&quot;) # change the name according to the city</code></pre>
</div>
<div id="import-the-data" class="section level2">
<h2>Import the data</h2>
<p>To import the data we use the <code>dir_ls()</code> function of the <code>fs</code> package, which can obtain the files and folders of a specific path while filtering through a text pattern (<em>regexp </em>: regular expression). We apply the <code>st_read()</code> function of the <code>sf</code> package to the <em>Geography Markup Language</em> (GML) file.</p>
<pre class="r"><code># get the path with the file
file_val &lt;- dir_ls(&quot;buildings_valencia&quot;, regexp = &quot;building.gml&quot;) # change the folder if needed

# import the data
buildings_val &lt;- st_read(file_val)</code></pre>
<pre><code>## Reading layer `Building&#39; from data source 
##   `E:\GitHub\blog_update_2021\content\en\post\2019-11-01-visualize-urban-growth\buildings_valencia\A.ES.SDGC.BU.46900.building.gml&#39; 
##   using driver `GML&#39;
## Simple feature collection with 36284 features and 24 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: 720570.9 ymin: 4351286 xmax: 734981.9 ymax: 4382906
## Projected CRS: ETRS89 / UTM zone 30N</code></pre>
</div>
<div id="data-preparation" class="section level2">
<h2>Data preparation</h2>
<p>We only have to convert the column of the construction year (beginning) into a <code>Date</code> class. The date column contains some dates in <code>--01-01</code> format, which does not correspond to any recognizable date. Therefore, we replace the first <code>-</code> with <code>0000</code>.</p>
<pre class="r"><code>buildings_val &lt;- mutate(buildings_val, 
               beginning = str_replace(beginning, &quot;^-&quot;, &quot;0000&quot;) %&gt;% 
                            ymd_hms() %&gt;% as_date()
               )</code></pre>
<pre><code>## Warning: 4 failed to parse.</code></pre>
</div>
<div id="distribution-chart" class="section level2">
<h2>Distribution chart</h2>
<p>Before creating the maps of the construction years, which will reflect urban growth, we will make a graph of distribution of the beginning variable. We can clearly identify periods of urban expansion. We will use the <code>ggplot2</code> package with the geometry of <code>geom_density()</code> for this purpose. The <code>font_add_google()</code> function of the <code>sysfonts</code> package allows us to download and include font families from Google.</p>
<pre class="r"><code>#font download
sysfonts::font_add_google(&quot;Montserrat&quot;, &quot;Montserrat&quot;)

#use showtext for fonts
showtext::showtext_auto() </code></pre>
<pre class="r"><code># limit the period after 1750
filter(buildings_val, beginning &gt;= &quot;1750-01-01&quot;) %&gt;%
 ggplot(aes(beginning)) + 
    geom_density(fill = &quot;#2166ac&quot;, alpha = 0.7) +
  scale_x_date(date_breaks = &quot;20 year&quot;, 
               date_labels = &quot;%Y&quot;) +
  theme_minimal(base_family = &quot;Montserrat&quot;) +
  labs(y = &quot;&quot;,x = &quot;&quot;, title = &quot;Evolution of urban development&quot;)</code></pre>
<p><img src="https://dominicroye.github.io/en/2019/visualize-urban-growth/index.en_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
</div>
<div id="buffer-of-25-km-for-valencia" class="section level2">
<h2>Buffer of 2,5 km for Valencia</h2>
<p>To visualize better the distribution of urban growth, we limit the map to a radius of 2.5 km from the city center. Therefore, we use the <code>geocode_OSM()</code> function of the <code>tmaptools</code> package to obtain the coordinates of Valencia in class <code>sf</code>. Then we project the points to the system we use for the buildings (EPSG: 25830). The <code>st_crs()</code> function returns the coordinate system of a spatial object <code>sf</code>. Finally, we create with the function <code>st_buffer()</code> a buffer with 2500 m and the intersection with our building data. It is also possible to create a buffer in the form of a rectangle indicating the style with the argument <code>endCapStyle =" SQUARE "</code>.</p>
<pre class="r"><code># get the coordinates of Valencia
ciudad_point &lt;- tmaptools::geocode_OSM(&quot;Valencia&quot;, 
                                      as.sf = TRUE)

#  project the points
ciudad_point &lt;- st_transform(ciudad_point, st_crs(buildings_val))

# create the buffer
point_bf &lt;- st_buffer(ciudad_point, 2500) # radius of 2500 m


# get the intersection between the buffer and the building
buildings_val25 &lt;- st_intersection(buildings_val, point_bf)</code></pre>
<pre><code>## Warning: attribute variables are assumed to be spatially constant throughout all
## geometries</code></pre>
</div>
<div id="prepare-data-for-mapping" class="section level2">
<h2>Prepare data for mapping</h2>
<p>We categorize the year into 15 groups using quartiles. It is also possible to modify the number of classes or the applied method (eg jenks, fisher, etc), you can find more details in the help <code>?classIntervals</code>.</p>
<pre class="r"><code># find 15 classes
br &lt;- classIntervals(year(buildings_val25$beginning), 15, &quot;quantile&quot;)</code></pre>
<pre><code>## Warning in classIntervals(year(buildings_val25$beginning), 15, &quot;quantile&quot;): var
## has missing values, omitted in finding classes</code></pre>
<pre class="r"><code># create labels
lab &lt;- names(print(br, under = &quot;&lt;&quot;, over = &quot;&gt;&quot;, cutlabels = FALSE))</code></pre>
<pre><code>## style: quantile
##      &lt; 1890 1890 - 1912 1912 - 1925 1925 - 1930 1930 - 1940 1940 - 1950 
##         932        1350         947         594        1703        1054 
## 1950 - 1958 1958 - 1962 1962 - 1966 1966 - 1970 1970 - 1973 1973 - 1978 
##        1453        1029        1223        1158        1155        1190 
## 1978 - 1988 1988 - 1999      &gt; 1999 
##        1149        1111        1244</code></pre>
<pre class="r"><code># categorize the year
buildings_val25 &lt;- mutate(buildings_val25, 
                          yr_cl = cut(year(beginning), 
                                       br$brks, 
                                       labels = lab, 
                                       include.lowest = TRUE))</code></pre>
</div>
<div id="map-of-valencia" class="section level2">
<h2>Map of Valencia</h2>
<p>For the mapping, we will use the <code>tmap</code> package. It is an interesting alternative to <code>ggplot2</code>. It is a package of functions specialized in creating thematic maps. The philosophy of the package follows the same as in <code>ggplot2</code>, creating multiple layers with different functions, which always start with <code>tm_ *</code>and combine with <code>+</code>. Building a map with <em>tmap</em> always starts with <em>tm_shape()</em>, where the data, we want to draw, is defined. Then we add the corresponding geometry to the data type (<code>tm_polygon()</code>, <code>tm_border()</code>, <code>tm_dots()</code> or even <code>tm_raster()</code>). The <code>tm_layout()</code> function help us to configure the map style.</p>
<p>When we need more colors than the maximum allowed by <code>RColorBrewer</code>, we can pass the colors to the <code>colorRampPalette()</code> function. This function interpolates a set of given colors.</p>
<pre class="r"><code># colours
col_spec &lt;- RColorBrewer::brewer.pal(11, &quot;Spectral&quot;)

# colour ramp function
col_spec_fun &lt;- colorRampPalette(col_spec)


# create the final map
tm_shape(buildings_val25) +
  tm_polygons(&quot;yr_cl&quot;, 
              border.col = &quot;transparent&quot;,
              palette = col_spec_fun(15), # adapt to the number of classes
              textNA = &quot;Without data&quot;,
              title = &quot;&quot;) +
 tm_layout(bg.color = &quot;black&quot;,
           outer.bg.color = &quot;black&quot;,
           legend.outside = TRUE,
           legend.text.color = &quot;white&quot;,
           legend.text.fontfamily = &quot;Montserrat&quot;, 
            panel.label.fontfamily = &quot;Montserrat&quot;,
            panel.label.color = &quot;white&quot;,
            panel.label.bg.color = &quot;black&quot;,
            panel.label.size = 5,
            panel.label.fontface = &quot;bold&quot;)</code></pre>
<p><img src="https://dominicroye.github.io/en/2019/visualize-urban-growth/index.en_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<p>We can export our map using the function <code>tmap_save("name.png", dpi = 300)</code>. I recommend using the <code>dpi = 300</code> argument for a good image quality.</p>
<p>An alternative way to the <code>tmap</code> package is <code>ggplot2</code>.</p>
<pre class="r"><code># create the final map
ggplot(buildings_val25) +
     geom_sf(aes(fill = yr_cl), colour = &quot;transparent&quot;) +
  scale_fill_manual(values = col_spec_fun(15)) + # adapt to the number of classes
    labs(title = &quot;VALÈNCIA&quot;, fill = &quot;&quot;) +
  guides(fill = guide_legend(keywidth = .7, keyheight = 2.7)) +
theme_void(base_family = &quot;Montserrat&quot;) +
theme(panel.background = element_rect(fill = &quot;black&quot;),
      plot.background = element_rect(fill = &quot;black&quot;),
      legend.justification = .5,
      legend.text = element_text(colour = &quot;white&quot;, size = 12),
      plot.title = element_text(colour = &quot;white&quot;, hjust = .5, size = 60,
      margin = margin(t = 30)),
      plot.caption = element_text(colour = &quot;white&quot;,
      margin = margin(b = 20), hjust = .5, size = 16),
      plot.margin = margin(r = 40, l = 40))</code></pre>
<p><img src="https://dominicroye.github.io/en/2019/visualize-urban-growth/index.en_files/figure-html/unnamed-chunk-12-1.png" width="1536" /></p>
<p>To export the result of ggplot we can use the function <code>ggsave("name.png")</code>.</p>
</div>
<div id="dynamic-map-with-leaflet" class="section level2">
<h2>Dynamic map with leaflet</h2>
<p>A very interesting advantage is the <code>tmap_leaflet()</code> function of the <code>tmap</code> package to easily pass a map created in the same frame to <code>leaflet</code>.</p>
<pre class="r"><code># tmap object
m &lt;-   tm_shape(buildings_val25) +
          tm_polygons(&quot;yr_cl&quot;, 
              border.col = &quot;transparent&quot;,
              palette = col_spec_fun(15), # adapt to the number of classes
              textNA = &quot;Without data&quot;,
              title = &quot;&quot;)


# dynamic map
tmap_leaflet(m)</code></pre>
<iframe src="/files/urban_growth_leaflet.html" width="672" height="500px" data-external="1">
</iframe>
<p><a href="https://www.buymeacoffee.com/drxeo" target="_blank"><img src="https://cdn.buymeacoffee.com/buttons/default-orange.png" alt="Buy Me A Coffee" height="41" width="174"></a></p>
</div>

    </div>

    






<div class="article-tags">
  
  <a class="badge badge-light" href="/en/tag/urban-growth/">urban growth</a>
  
  <a class="badge badge-light" href="/en/tag/city/">city</a>
  
  <a class="badge badge-light" href="/en/tag/urban-geography/">urban geography</a>
  
</div>



<div class="share-box">
  <ul class="share">
    
      
      
      
        
      
      
      
      <li>
        <a href="https://twitter.com/intent/tweet?url=https://dominicroye.github.io/en/2019/visualize-urban-growth/&amp;text=Visualize%20urban%20growth" target="_blank" rel="noopener" class="share-btn-twitter" aria-label="twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.facebook.com/sharer.php?u=https://dominicroye.github.io/en/2019/visualize-urban-growth/&amp;t=Visualize%20urban%20growth" target="_blank" rel="noopener" class="share-btn-facebook" aria-label="facebook">
          <i class="fab fa-facebook"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="mailto:?subject=Visualize%20urban%20growth&amp;body=https://dominicroye.github.io/en/2019/visualize-urban-growth/" target="_blank" rel="noopener" class="share-btn-email" aria-label="envelope">
          <i class="fas fa-envelope"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.linkedin.com/shareArticle?url=https://dominicroye.github.io/en/2019/visualize-urban-growth/&amp;title=Visualize%20urban%20growth" target="_blank" rel="noopener" class="share-btn-linkedin" aria-label="linkedin-in">
          <i class="fab fa-linkedin-in"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="whatsapp://send?text=Visualize%20urban%20growth%20https://dominicroye.github.io/en/2019/visualize-urban-growth/" target="_blank" rel="noopener" class="share-btn-whatsapp" aria-label="whatsapp">
          <i class="fab fa-whatsapp"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://service.weibo.com/share/share.php?url=https://dominicroye.github.io/en/2019/visualize-urban-growth/&amp;title=Visualize%20urban%20growth" target="_blank" rel="noopener" class="share-btn-weibo" aria-label="weibo">
          <i class="fab fa-weibo"></i>
        </a>
      </li>
    
  </ul>
</div>











  
  



  
  
  
    
  
  
  
  <div class="media author-card content-widget-hr">
    
      
      <a href="https://dominicroye.github.io/"><img class="avatar mr-3 avatar-circle" src="/en/author/dr.-dominic-roye/avatar_hu930bec32484cd86675af8880de95caa2_508993_270x270_fill_q75_lanczos_center.jpg" alt="Dr. Dominic Royé"></a>
    

    <div class="media-body">
      <h5 class="card-title"><a href="https://dominicroye.github.io/">Dr. Dominic Royé</a></h5>
      <h6 class="card-subtitle">Senior postdoctoral researcher</h6>
      
      <ul class="network-icon" aria-hidden="true">
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://twitter.com/dr_xeo" target="_blank" rel="noopener">
        <i class="fab fa-twitter"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="/en/#contact" >
        <i class="fas fa-envelope"></i>
      </a>
    </li>
  
    
    
    
    
    
    
    
      
    
    <li>
      <a href="https://scholar.google.es/citations?user=EoYa8jUAAAAJ&amp;hl=es" target="_blank" rel="noopener">
        <i class="ai ai-google-scholar"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://github.com/dominicroye" target="_blank" rel="noopener">
        <i class="fab fa-github"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://www.linkedin.com/in/dominicroye/" target="_blank" rel="noopener">
        <i class="fab fa-linkedin"></i>
      </a>
    </li>
  
    
    
    
    
    
    
    
      
    
    <li>
      <a href="https://www.researchgate.net/profile/Dominic_Roye" target="_blank" rel="noopener">
        <i class="ai ai-researchgate"></i>
      </a>
    </li>
  
</ul>

    </div>
  </div>
















  
  
  <div class="article-widget content-widget-hr">
    <h3>Related</h3>
    <ul>
      
      <li><a href="/en/2022/use-of-multidimensional-spatial-data/">Use of multidimensional spatial data</a></li>
      
      <li><a href="/en/2021/visualize-the-day-night-cycle-on-a-world-map/">Visualize the day-night cycle on a world map</a></li>
      
      <li><a href="/en/2021/climate-circles/">Climate circles</a></li>
      
      <li><a href="/en/2021/firefly-cartography/">Firefly cartography</a></li>
      
      <li><a href="/en/2021/bivariate-dasymetric-map/">Bivariate dasymetric map</a></li>
      
    </ul>
  </div>
  





  </div>
</article>
  </div>

  <div class="page-footer">
    
    
    <div class="container">
      <footer class="site-footer">

  



  

  

  
  <p class="powered-by">
    © 2018-2022 Dominic Royé. All rights reserved
  </p>
  

  
  






  <p class="powered-by">
    
    
    
      
      
      
      
      
      
      Published with <a href="https://wowchemy.com/?utm_campaign=poweredby" target="_blank" rel="noopener">Wowchemy</a> — the free, <a href="https://github.com/wowchemy/wowchemy-hugo-themes" target="_blank" rel="noopener">open source</a> website builder that empowers creators.
    
  </p>
</footer>

    </div>
    
  </div>

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

      

    
    <script src="/js/vendor-bundle.min.b73dfaac3b6499dc997741748a7c3fe2.js"></script>

    
    
    
      
      
        <script src="https://cdn.jsdelivr.net/gh/desandro/imagesloaded@v4.1.4/imagesloaded.pkgd.min.js" integrity="sha512-S5PZ9GxJZO16tT9r3WJp/Safn31eu8uWrzglMahDT4dsmgqWonRY9grk3j+3tfuPr9WJNsfooOR7Gi7HL5W2jw==" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/gh/metafizzy/isotope@v3.0.6/dist/isotope.pkgd.min.js" integrity="sha512-Zq2BOxyhvnRFXu0+WE6ojpZLOU2jdnqbrM1hmVdGzyeCa1DgM3X5Q4A/Is9xA1IkbUeDd7755dNNI/PzSf2Pew==" crossorigin="anonymous"></script>
      

      
      

      

      
        
        <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.2.1/build/highlight.min.js" integrity="sha512-Ypjm0o7jOxAd4hpdoppSEN0TQOC19UtPAqD+4s5AlXmUvbmmS/YMxYqAqarQYyxTnB6/rqip9qcxlNB/3U9Wdg==" crossorigin="anonymous"></script>
        
        
        <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.2.1/build/languages/r.min.js" crossorigin="anonymous"></script>
        
      

    

    
    
    
      <script src="https://cdn.jsdelivr.net/npm/leaflet@1.7.1/dist/leaflet.min.js" integrity="" crossorigin="anonymous"></script>
    

    
    

    
    
    

    
    

    
    
    
    

    
    

    
    
    
    
    
    
    
    
    
    <script src="/en/js/wowchemy.min.50d3bf3df0c53b31631bb48a62b35f92.js"></script>

    
  <script async defer src="https://buttons.github.io/buttons.js"></script>




</body>
</html>
